/* qwebirc -- Copyright (C) 2008-2019 Chris Porter and the qwebirc project --- All rights reserved. */

QWEBIRC_BUILD="b5d2a56759eb5ddbb62631895ce27e0f77910e2f";
QWEBIRC_DEBUG=false;var MooTools={version:"1.2.5",build:"008d8f0f2fcc2044e54fdd3635341aaab274e757"};var Native=function(l){l=l||{};var a=l.name;var j=l.legacy;var b=l.protect;var c=l.implement;var i=l.generics;var g=l.initialize;var h=l.afterImplement||function(){};var d=g||j;i=i!==false;d.constructor=Native;d.$family={name:"native"};if(j&&g){d.prototype=j.prototype}d.prototype.constructor=d;if(a){var f=a.toLowerCase();d.prototype.$family={name:f};Native.typize(d,f)}var k=function(o,m,p,n){if(!b||n||!o.prototype[m]){o.prototype[m]=p}if(i){Native.genericize(o,m,b)}h.call(o,m,p);return o};d.alias=function(o,m,q){if(typeof o=="string"){var p=this.prototype[o];if((o=p)){return k(this,m,o,q)}}for(var n in o){this.alias(n,o[n],m)}return this};d.implement=function(n,m,q){if(typeof n=="string"){return k(this,n,m,q)}for(var o in n){k(this,o,n[o],m)}return this};if(c){d.implement(c)}return d};Native.genericize=function(b,c,a){if((!a||!b[c])&&typeof b.prototype[c]=="function"){b[c]=function(){var d=Array.prototype.slice.call(arguments);return b.prototype[c].apply(d.shift(),d)}}};Native.implement=function(d,c){for(var b=0,a=d.length;b<a;b++){d[b].implement(c)}};Native.typize=function(a,b){if(!a.type){a.type=function(c){return($type(c)===b)}}};(function(){var a={Array:Array,Date:Date,Function:Function,Number:Number,RegExp:RegExp,String:String};for(var j in a){new Native({name:j,initialize:a[j],protect:true})}var d={"boolean":Boolean,"native":Native,object:Object};for(var c in d){Native.typize(d[c],c)}var h={Array:["concat","indexOf","join","lastIndexOf","pop","push","reverse","shift","slice","sort","splice","toString","unshift","valueOf"],String:["charAt","charCodeAt","concat","indexOf","lastIndexOf","match","replace","search","slice","split","substr","substring","toLowerCase","toUpperCase","valueOf"]};for(var f in h){for(var b=h[f].length;b--;){Native.genericize(a[f],h[f][b],true)}}})();var Hash=new Native({name:"Hash",initialize:function(a){if($type(a)=="hash"){a=$unlink(a.getClean())}for(var b in a){this[b]=a[b]}return this}});Hash.implement({forEach:function(b,c){for(var a in this){if(this.hasOwnProperty(a)){b.call(c,this[a],a,this)}}},getClean:function(){var b={};for(var a in this){if(this.hasOwnProperty(a)){b[a]=this[a]}}return b},getLength:function(){var b=0;for(var a in this){if(this.hasOwnProperty(a)){b++}}return b}});Hash.alias("forEach","each");Array.implement({forEach:function(c,d){for(var b=0,a=this.length;b<a;b++){c.call(d,this[b],b,this)}}});Array.alias("forEach","each");function $A(b){if(b.item){var a=b.length,c=new Array(a);while(a--){c[a]=b[a]}return c}return Array.prototype.slice.call(b)}function $arguments(a){return function(){return arguments[a]}}function $chk(a){return !!(a||a===0)}function $clear(a){clearTimeout(a);clearInterval(a);return null}function $defined(a){return(a!=undefined)}function $each(c,b,d){var a=$type(c);((a=="arguments"||a=="collection"||a=="array")?Array:Hash).each(c,b,d)}function $empty(){}function $extend(c,a){for(var b in (a||{})){c[b]=a[b]}return c}function $H(a){return new Hash(a)}function $lambda(a){return($type(a)=="function")?a:function(){return a}}function $merge(){var a=Array.slice(arguments);a.unshift({});return $mixin.apply(null,a)}function $mixin(f){for(var d=1,a=arguments.length;d<a;d++){var b=arguments[d];if($type(b)!="object"){continue}for(var c in b){var h=b[c],g=f[c];f[c]=(g&&$type(h)=="object"&&$type(g)=="object")?$mixin(g,h):$unlink(h)}}return f}function $pick(){for(var b=0,a=arguments.length;b<a;b++){if(arguments[b]!=undefined){return arguments[b]}}return null}function $random(b,a){return Math.floor(Math.random()*(a-b+1)+b)}function $splat(b){var a=$type(b);return(a)?((a!="array"&&a!="arguments")?[b]:b):[]}var $time=Date.now||function(){return +new Date};function $try(){for(var b=0,a=arguments.length;b<a;b++){try{return arguments[b]()}catch(c){}}return null}function $type(a){if(a==undefined){return false}if(a.$family){return(a.$family.name=="number"&&!isFinite(a))?false:a.$family.name}if(a.nodeName){switch(a.nodeType){case 1:return"element";case 3:return(/\S/).test(a.nodeValue)?"textnode":"whitespace"}}else{if(typeof a.length=="number"){if(a.callee){return"arguments"}else{if(a.item){return"collection"}}}}return typeof a}function $unlink(c){var b;switch($type(c)){case"object":b={};for(var f in c){b[f]=$unlink(c[f])}break;case"hash":b=new Hash(c);break;case"array":b=[];for(var d=0,a=c.length;d<a;d++){b[d]=$unlink(c[d])}break;default:return c}return b}Array.implement({every:function(c,d){for(var b=0,a=this.length;b<a;b++){if(!c.call(d,this[b],b,this)){return false}}return true},filter:function(d,f){var c=[];for(var b=0,a=this.length;b<a;b++){if(d.call(f,this[b],b,this)){c.push(this[b])}}return c},clean:function(){return this.filter($defined)},indexOf:function(c,d){var a=this.length;for(var b=(d<0)?Math.max(0,a+d):d||0;b<a;b++){if(this[b]===c){return b}}return -1},map:function(d,f){var c=[];for(var b=0,a=this.length;b<a;b++){c[b]=d.call(f,this[b],b,this)}return c},some:function(c,d){for(var b=0,a=this.length;b<a;b++){if(c.call(d,this[b],b,this)){return true}}return false},associate:function(c){var d={},b=Math.min(this.length,c.length);for(var a=0;a<b;a++){d[c[a]]=this[a]}return d},link:function(c){var a={};for(var f=0,b=this.length;f<b;f++){for(var d in c){if(c[d](this[f])){a[d]=this[f];delete c[d];break}}}return a},contains:function(a,b){return this.indexOf(a,b)!=-1},extend:function(c){for(var b=0,a=c.length;b<a;b++){this.push(c[b])}return this},getLast:function(){return(this.length)?this[this.length-1]:null},getRandom:function(){return(this.length)?this[$random(0,this.length-1)]:null},include:function(a){if(!this.contains(a)){this.push(a)}return this},combine:function(c){for(var b=0,a=c.length;b<a;b++){this.include(c[b])}return this},erase:function(b){for(var a=this.length;a--;a){if(this[a]===b){this.splice(a,1)}}return this},empty:function(){this.length=0;return this},flatten:function(){var d=[];for(var b=0,a=this.length;b<a;b++){var c=$type(this[b]);if(!c){continue}d=d.concat((c=="array"||c=="collection"||c=="arguments")?Array.flatten(this[b]):this[b])}return d},hexToRgb:function(b){if(this.length!=3){return null}var a=this.map(function(c){if(c.length==1){c+=c}return c.toInt(16)});return(b)?a:"rgb("+a+")"},rgbToHex:function(d){if(this.length<3){return null}if(this.length==4&&this[3]==0&&!d){return"transparent"}var b=[];for(var a=0;a<3;a++){var c=(this[a]-0).toString(16);b.push((c.length==1)?"0"+c:c)}return(d)?b:"#"+b.join("")}});String.implement({test:function(a,b){return((typeof a=="string")?new RegExp(a,b):a).test(this)},contains:function(a,b){return(b)?(b+this+b).indexOf(b+a+b)>-1:this.indexOf(a)>-1},trim:function(){return this.replace(/^\s+|\s+$/g,"")},clean:function(){return this.replace(/\s+/g," ").trim()},camelCase:function(){return this.replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/[A-Z]/g,function(a){return("-"+a.charAt(0).toLowerCase())})},capitalize:function(){return this.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},escapeRegExp:function(){return this.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(a){return parseInt(this,a||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(b){var a=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return(a)?a.slice(1).hexToRgb(b):null},rgbToHex:function(b){var a=this.match(/\d{1,3}/g);return(a)?a.rgbToHex(b):null},stripScripts:function(b){var a="";var c=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(){a+=arguments[1]+"\n";return""});if(b===true){$exec(a)}else{if($type(b)=="function"){b(a,c)}}return c},substitute:function(a,b){return this.replace(b||(/\\?\{([^{}]+)\}/g),function(d,c){if(d.charAt(0)=="\\"){return d.slice(1)}return(a[c]!=undefined)?a[c]:""})}});try{delete Function.prototype.bind}catch(e){}Function.implement({extend:function(a){for(var b in a){this[b]=a[b]}return this},create:function(b){var a=this;b=b||{};return function(d){var c=b.arguments;c=(c!=undefined)?$splat(c):Array.slice(arguments,(b.event)?1:0);if(b.event){c=[d||window.event].extend(c)}var f=function(){return a.apply(b.bind||null,c)};if(b.delay){return setTimeout(f,b.delay)}if(b.periodical){return setInterval(f,b.periodical)}if(b.attempt){return $try(f)}return f()}},run:function(a,b){return this.apply(b,$splat(a))},pass:function(a,b){return this.create({bind:b,arguments:a})},bind:function(b,a){return this.create({bind:b,arguments:a})},bindWithEvent:function(b,a){return this.create({bind:b,arguments:a,event:true})},attempt:function(a,b){return this.create({bind:b,arguments:a,attempt:true})()},delay:function(b,c,a){return this.create({bind:c,arguments:a,delay:b})()},periodical:function(c,b,a){return this.create({bind:b,arguments:a,periodical:c})()}});Number.implement({limit:function(b,a){return Math.min(a,Math.max(b,this))},round:function(a){a=Math.pow(10,a||0);return Math.round(this*a)/a},times:function(b,c){for(var a=0;a<this;a++){b.call(c,a,this)}},toFloat:function(){return parseFloat(this)},toInt:function(a){return parseInt(this,a||10)}});Number.alias("times","each");(function(b){var a={};b.each(function(c){if(!Number[c]){a[c]=function(){return Math[c].apply(null,[this].concat($A(arguments)))}}});Number.implement(a)})(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]);Hash.implement({has:Object.prototype.hasOwnProperty,keyOf:function(b){for(var a in this){if(this.hasOwnProperty(a)&&this[a]===b){return a}}return null},hasValue:function(a){return(Hash.keyOf(this,a)!==null)},extend:function(a){Hash.each(a||{},function(c,b){Hash.set(this,b,c)},this);return this},combine:function(a){Hash.each(a||{},function(c,b){Hash.include(this,b,c)},this);return this},erase:function(a){if(this.hasOwnProperty(a)){delete this[a]}return this},get:function(a){return(this.hasOwnProperty(a))?this[a]:null},set:function(a,b){if(!this[a]||this.hasOwnProperty(a)){this[a]=b}return this},empty:function(){Hash.each(this,function(b,a){delete this[a]},this);return this},include:function(a,b){if(this[a]==undefined){this[a]=b}return this},map:function(b,c){var a=new Hash;Hash.each(this,function(f,d){a.set(d,b.call(c,f,d,this))},this);return a},filter:function(b,c){var a=new Hash;Hash.each(this,function(f,d){if(b.call(c,f,d,this)){a.set(d,f)}},this);return a},every:function(b,c){for(var a in this){if(this.hasOwnProperty(a)&&!b.call(c,this[a],a)){return false}}return true},some:function(b,c){for(var a in this){if(this.hasOwnProperty(a)&&b.call(c,this[a],a)){return true}}return false},getKeys:function(){var a=[];Hash.each(this,function(c,b){a.push(b)});return a},getValues:function(){var a=[];Hash.each(this,function(b){a.push(b)});return a},toQueryString:function(a){var b=[];Hash.each(this,function(g,f){if(a){f=a+"["+f+"]"}var d;switch($type(g)){case"object":d=Hash.toQueryString(g,f);break;case"array":var c={};g.each(function(j,h){c[h]=j});d=Hash.toQueryString(c,f);break;default:d=f+"="+encodeURIComponent(g)}if(g!=undefined){b.push(d)}});return b.join("&")}});Hash.alias({keyOf:"indexOf",hasValue:"contains"});function Class(b){if(b instanceof Function){b={initialize:b}}var a=function(){Object.reset(this);if(a._prototyping){return this}this._current=$empty;var c=(this.initialize)?this.initialize.apply(this,arguments):this;delete this._current;delete this.caller;return c}.extend(this);a.implement(b);a.constructor=Class;a.prototype.constructor=a;return a}Function.prototype.protect=function(){this._protected=true;return this};Object.reset=function(a,c){if(c==null){for(var f in a){Object.reset(a,f)}return a}delete a[c];switch($type(a[c])){case"object":var d=function(){};d.prototype=a[c];var b=new d;a[c]=Object.reset(b);break;case"array":a[c]=$unlink(a[c]);break}return a};new Native({name:"Class",initialize:Class}).extend({instantiate:function(b){b._prototyping=true;var a=new b;delete b._prototyping;return a},wrap:function(a,b,c){if(c._origin){c=c._origin}return function(){if(c._protected&&this._current==null){throw new Error('The method "'+b+'" cannot be called.')}var f=this.caller,g=this._current;this.caller=g;this._current=arguments.callee;var d=c.apply(this,arguments);this._current=g;this.caller=f;return d}.extend({_owner:a,_origin:c,_name:b})}});Class.implement({implement:function(a,d){if($type(a)=="object"){for(var f in a){this.implement(f,a[f])}return this}var g=Class.Mutators[a];if(g){d=g.call(this,d);if(d==null){return this}}var c=this.prototype;switch($type(d)){case"function":if(d._hidden){return this}c[a]=Class.wrap(this,a,d);break;case"object":var b=c[a];if($type(b)=="object"){$mixin(b,d)}else{c[a]=$unlink(d)}break;case"array":c[a]=$unlink(d);break;default:c[a]=d}return this}});Class.Mutators={Extends:function(a){this.parent=a;this.prototype=Class.instantiate(a);this.implement("parent",function(){var b=this.caller._name,c=this.caller._owner.parent.prototype[b];if(!c){throw new Error('The method "'+b+'" has no parent.')}return c.apply(this,arguments)}.protect())},Implements:function(a){$splat(a).each(function(b){if(b instanceof Function){b=Class.instantiate(b)}this.implement(b)},this)}};var Chain=new Class({$chain:[],chain:function(){this.$chain.extend(Array.flatten(arguments));return this},callChain:function(){return(this.$chain.length)?this.$chain.shift().apply(this,arguments):false},clearChain:function(){this.$chain.empty();return this}});var Events=new Class({$events:{},addEvent:function(c,b,a){c=Events.removeOn(c);if(b!=$empty){this.$events[c]=this.$events[c]||[];this.$events[c].include(b);if(a){b.internal=true}}return this},addEvents:function(a){for(var b in a){this.addEvent(b,a[b])}return this},fireEvent:function(c,b,a){c=Events.removeOn(c);if(!this.$events||!this.$events[c]){return this}this.$events[c].each(function(d){d.create({bind:this,delay:a,"arguments":b})()},this);return this},removeEvent:function(b,a){b=Events.removeOn(b);if(!this.$events[b]){return this}if(!a.internal){this.$events[b].erase(a)}return this},removeEvents:function(c){var d;if($type(c)=="object"){for(d in c){this.removeEvent(d,c[d])}return this}if(c){c=Events.removeOn(c)}for(d in this.$events){if(c&&c!=d){continue}var b=this.$events[d];for(var a=b.length;a--;a){this.removeEvent(d,b[a])}}return this}});Events.removeOn=function(a){return a.replace(/^on([A-Z])/,function(b,c){return c.toLowerCase()})};var Options=new Class({setOptions:function(){this.options=$merge.run([this.options].extend(arguments));if(!this.addEvent){return this}for(var a in this.options){if($type(this.options[a])!="function"||!(/^on[A-Z]/).test(a)){continue}this.addEvent(a,this.options[a]);delete this.options[a]}return this}});var Browser=$merge({Engine:{name:"unknown",version:0},Platform:{name:(window.orientation!=undefined)?"ipod":(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase()},Features:{xpath:!!(document.evaluate),air:!!(window.runtime),query:!!(document.querySelector)},Plugins:{},Engines:{presto:function(){return(!window.opera)?false:((arguments.callee.caller)?960:((document.getElementsByClassName)?950:925))},trident:function(){return(!window.ActiveXObject)?false:((window.XMLHttpRequest)?((document.querySelectorAll)?6:5):4)},webkit:function(){return(navigator.taintEnabled)?false:((Browser.Features.xpath)?((Browser.Features.query)?525:420):419)},gecko:function(){return(!document.getBoxObjectFor&&window.mozInnerScreenX==null)?false:((document.getElementsByClassName)?19:18)}}},Browser||{});Browser.Platform[Browser.Platform.name]=true;Browser.detect=function(){for(var b in this.Engines){var a=this.Engines[b]();if(a){this.Engine={name:b,version:a};this.Engine[b]=this.Engine[b+a]=true;break}}return{name:b,version:a}};Browser.detect();Browser.Request=function(){return $try(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("MSXML2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})};Browser.Features.xhr=!!(Browser.Request());Browser.Plugins.Flash=(function(){var a=($try(function(){return navigator.plugins["Shockwave Flash"].description},function(){return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")})||"0 r0").match(/\d+/g);return{version:parseInt(a[0]||0+"."+a[1],10)||0,build:parseInt(a[2],10)||0}})();function $exec(b){if(!b){return b}if(window.execScript){window.execScript(b)}else{var a=document.createElement("script");a.setAttribute("type","text/javascript");a[(Browser.Engine.webkit&&Browser.Engine.version<420)?"innerText":"text"]=b;document.head.appendChild(a);document.head.removeChild(a)}return b}Native.UID=1;var $uid=(Browser.Engine.trident)?function(a){return(a.uid||(a.uid=[Native.UID++]))[0]}:function(a){return a.uid||(a.uid=Native.UID++)};var Window=new Native({name:"Window",legacy:(Browser.Engine.trident)?null:window.Window,initialize:function(a){$uid(a);if(!a.Element){a.Element=$empty;if(Browser.Engine.webkit){a.document.createElement("iframe")}a.Element.prototype=(Browser.Engine.webkit)?window["[[DOMElement.prototype]]"]:{}}a.document.window=a;return $extend(a,Window.Prototype)},afterImplement:function(b,a){window[b]=Window.Prototype[b]=a}});Window.Prototype={$family:{name:"window"}};new Window(window);var Document=new Native({name:"Document",legacy:(Browser.Engine.trident)?null:window.Document,initialize:function(a){$uid(a);a.head=a.getElementsByTagName("head")[0];a.html=a.getElementsByTagName("html")[0];if(Browser.Engine.trident&&Browser.Engine.version<=4){$try(function(){a.execCommand("BackgroundImageCache",false,true)})}if(Browser.Engine.trident){a.window.attachEvent("onunload",function(){a.window.detachEvent("onunload",arguments.callee);a.head=a.html=a.window=null})}return $extend(a,Document.Prototype)},afterImplement:function(b,a){document[b]=Document.Prototype[b]=a}});Document.Prototype={$family:{name:"document"}};new Document(document);var Element=new Native({name:"Element",legacy:window.Element,initialize:function(a,b){var c=Element.Constructors.get(a);if(c){return c(b)}if(typeof a=="string"){return document.newElement(a,b)}return document.id(a).set(b)},afterImplement:function(a,b){Element.Prototype[a]=b;if(Array[a]){return}Elements.implement(a,function(){var c=[],h=true;for(var f=0,d=this.length;f<d;f++){var g=this[f][a].apply(this[f],arguments);c.push(g);if(h){h=($type(g)=="element")}}return(h)?new Elements(c):c})}});Element.Prototype={$family:{name:"element"}};Element.Constructors=new Hash;var IFrame=new Native({name:"IFrame",generics:false,initialize:function(){var g=Array.link(arguments,{properties:Object.type,iframe:$defined});var d=g.properties||{};var c=document.id(g.iframe);var f=d.onload||$empty;delete d.onload;d.id=d.name=$pick(d.id,d.name,c?(c.id||c.name):"IFrame_"+$time());c=new Element(c||"iframe",d);var b=function(){var h=$try(function(){return c.contentWindow.location.host});if(!h||h==window.location.host){var i=new Window(c.contentWindow);new Document(c.contentWindow.document);$extend(i.Element.prototype,Element.Prototype)}f.call(c.contentWindow,c.contentWindow.document)};var a=$try(function(){return c.contentWindow});((a&&a.document.body)||window.frames[d.id])?b():c.addListener("load",b);return c}});var Elements=new Native({initialize:function(g,b){b=$extend({ddup:true,cash:true},b);g=g||[];if(b.ddup||b.cash){var h={},f=[];for(var c=0,a=g.length;c<a;c++){var d=document.id(g[c],!b.cash);if(b.ddup){if(h[d.uid]){continue}h[d.uid]=true}if(d){f.push(d)}}g=f}return(b.cash)?$extend(g,this):g}});Elements.implement({filter:function(a,b){if(!a){return this}return new Elements(Array.filter(this,(typeof a=="string")?function(c){return c.match(a)}:a,b))}});(function(){var d;try{var a=document.createElement("<input name=x>");d=(a.name=="x")}catch(b){}var c=function(f){return(""+f).replace(/&/g,"&amp;").replace(/"/g,"&quot;")};Document.implement({newElement:function(f,g){if(g&&g.checked!=null){g.defaultChecked=g.checked}if(d&&g){f="<"+f;if(g.name){f+=' name="'+c(g.name)+'"'}if(g.type){f+=' type="'+c(g.type)+'"'}f+=">";delete g.name;delete g.type}return this.id(this.createElement(f)).set(g)},newTextNode:function(f){return this.createTextNode(f)},getDocument:function(){return this},getWindow:function(){return this.window},id:(function(){var f={string:function(i,h,g){i=g.getElementById(i);return(i)?f.element(i,h):null},element:function(g,j){$uid(g);if(!j&&!g.$family&&!(/^object|embed$/i).test(g.tagName)){var h=Element.Prototype;for(var i in h){g[i]=h[i]}}return g},object:function(h,i,g){if(h.toElement){return f.element(h.toElement(g),i)}return null}};f.textnode=f.whitespace=f.window=f.document=$arguments(0);return function(h,j,i){if(h&&h.$family&&h.uid){return h}var g=$type(h);return(f[g])?f[g](h,j,i||document):null}})()})})();if(window.$==null){Window.implement({$:function(a,b){return document.id(a,b,this.document)}})}Window.implement({$$:function(a){if(arguments.length==1&&typeof a=="string"){return this.document.getElements(a)}var g=[];var c=Array.flatten(arguments);for(var d=0,b=c.length;d<b;d++){var f=c[d];switch($type(f)){case"element":g.push(f);break;case"string":g.extend(this.document.getElements(f,true))}}return new Elements(g)},getDocument:function(){return this.document},getWindow:function(){return this}});Native.implement([Element,Document],{getElement:function(a,b){return document.id(this.getElements(a,true)[0]||null,b)},getElements:function(a,d){a=a.split(",");var c=[];var b=(a.length>1);a.each(function(f){var g=this.getElementsByTagName(f.trim());(b)?c.extend(g):c=g},this);return new Elements(c,{ddup:b,cash:!d})}});(function(){var i={},g={};var j={input:"checked",option:"selected",textarea:(Browser.Engine.webkit&&Browser.Engine.version<420)?"innerHTML":"value"};var c=function(m){return(g[m]||(g[m]={}))};var h=function(o,m){if(!o){return}var n=o.uid;if(m!==true){m=false}if(Browser.Engine.trident){if(o.clearAttributes){var r=m&&o.cloneNode(false);o.clearAttributes();if(r){o.mergeAttributes(r)}}else{if(o.removeEvents){o.removeEvents()}}if((/object/i).test(o.tagName)){for(var q in o){if(typeof o[q]=="function"){o[q]=$empty}}Element.dispose(o)}}if(!n){return}i[n]=g[n]=null};var d=function(){Hash.each(i,h);if(Browser.Engine.trident){$A(document.getElementsByTagName("object")).each(h)}if(window.CollectGarbage){CollectGarbage()}i=g=null};var k=function(o,m,t,n,q,s){var p=o[t||m];var r=[];while(p){if(p.nodeType==1&&(!n||Element.match(p,n))){if(!q){return document.id(p,s)}r.push(p)}p=p[m]}return(q)?new Elements(r,{ddup:false,cash:!s}):null};var f={html:"innerHTML","class":"className","for":"htmlFor",defaultValue:"defaultValue",text:(Browser.Engine.trident||(Browser.Engine.webkit&&Browser.Engine.version<420))?"innerText":"textContent"};var b=["compact","nowrap","ismap","declare","noshade","checked","disabled","readonly","multiple","selected","noresize","defer"];var l=["value","type","defaultValue","accessKey","cellPadding","cellSpacing","colSpan","frameBorder","maxLength","readOnly","rowSpan","tabIndex","useMap"];b=b.associate(b);Hash.extend(f,b);Hash.extend(f,l.associate(l.map(String.toLowerCase)));var a={before:function(n,m){if(m.parentNode){m.parentNode.insertBefore(n,m)}},after:function(n,m){if(!m.parentNode){return}var o=m.nextSibling;(o)?m.parentNode.insertBefore(n,o):m.parentNode.appendChild(n)},bottom:function(n,m){m.appendChild(n)},top:function(n,m){var o=m.firstChild;(o)?m.insertBefore(n,o):m.appendChild(n)}};a.inside=a.bottom;Hash.each(a,function(m,n){n=n.capitalize();Element.implement("inject"+n,function(o){m(this,document.id(o,true));return this});Element.implement("grab"+n,function(o){m(document.id(o,true),this);return this})});Element.implement({set:function(q,n){switch($type(q)){case"object":for(var o in q){this.set(o,q[o])}break;case"string":var m=Element.Properties.get(q);(m&&m.set)?m.set.apply(this,Array.slice(arguments,1)):this.setProperty(q,n)}return this},get:function(n){var m=Element.Properties.get(n);return(m&&m.get)?m.get.apply(this,Array.slice(arguments,1)):this.getProperty(n)},erase:function(n){var m=Element.Properties.get(n);(m&&m.erase)?m.erase.apply(this):this.removeProperty(n);return this},setProperty:function(n,o){var m=f[n];if(o==undefined){return this.removeProperty(n)}if(m&&b[n]){o=!!o}(m)?this[m]=o:this.setAttribute(n,""+o);return this},setProperties:function(m){for(var n in m){this.setProperty(n,m[n])}return this},getProperty:function(n){var m=f[n];var o=(m)?this[m]:this.getAttribute(n,2);return(b[n])?!!o:(m)?o:o||null},getProperties:function(){var m=$A(arguments);return m.map(this.getProperty,this).associate(m)},removeProperty:function(n){var m=f[n];(m)?this[m]=(m&&b[n])?false:"":this.removeAttribute(n);return this},removeProperties:function(){Array.each(arguments,this.removeProperty,this);return this},hasClass:function(m){return this.className.contains(m," ")},addClass:function(m){if(!this.hasClass(m)){this.className=(this.className+" "+m).clean()}return this},removeClass:function(m){this.className=this.className.replace(new RegExp("(^|\\s)"+m+"(?:\\s|$)"),"$1");return this},toggleClass:function(m){return this.hasClass(m)?this.removeClass(m):this.addClass(m)},adopt:function(){Array.flatten(arguments).each(function(m){m=document.id(m,true);if(m){this.appendChild(m)}},this);return this},appendText:function(n,m){return this.grab(this.getDocument().newTextNode(n),m)},grab:function(n,m){a[m||"bottom"](document.id(n,true),this);return this},inject:function(n,m){a[m||"bottom"](this,document.id(n,true));return this},replaces:function(m){m=document.id(m,true);m.parentNode.replaceChild(this,m);return this},wraps:function(n,m){n=document.id(n,true);return this.replaces(n).grab(n,m)},getPrevious:function(m,n){return k(this,"previousSibling",null,m,false,n)},getAllPrevious:function(m,n){return k(this,"previousSibling",null,m,true,n)},getNext:function(m,n){return k(this,"nextSibling",null,m,false,n)},getAllNext:function(m,n){return k(this,"nextSibling",null,m,true,n)},getFirst:function(m,n){return k(this,"nextSibling","firstChild",m,false,n)},getLast:function(m,n){return k(this,"previousSibling","lastChild",m,false,n)},getParent:function(m,n){return k(this,"parentNode",null,m,false,n)},getParents:function(m,n){return k(this,"parentNode",null,m,true,n)},getSiblings:function(m,n){return this.getParent().getChildren(m,n).erase(this)},getChildren:function(m,n){return k(this,"nextSibling","firstChild",m,true,n)},getWindow:function(){return this.ownerDocument.window},getDocument:function(){return this.ownerDocument},getElementById:function(p,o){var n=this.ownerDocument.getElementById(p);if(!n){return null}for(var m=n.parentNode;m!=this;m=m.parentNode){if(!m){return null}}return document.id(n,o)},getSelected:function(){return new Elements($A(this.options).filter(function(m){return m.selected}))},getComputedStyle:function(n){if(this.currentStyle){return this.currentStyle[n.camelCase()]}var m=this.getDocument().defaultView.getComputedStyle(this,null);return(m)?m.getPropertyValue([n.hyphenate()]):null},toQueryString:function(){var m=[];this.getElements("input, select, textarea",true).each(function(n){if(!n.name||n.disabled||n.type=="submit"||n.type=="reset"||n.type=="file"){return}var o=(n.tagName.toLowerCase()=="select")?Element.getSelected(n).map(function(p){return p.value}):((n.type=="radio"||n.type=="checkbox")&&!n.checked)?null:n.value;$splat(o).each(function(p){if(typeof p!="undefined"){m.push(n.name+"="+encodeURIComponent(p))}})});return m.join("&")},clone:function(p,m){p=p!==false;var s=this.cloneNode(p);var o=function(x,v){if(!m){x.removeAttribute("id")}if(Browser.Engine.trident){x.clearAttributes();x.mergeAttributes(v);x.removeAttribute("uid");if(x.options){var y=x.options,t=v.options;for(var u=y.length;u--;){y[u].selected=t[u].selected}}}var z=j[v.tagName.toLowerCase()];if(z&&v[z]){x[z]=v[z]}};if(p){var q=s.getElementsByTagName("*"),r=this.getElementsByTagName("*");for(var n=q.length;n--;){o(q[n],r[n])}}o(s,this);return document.id(s)},destroy:function(){Element.empty(this);Element.dispose(this);h(this,true);return null},empty:function(){$A(this.childNodes).each(function(m){Element.destroy(m)});return this},dispose:function(){return(this.parentNode)?this.parentNode.removeChild(this):this},hasChild:function(m){m=document.id(m,true);if(!m){return false}if(Browser.Engine.webkit&&Browser.Engine.version<420){return $A(this.getElementsByTagName(m.tagName)).contains(m)}return(this.contains)?(this!=m&&this.contains(m)):!!(this.compareDocumentPosition(m)&16)},match:function(m){return(!m||(m==this)||(Element.get(this,"tag")==m))}});Native.implement([Element,Window,Document],{addListener:function(p,o){if(p=="unload"){var m=o,n=this;o=function(){n.removeListener("unload",o);m()}}else{i[this.uid]=this}if(this.addEventListener){this.addEventListener(p,o,false)}else{this.attachEvent("on"+p,o)}return this},removeListener:function(n,m){if(this.removeEventListener){this.removeEventListener(n,m,false)}else{this.detachEvent("on"+n,m)}return this},retrieve:function(n,m){var p=c(this.uid),o=p[n];if(m!=undefined&&o==undefined){o=p[n]=m}return $pick(o)},store:function(n,m){var o=c(this.uid);o[n]=m;return this},eliminate:function(m){var n=c(this.uid);delete n[m];return this}});window.addListener("unload",d)})();Element.Properties=new Hash;Element.Properties.style={set:function(a){this.style.cssText=a},get:function(){return this.style.cssText},erase:function(){this.style.cssText=""}};Element.Properties.tag={get:function(){return this.tagName.toLowerCase()}};Element.Properties.html=(function(){var c=document.createElement("div");var a={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};a.thead=a.tfoot=a.tbody;var b={set:function(){var f=Array.flatten(arguments).join("");var g=Browser.Engine.trident&&a[this.get("tag")];if(g){var h=c;h.innerHTML=g[1]+f+g[2];for(var d=g[0];d--;){h=h.firstChild}this.empty().adopt(h.childNodes)}else{this.innerHTML=f}}};b.erase=b.set;return b})();if(Browser.Engine.webkit&&Browser.Engine.version<420){Element.Properties.text={get:function(){if(this.innerText){return this.innerText}var a=this.ownerDocument.newElement("div",{html:this.innerHTML}).inject(this.ownerDocument.body);var b=a.innerText;a.destroy();return b}}}(function(){Element.implement({scrollTo:function(i,j){if(b(this)){this.getWindow().scrollTo(i,j)}else{this.scrollLeft=i;this.scrollTop=j}return this},getSize:function(){if(b(this)){return this.getWindow().getSize()}return{x:this.offsetWidth,y:this.offsetHeight}},getScrollSize:function(){if(b(this)){return this.getWindow().getScrollSize()}return{x:this.scrollWidth,y:this.scrollHeight}},getScroll:function(){if(b(this)){return this.getWindow().getScroll()}return{x:this.scrollLeft,y:this.scrollTop}},getScrolls:function(){var j=this,i={x:0,y:0};while(j&&!b(j)){i.x+=j.scrollLeft;i.y+=j.scrollTop;j=j.parentNode}return i},getOffsetParent:function(){var i=this;if(b(i)){return null}if(!Browser.Engine.trident){return i.offsetParent}while((i=i.parentNode)&&!b(i)){if(d(i,"position")!="static"){return i}}return null},getOffsets:function(){if(this.getBoundingClientRect){var k=this.getBoundingClientRect(),n=document.id(this.getDocument().documentElement),q=n.getScroll(),l=this.getScrolls(),j=this.getScroll(),i=(d(this,"position")=="fixed");return{x:k.left.toInt()+l.x-j.x+((i)?0:q.x)-n.clientLeft,y:k.top.toInt()+l.y-j.y+((i)?0:q.y)-n.clientTop}}var m=this,o={x:0,y:0};if(b(this)){return o}while(m&&!b(m)){o.x+=m.offsetLeft;o.y+=m.offsetTop;if(Browser.Engine.gecko){if(!g(m)){o.x+=c(m);o.y+=h(m)}var p=m.parentNode;if(p&&d(p,"overflow")!="visible"){o.x+=c(p);o.y+=h(p)}}else{if(m!=this&&Browser.Engine.webkit){o.x+=c(m);o.y+=h(m)}}m=m.offsetParent}if(Browser.Engine.gecko&&!g(this)){o.x-=c(this);o.y-=h(this)}return o},getPosition:function(l){if(b(this)){return{x:0,y:0}}var m=this.getOffsets(),j=this.getScrolls();var i={x:m.x-j.x,y:m.y-j.y};var k=(l&&(l=document.id(l)))?l.getPosition():{x:0,y:0};return{x:i.x-k.x,y:i.y-k.y}},getCoordinates:function(k){if(b(this)){return this.getWindow().getCoordinates()}var i=this.getPosition(k),j=this.getSize();var l={left:i.x,top:i.y,width:j.x,height:j.y};l.right=l.left+l.width;l.bottom=l.top+l.height;return l},computePosition:function(i){return{left:i.x-f(this,"margin-left"),top:i.y-f(this,"margin-top")}},setPosition:function(i){return this.setStyles(this.computePosition(i))}});Native.implement([Document,Window],{getSize:function(){if(Browser.Engine.presto||Browser.Engine.webkit){var j=this.getWindow();return{x:j.innerWidth,y:j.innerHeight}}var i=a(this);return{x:i.clientWidth,y:i.clientHeight}},getScroll:function(){var j=this.getWindow(),i=a(this);return{x:j.pageXOffset||i.scrollLeft,y:j.pageYOffset||i.scrollTop}},getScrollSize:function(){var j=a(this),i=this.getSize();return{x:Math.max(j.scrollWidth,i.x),y:Math.max(j.scrollHeight,i.y)}},getPosition:function(){return{x:0,y:0}},getCoordinates:function(){var i=this.getSize();return{top:0,left:0,bottom:i.y,right:i.x,height:i.y,width:i.x}}});var d=Element.getComputedStyle;function f(i,j){return d(i,j).toInt()||0}function g(i){return d(i,"-moz-box-sizing")=="border-box"}function h(i){return f(i,"border-top-width")}function c(i){return f(i,"border-left-width")}function b(i){return(/^(?:body|html)$/i).test(i.tagName)}function a(i){var j=i.getDocument();return(!j.compatMode||j.compatMode=="CSS1Compat")?j.html:j.body}})();Element.alias("setPosition","position");Native.implement([Window,Document,Element],{getHeight:function(){return this.getSize().y},getWidth:function(){return this.getSize().x},getScrollTop:function(){return this.getScroll().y},getScrollLeft:function(){return this.getScroll().x},getScrollHeight:function(){return this.getScrollSize().y},getScrollWidth:function(){return this.getScrollSize().x},getTop:function(){return this.getPosition().y},getLeft:function(){return this.getPosition().x}});var Event=new Native({name:"Event",initialize:function(a,g){g=g||window;var l=g.document;a=a||g.event;if(a.$extended){return a}this.$extended=true;var k=a.type;var h=a.target||a.srcElement;while(h&&h.nodeType==3){h=h.parentNode}if(k.test(/key/)){var b=a.which||a.keyCode;var n=Event.Keys.keyOf(b);if(k=="keydown"){var d=b-111;if(d>0&&d<13){n="f"+d}}n=n||String.fromCharCode(b).toLowerCase()}else{if(k.match(/(click|mouse|menu)/i)){l=(!l.compatMode||l.compatMode=="CSS1Compat")?l.html:l.body;var j={x:a.pageX||a.clientX+l.scrollLeft,y:a.pageY||a.clientY+l.scrollTop};var c={x:(a.pageX)?a.pageX-g.pageXOffset:a.clientX,y:(a.pageY)?a.pageY-g.pageYOffset:a.clientY};if(k.match(/DOMMouseScroll|mousewheel/)){var i=(a.wheelDelta)?a.wheelDelta/120:-(a.detail||0)/3}var f=(a.which==3)||(a.button==2);var m=null;if(k.match(/over|out/)){switch(k){case"mouseover":m=a.relatedTarget||a.fromElement;break;case"mouseout":m=a.relatedTarget||a.toElement}if(!(function(){while(m&&m.nodeType==3){m=m.parentNode}return true}).create({attempt:Browser.Engine.gecko})()){m=false}}}}return $extend(this,{event:a,type:k,page:j,client:c,rightClick:f,wheel:i,relatedTarget:m,target:h,code:b,key:n,shift:a.shiftKey,control:a.ctrlKey,alt:a.altKey,meta:a.metaKey})}});Event.Keys=new Hash({enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46});Event.implement({stop:function(){return this.stopPropagation().preventDefault()},stopPropagation:function(){if(this.event.stopPropagation){this.event.stopPropagation()}else{this.event.cancelBubble=true}return this},preventDefault:function(){if(this.event.preventDefault){this.event.preventDefault()}else{this.event.returnValue=false}return this}});Element.Properties.events={set:function(a){this.addEvents(a)}};Native.implement([Element,Window,Document],{addEvent:function(f,h){var i=this.retrieve("events",{});i[f]=i[f]||{keys:[],values:[]};if(i[f].keys.contains(h)){return this}i[f].keys.push(h);var g=f,a=Element.Events.get(f),c=h,j=this;if(a){if(a.onAdd){a.onAdd.call(this,h)}if(a.condition){c=function(k){if(a.condition.call(this,k)){return h.call(this,k)}return true}}g=a.base||g}var d=function(){return h.call(j)};var b=Element.NativeEvents[g];if(b){if(b==2){d=function(k){k=new Event(k,j.getWindow());if(c.call(j,k)===false){k.stop()}}}this.addListener(g,d)}i[f].values.push(d);return this},removeEvent:function(c,b){var a=this.retrieve("events");if(!a||!a[c]){return this}var g=a[c].keys.indexOf(b);if(g==-1){return this}a[c].keys.splice(g,1);var f=a[c].values.splice(g,1)[0];var d=Element.Events.get(c);if(d){if(d.onRemove){d.onRemove.call(this,b)}c=d.base||c}return(Element.NativeEvents[c])?this.removeListener(c,f):this},addEvents:function(a){for(var b in a){this.addEvent(b,a[b])}return this},removeEvents:function(a){var c;if($type(a)=="object"){for(c in a){this.removeEvent(c,a[c])}return this}var b=this.retrieve("events");if(!b){return this}if(!a){for(c in b){this.removeEvents(c)}this.eliminate("events")}else{if(b[a]){while(b[a].keys[0]){this.removeEvent(a,b[a].keys[0])}b[a]=null}}return this},fireEvent:function(d,b,a){var c=this.retrieve("events");if(!c||!c[d]){return this}c[d].keys.each(function(f){f.create({bind:this,delay:a,"arguments":b})()},this);return this},cloneEvents:function(d,a){d=document.id(d);var c=d.retrieve("events");if(!c){return this}if(!a){for(var b in c){this.cloneEvents(d,b)}}else{if(c[a]){c[a].keys.each(function(f){this.addEvent(a,f)},this)}}return this}});try{if(typeof HTMLElement!="undefined"){HTMLElement.prototype.fireEvent=Element.prototype.fireEvent}}catch(e){}Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,load:1,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1};(function(){var a=function(b){var c=b.relatedTarget;if(c==undefined){return true}if(c===false){return false}return($type(this)!="document"&&c!=this&&c.prefix!="xul"&&!this.hasChild(c))};Element.Events=new Hash({mouseenter:{base:"mouseover",condition:a},mouseleave:{base:"mouseout",condition:a},mousewheel:{base:(Browser.Engine.gecko)?"DOMMouseScroll":"mousewheel"}})})();Element.Properties.styles={set:function(a){this.setStyles(a)}};Element.Properties.opacity={set:function(a,b){if(!b){if(a==0){if(this.style.visibility!="hidden"){this.style.visibility="hidden"}}else{if(this.style.visibility!="visible"){this.style.visibility="visible"}}}if(!this.currentStyle||!this.currentStyle.hasLayout){this.style.zoom=1}if(Browser.Engine.trident){this.style.filter=(a==1)?"":"alpha(opacity="+a*100+")"}this.style.opacity=a;this.store("opacity",a)},get:function(){return this.retrieve("opacity",1)}};Element.implement({setOpacity:function(a){return this.set("opacity",a,true)},getOpacity:function(){return this.get("opacity")},setStyle:function(b,a){switch(b){case"opacity":return this.set("opacity",parseFloat(a));case"float":b=(Browser.Engine.trident)?"styleFloat":"cssFloat"}b=b.camelCase();if($type(a)!="string"){var c=(Element.Styles.get(b)||"@").split(" ");a=$splat(a).map(function(f,d){if(!c[d]){return""}return($type(f)=="number")?c[d].replace("@",Math.round(f)):f}).join(" ")}else{if(a==String(Number(a))){a=Math.round(a)}}this.style[b]=a;return this},getStyle:function(h){switch(h){case"opacity":return this.get("opacity");case"float":h=(Browser.Engine.trident)?"styleFloat":"cssFloat"}h=h.camelCase();var a=this.style[h];if(!$chk(a)){a=[];for(var g in Element.ShortStyles){if(h!=g){continue}for(var f in Element.ShortStyles[g]){a.push(this.getStyle(f))}return a.join(" ")}a=this.getComputedStyle(h)}if(a){a=String(a);var c=a.match(/rgba?\([\d\s,]+\)/);if(c){a=a.replace(c[0],c[0].rgbToHex())}}if(Browser.Engine.presto||(Browser.Engine.trident&&!$chk(parseInt(a,10)))){if(h.test(/^(height|width)$/)){var b=(h=="width")?["left","right"]:["top","bottom"],d=0;b.each(function(i){d+=this.getStyle("border-"+i+"-width").toInt()+this.getStyle("padding-"+i).toInt()},this);return this["offset"+h.capitalize()]-d+"px"}if((Browser.Engine.presto)&&String(a).test("px")){return a}if(h.test(/(border(.+)Width|margin|padding)/)){return"0px"}}return a},setStyles:function(b){for(var a in b){this.setStyle(a,b[a])}return this},getStyles:function(){var a={};Array.flatten(arguments).each(function(b){a[b]=this.getStyle(b)},this);return a}});Element.Styles=new Hash({left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@"});Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}};["Top","Right","Bottom","Left"].each(function(h){var g=Element.ShortStyles;var b=Element.Styles;["margin","padding"].each(function(i){var j=i+h;g[i][j]=b[j]="@px"});var f="border"+h;g.border[f]=b[f]="@px @ rgb(@, @, @)";var d=f+"Width",a=f+"Style",c=f+"Color";g[f]={};g.borderWidth[d]=g[f][d]=b[d]="@px";g.borderStyle[a]=g[f][a]=b[a]="@";g.borderColor[c]=g[f][c]=b[c]="rgb(@, @, @)"});var Fx=new Class({Implements:[Chain,Events,Options],options:{fps:50,unit:false,duration:500,link:"ignore"},initialize:function(a){this.subject=this.subject||this;this.setOptions(a);this.options.duration=Fx.Durations[this.options.duration]||this.options.duration.toInt();var b=this.options.wait;if(b===false){this.options.link="cancel"}},getTransition:function(){return function(a){return -(Math.cos(Math.PI*a)-1)/2}},step:function(){var a=$time();if(a<this.time+this.options.duration){var b=this.transition((a-this.time)/this.options.duration);this.set(this.compute(this.from,this.to,b))}else{this.set(this.compute(this.from,this.to,1));this.complete()}},set:function(a){return a},compute:function(c,b,a){return Fx.compute(c,b,a)},check:function(){if(!this.timer){return true}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.bind(this,arguments));return false}return false},start:function(b,a){if(!this.check(b,a)){return this}this.from=b;this.to=a;this.time=0;this.transition=this.getTransition();this.startTimer();this.onStart();return this},complete:function(){if(this.stopTimer()){this.onComplete()}return this},cancel:function(){if(this.stopTimer()){this.onCancel()}return this},onStart:function(){this.fireEvent("start",this.subject)},onComplete:function(){this.fireEvent("complete",this.subject);if(!this.callChain()){this.fireEvent("chainComplete",this.subject)}},onCancel:function(){this.fireEvent("cancel",this.subject).clearChain()},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},stopTimer:function(){if(!this.timer){return false}this.time=$time()-this.time;this.timer=$clear(this.timer);return true},startTimer:function(){if(this.timer){return false}this.time=$time()-this.time;this.timer=this.step.periodical(Math.round(1000/this.options.fps),this);return true}});Fx.compute=function(c,b,a){return(b-c)*a+c};Fx.Durations={"short":250,normal:500,"long":1000};Fx.CSS=new Class({Extends:Fx,prepare:function(d,f,b){b=$splat(b);var c=b[1];if(!$chk(c)){b[1]=b[0];b[0]=d.getStyle(f)}var a=b.map(this.parse);return{from:a[0],to:a[1]}},parse:function(a){a=$lambda(a)();a=(typeof a=="string")?a.split(" "):$splat(a);return a.map(function(c){c=String(c);var b=false;Fx.CSS.Parsers.each(function(g,f){if(b){return}var d=g.parse(c);if($chk(d)){b={value:d,parser:g}}});b=b||{value:c,parser:Fx.CSS.Parsers.String};return b})},compute:function(d,c,b){var a=[];(Math.min(d.length,c.length)).times(function(f){a.push({value:d[f].parser.compute(d[f].value,c[f].value,b),parser:d[f].parser})});a.$family={name:"fx:css:value"};return a},serve:function(c,b){if($type(c)!="fx:css:value"){c=this.parse(c)}var a=[];c.each(function(d){a=a.concat(d.parser.serve(d.value,b))});return a},render:function(a,d,c,b){a.setStyle(d,this.serve(c,b))},search:function(a){if(Fx.CSS.Cache[a]){return Fx.CSS.Cache[a]}var b={};Array.each(document.styleSheets,function(f,d){var c=f.href;if(c&&c.contains("://")&&!c.contains(document.domain)){return}var g=f.rules||f.cssRules;Array.each(g,function(k,h){if(!k.style){return}var j=(k.selectorText)?k.selectorText.replace(/^\w+/,function(i){return i.toLowerCase()}):null;if(!j||!j.test("^"+a+"$")){return}Element.Styles.each(function(l,i){if(!k.style[i]||Element.ShortStyles[i]){return}l=String(k.style[i]);b[i]=(l.test(/^rgb/))?l.rgbToHex():l})})});return Fx.CSS.Cache[a]=b}});Fx.CSS.Cache={};Fx.CSS.Parsers=new Hash({Color:{parse:function(a){if(a.match(/^#[0-9a-f]{3,6}$/i)){return a.hexToRgb(true)}return((a=a.match(/(\d+),\s*(\d+),\s*(\d+)/)))?[a[1],a[2],a[3]]:false},compute:function(c,b,a){return c.map(function(f,d){return Math.round(Fx.compute(c[d],b[d],a))})},serve:function(a){return a.map(Number)}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(b,a){return(a)?b+a:b}},String:{parse:$lambda(false),compute:$arguments(1),serve:$arguments(0)}});Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(b,a){this.element=this.subject=document.id(b);this.parent(a)},set:function(a){if(typeof a=="string"){a=this.search(a)}for(var b in a){this.render(this.element,b,a[b],this.options.unit)}return this},compute:function(f,d,c){var a={};for(var b in f){a[b]=this.parent(f[b],d[b],c)}return a},start:function(b){if(!this.check(b)){return this}if(typeof b=="string"){b=this.search(b)}var f={},d={};for(var c in b){var a=this.prepare(this.element,c,b[c]);f[c]=a.from;d[c]=a.to}return this.parent(f,d)}});Element.Properties.morph={set:function(a){var b=this.retrieve("morph");if(b){b.cancel()}return this.eliminate("morph").store("morph:options",$extend({link:"cancel"},a))},get:function(a){if(a||!this.retrieve("morph")){if(a||!this.retrieve("morph:options")){this.set("morph",a)}this.store("morph",new Fx.Morph(this,this.retrieve("morph:options")))}return this.retrieve("morph")}};Element.implement({morph:function(a){this.get("morph").start(a);return this}});Fx.implement({getTransition:function(){var a=this.options.transition||Fx.Transitions.Sine.easeInOut;if(typeof a=="string"){var b=a.split(":");a=Fx.Transitions;a=a[b[0]]||a[b[0].capitalize()];if(b[1]){a=a["ease"+b[1].capitalize()+(b[2]?b[2].capitalize():"")]}}return a}});Fx.Transition=function(b,a){a=$splat(a);return $extend(b,{easeIn:function(c){return b(c,a)},easeOut:function(c){return 1-b(1-c,a)},easeInOut:function(c){return(c<=0.5)?b(2*c,a)/2:(2-b(2*(1-c),a))/2}})};Fx.Transitions=new Hash({linear:$arguments(0)});Fx.Transitions.extend=function(a){for(var b in a){Fx.Transitions[b]=new Fx.Transition(a[b])}};Fx.Transitions.extend({Pow:function(b,a){return Math.pow(b,a[0]||6)},Expo:function(a){return Math.pow(2,8*(a-1))},Circ:function(a){return 1-Math.sin(Math.acos(a))},Sine:function(a){return 1-Math.sin((1-a)*Math.PI/2)},Back:function(b,a){a=a[0]||1.618;return Math.pow(b,2)*((a+1)*b-a)},Bounce:function(g){var f;for(var d=0,c=1;1;d+=c,c/=2){if(g>=(7-4*d)/11){f=c*c-Math.pow((11-6*d-11*g)/4,2);break}}return f},Elastic:function(b,a){return Math.pow(2,10*--b)*Math.cos(20*b*Math.PI*(a[0]||1)/3)}});["Quad","Cubic","Quart","Quint"].each(function(b,a){Fx.Transitions[b]=new Fx.Transition(function(c){return Math.pow(c,[a+2])})});Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(b,a){this.element=this.subject=document.id(b);this.parent(a)},set:function(b,a){if(arguments.length==1){a=b;b=this.property||this.options.property}this.render(this.element,b,a,this.options.unit);return this},start:function(c,f,d){if(!this.check(c,f,d)){return this}var b=Array.flatten(arguments);this.property=this.options.property||b.shift();var a=this.prepare(this.element,this.property,b);return this.parent(a.from,a.to)}});Element.Properties.tween={set:function(a){var b=this.retrieve("tween");if(b){b.cancel()}return this.eliminate("tween").store("tween:options",$extend({link:"cancel"},a))},get:function(a){if(a||!this.retrieve("tween")){if(a||!this.retrieve("tween:options")){this.set("tween",a)}this.store("tween",new Fx.Tween(this,this.retrieve("tween:options")))}return this.retrieve("tween")}};Element.implement({tween:function(a,c,b){this.get("tween").start(arguments);return this},fade:function(c){var f=this.get("tween"),d="opacity",a;c=$pick(c,"toggle");switch(c){case"in":f.start(d,1);break;case"out":f.start(d,0);break;case"show":f.set(d,1);break;case"hide":f.set(d,0);break;case"toggle":var b=this.retrieve("fade:flag",this.get("opacity")==1);f.start(d,(b)?0:1);this.store("fade:flag",!b);a=true;break;default:f.start(d,arguments)}if(!a){this.eliminate("fade:flag")}return this},highlight:function(c,a){if(!a){a=this.retrieve("highlight:original",this.getStyle("background-color"));a=(a=="transparent")?"#fff":a}var b=this.get("tween");b.start("background-color",c||"#ffff88",a).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original"));b.callChain()}.bind(this));return this}});var Request=new Class({Implements:[Chain,Events,Options],options:{url:"",data:"",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},async:true,format:false,method:"post",link:"ignore",isSuccess:null,emulation:true,urlEncoded:true,encoding:"utf-8",evalScripts:false,evalResponse:false,noCache:false},initialize:function(a){this.xhr=new Browser.Request();this.setOptions(a);this.options.isSuccess=this.options.isSuccess||this.isSuccess;this.headers=new Hash(this.options.headers)},onStateChange:function(){if(this.xhr.readyState!=4||!this.running){return}this.running=false;this.status=0;$try(function(){this.status=this.xhr.status}.bind(this));this.xhr.onreadystatechange=$empty;if(this.options.isSuccess.call(this,this.status)){this.response={text:this.xhr.responseText,xml:this.xhr.responseXML};this.success(this.response.text,this.response.xml)}else{this.response={text:null,xml:null};this.failure()}},isSuccess:function(){return((this.status>=200)&&(this.status<300))},processScripts:function(a){if(this.options.evalResponse||(/(ecma|java)script/).test(this.getHeader("Content-type"))){return $exec(a)}return a.stripScripts(this.options.evalScripts)},success:function(b,a){this.onSuccess(this.processScripts(b),a)},onSuccess:function(){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain()},failure:function(){this.onFailure()},onFailure:function(){this.fireEvent("complete").fireEvent("failure",this.xhr)},setHeader:function(a,b){this.headers.set(a,b);return this},getHeader:function(a){return $try(function(){return this.xhr.getResponseHeader(a)}.bind(this))},check:function(){if(!this.running){return true}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.bind(this,arguments));return false}return false},send:function(l){if(!this.check(l)){return this}this.running=true;var j=$type(l);if(j=="string"||j=="element"){l={data:l}}var d=this.options;l=$extend({data:d.data,url:d.url,method:d.method},l);var h=l.data,b=String(l.url),a=l.method.toLowerCase();switch($type(h)){case"element":h=document.id(h).toQueryString();break;case"object":case"hash":h=Hash.toQueryString(h)}if(this.options.format){var k="format="+this.options.format;h=(h)?k+"&"+h:k}if(this.options.emulation&&!["get","post"].contains(a)){var i="_method="+a;h=(h)?i+"&"+h:i;a="post"}if(this.options.urlEncoded&&a=="post"){var c=(this.options.encoding)?"; charset="+this.options.encoding:"";this.headers.set("Content-type","application/x-www-form-urlencoded"+c)}if(this.options.noCache){var g="noCache="+new Date().getTime();h=(h)?g+"&"+h:g}var f=b.lastIndexOf("/");if(f>-1&&(f=b.indexOf("#"))>-1){b=b.substr(0,f)}if(h&&a=="get"){b=b+(b.contains("?")?"&":"?")+h;h=null}this.xhr.open(a.toUpperCase(),b,this.options.async);this.xhr.onreadystatechange=this.onStateChange.bind(this);this.headers.each(function(n,m){try{this.xhr.setRequestHeader(m,n)}catch(o){this.fireEvent("exception",[m,n])}},this);this.fireEvent("request");this.xhr.send(h);if(!this.options.async){this.onStateChange()}return this},cancel:function(){if(!this.running){return this}this.running=false;this.xhr.abort();this.xhr.onreadystatechange=$empty;this.xhr=new Browser.Request();this.fireEvent("cancel");return this}});(function(){var a={};["get","post","put","delete","GET","POST","PUT","DELETE"].each(function(b){a[b]=function(){var c=Array.link(arguments,{url:String.type,data:$defined});return this.send($extend(c,{method:b}))}});Request.implement(a)})();Element.Properties.send={set:function(a){var b=this.retrieve("send");if(b){b.cancel()}return this.eliminate("send").store("send:options",$extend({data:this,link:"cancel",method:this.get("method")||"post",url:this.get("action")},a))},get:function(a){if(a||!this.retrieve("send")){if(a||!this.retrieve("send:options")){this.set("send",a)}this.store("send",new Request(this.retrieve("send:options")))}return this.retrieve("send")}};Element.implement({send:function(a){var b=this.get("send");b.send({data:this,url:a||b.options.url});return this}});Request.HTML=new Class({Extends:Request,options:{update:false,append:false,evalScripts:true,filter:false},processHTML:function(c){var b=c.match(/<body[^>]*>([\s\S]*?)<\/body>/i);c=(b)?b[1]:c;var a=new Element("div");return $try(function(){var d="<root>"+c+"</root>",h;if(Browser.Engine.trident){h=new ActiveXObject("Microsoft.XMLDOM");h.async=false;h.loadXML(d)}else{h=new DOMParser().parseFromString(d,"text/xml")}d=h.getElementsByTagName("root")[0];if(!d){return null}for(var g=0,f=d.childNodes.length;g<f;g++){var j=Element.clone(d.childNodes[g],true,true);if(j){a.grab(j)}}return a})||a.set("html",c)},success:function(d){var c=this.options,b=this.response;b.html=d.stripScripts(function(f){b.javascript=f});var a=this.processHTML(b.html);b.tree=a.childNodes;b.elements=a.getElements("*");if(c.filter){b.tree=b.elements.filter(c.filter)}if(c.update){document.id(c.update).empty().set("html",b.html)}else{if(c.append){document.id(c.append).adopt(a.getChildren())}}if(c.evalScripts){$exec(b.javascript)}this.onSuccess(b.tree,b.elements,b.html,b.javascript)}});Element.Properties.load={set:function(a){var b=this.retrieve("load");if(b){b.cancel()}return this.eliminate("load").store("load:options",$extend({data:this,link:"cancel",update:this,method:"get"},a))},get:function(a){if(a||!this.retrieve("load")){if(a||!this.retrieve("load:options")){this.set("load",a)}this.store("load",new Request.HTML(this.retrieve("load:options")))}return this.retrieve("load")}};Element.implement({load:function(){this.get("load").send(Array.link(arguments,{data:Object.type,url:String.type}));return this}});var JSON=new Hash(this.JSON&&{stringify:JSON.stringify,parse:JSON.parse}).extend({$specialChars:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},$replaceChars:function(a){return JSON.$specialChars[a]||"\\u00"+Math.floor(a.charCodeAt()/16).toString(16)+(a.charCodeAt()%16).toString(16)},encode:function(b){switch($type(b)){case"string":return'"'+b.replace(/[\x00-\x1f\\"]/g,JSON.$replaceChars)+'"';case"array":return"["+String(b.map(JSON.encode).clean())+"]";case"object":case"hash":var a=[];Hash.each(b,function(f,d){var c=JSON.encode(f);if(c){a.push(JSON.encode(d)+":"+c)}});return"{"+a+"}";case"number":case"boolean":return String(b);case false:return"null"}return null},decode:function(string,secure){if($type(string)!="string"||!string.length){return null}if(secure&&!(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(string.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""))){return null}return eval("("+string+")")}});Request.JSON=new Class({Extends:Request,options:{secure:true},initialize:function(a){this.parent(a);this.headers.extend({Accept:"application/json","X-Request":"JSON"})},success:function(a){this.response.json=JSON.decode(a,this.options.secure);this.onSuccess(this.response.json,a)}});var Cookie=new Class({Implements:Options,options:{path:false,domain:false,duration:false,secure:false,document:document},initialize:function(b,a){this.key=b;this.setOptions(a)},write:function(b){b=encodeURIComponent(b);if(this.options.domain){b+="; domain="+this.options.domain}if(this.options.path){b+="; path="+this.options.path}if(this.options.duration){var a=new Date();a.setTime(a.getTime()+this.options.duration*24*60*60*1000);b+="; expires="+a.toGMTString()}if(this.options.secure){b+="; secure"}this.options.document.cookie=this.key+"="+b;return this},read:function(){var a=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return(a)?decodeURIComponent(a[1]):null},dispose:function(){new Cookie(this.key,$merge(this.options,{duration:-1})).write("");return this}});Cookie.write=function(b,c,a){return new Cookie(b,a).write(c)};Cookie.read=function(a){return new Cookie(a).read()};Cookie.dispose=function(b,a){return new Cookie(b,a).dispose()};Element.Events.domready={onAdd:function(a){if(Browser.loaded){a.call(this)}}};(function(){var b=function(){if(Browser.loaded){return}Browser.loaded=true;window.fireEvent("domready");document.fireEvent("domready")};window.addEvent("load",b);if(Browser.Engine.trident){var a=document.createElement("div");(function(){($try(function(){a.doScroll();return document.id(a).inject(document.body).set("html","temp").dispose()}))?b():arguments.callee.delay(50)})()}else{if(Browser.Engine.webkit&&Browser.Engine.version<525){(function(){(["loaded","complete"].contains(document.readyState))?b():arguments.callee.delay(50)})()}else{document.addEvent("DOMContentLoaded",b)}}})();Native.implement([Document,Element],{getElements:function(j,h){j=j.split(",");var c,f={};for(var d=0,b=j.length;d<b;d++){var a=j[d],g=Selectors.Utils.search(this,a,f);if(d!=0&&g.item){g=$A(g)}c=(d==0)?g:(c.item)?$A(c).concat(g):c.concat(g)}return new Elements(c,{ddup:(j.length>1),cash:!h})}});Element.implement({match:function(b){if(!b||(b==this)){return true}var d=Selectors.Utils.parseTagAndID(b);var a=d[0],f=d[1];if(!Selectors.Filters.byID(this,f)||!Selectors.Filters.byTag(this,a)){return false}var c=Selectors.Utils.parseSelector(b);return(c)?Selectors.Utils.filter(this,c,{}):true}});var Selectors={Cache:{nth:{},parsed:{}}};Selectors.RegExps={id:(/#([\w-]+)/),tag:(/^(\w+|\*)/),quick:(/^(\w+|\*)$/),splitter:(/\s*([+>~\s])\s*([a-zA-Z#.*:\[])/g),combined:(/\.([\w-]+)|\[(\w+)(?:([!*^$~|]?=)(["']?)([^\4]*?)\4)?\]|:([\w-]+)(?:\(["']?(.*?)?["']?\)|$)/g)};Selectors.Utils={chk:function(b,c){if(!c){return true}var a=$uid(b);if(!c[a]){return c[a]=true}return false},parseNthArgument:function(i){if(Selectors.Cache.nth[i]){return Selectors.Cache.nth[i]}var f=i.match(/^([+-]?\d*)?([a-z]+)?([+-]?\d*)?$/);if(!f){return false}var h=parseInt(f[1],10);var d=(h||h===0)?h:1;var g=f[2]||false;var c=parseInt(f[3],10)||0;if(d!=0){c--;while(c<1){c+=d}while(c>=d){c-=d}}else{d=c;g="index"}switch(g){case"n":f={a:d,b:c,special:"n"};break;case"odd":f={a:2,b:0,special:"n"};break;case"even":f={a:2,b:1,special:"n"};break;case"first":f={a:0,special:"index"};break;case"last":f={special:"last-child"};break;case"only":f={special:"only-child"};break;default:f={a:(d-1),special:"index"}}return Selectors.Cache.nth[i]=f},parseSelector:function(f){if(Selectors.Cache.parsed[f]){return Selectors.Cache.parsed[f]}var d,i={classes:[],pseudos:[],attributes:[]};while((d=Selectors.RegExps.combined.exec(f))){var j=d[1],h=d[2],g=d[3],b=d[5],c=d[6],k=d[7];if(j){i.classes.push(j)}else{if(c){var a=Selectors.Pseudo.get(c);if(a){i.pseudos.push({parser:a,argument:k})}else{i.attributes.push({name:c,operator:"=",value:k})}}else{if(h){i.attributes.push({name:h,operator:g,value:b})}}}}if(!i.classes.length){delete i.classes}if(!i.attributes.length){delete i.attributes}if(!i.pseudos.length){delete i.pseudos}if(!i.classes&&!i.attributes&&!i.pseudos){i=null}return Selectors.Cache.parsed[f]=i},parseTagAndID:function(b){var a=b.match(Selectors.RegExps.tag);var c=b.match(Selectors.RegExps.id);return[(a)?a[1]:"*",(c)?c[1]:false]},filter:function(g,c,f){var d;if(c.classes){for(d=c.classes.length;d--;d){var h=c.classes[d];if(!Selectors.Filters.byClass(g,h)){return false}}}if(c.attributes){for(d=c.attributes.length;d--;d){var b=c.attributes[d];if(!Selectors.Filters.byAttribute(g,b.name,b.operator,b.value)){return false}}}if(c.pseudos){for(d=c.pseudos.length;d--;d){var a=c.pseudos[d];if(!Selectors.Filters.byPseudo(g,a.parser,a.argument,f)){return false}}}return true},getByTagAndID:function(b,a,d){if(d){var c=(b.getElementById)?b.getElementById(d,true):Element.getElementById(b,d,true);return(c&&Selectors.Filters.byTag(c,a))?[c]:[]}else{return b.getElementsByTagName(a)}},search:function(p,o,u){var b=[];var c=o.trim().replace(Selectors.RegExps.splitter,function(k,j,i){b.push(j);return":)"+i}).split(":)");var q,f,C;for(var B=0,x=c.length;B<x;B++){var A=c[B];if(B==0&&Selectors.RegExps.quick.test(A)){q=p.getElementsByTagName(A);continue}var a=b[B-1];var r=Selectors.Utils.parseTagAndID(A);var D=r[0],s=r[1];if(B==0){q=Selectors.Utils.getByTagAndID(p,D,s)}else{var d={},h=[];for(var z=0,y=q.length;z<y;z++){h=Selectors.Getters[a](h,q[z],D,s,d)}q=h}var g=Selectors.Utils.parseSelector(A);if(g){f=[];for(var v=0,t=q.length;v<t;v++){C=q[v];if(Selectors.Utils.filter(C,g,u)){f.push(C)}}q=f}}return q}};Selectors.Getters={" ":function(j,h,k,a,f){var d=Selectors.Utils.getByTagAndID(h,k,a);for(var c=0,b=d.length;c<b;c++){var g=d[c];if(Selectors.Utils.chk(g,f)){j.push(g)}}return j},">":function(j,h,k,a,g){var c=Selectors.Utils.getByTagAndID(h,k,a);for(var f=0,d=c.length;f<d;f++){var b=c[f];if(b.parentNode==h&&Selectors.Utils.chk(b,g)){j.push(b)}}return j},"+":function(c,b,a,f,d){while((b=b.nextSibling)){if(b.nodeType==1){if(Selectors.Utils.chk(b,d)&&Selectors.Filters.byTag(b,a)&&Selectors.Filters.byID(b,f)){c.push(b)}break}}return c},"~":function(c,b,a,f,d){while((b=b.nextSibling)){if(b.nodeType==1){if(!Selectors.Utils.chk(b,d)){break}if(Selectors.Filters.byTag(b,a)&&Selectors.Filters.byID(b,f)){c.push(b)}}}return c}};Selectors.Filters={byTag:function(b,a){return(a=="*"||(b.tagName&&b.tagName.toLowerCase()==a))},byID:function(a,b){return(!b||(a.id&&a.id==b))},byClass:function(b,a){return(b.className&&b.className.contains&&b.className.contains(a," "))},byPseudo:function(a,d,c,b){return d.call(a,c,b)},byAttribute:function(c,d,b,f){var a=Element.prototype.getProperty.call(c,d);if(!a){return(b=="!=")}if(!b||f==undefined){return true}switch(b){case"=":return(a==f);case"*=":return(a.contains(f));case"^=":return(a.substr(0,f.length)==f);case"$=":return(a.substr(a.length-f.length)==f);case"!=":return(a!=f);case"~=":return a.contains(f," ");case"|=":return a.contains(f,"-")}return false}};Selectors.Pseudo=new Hash({checked:function(){return this.checked},empty:function(){return !(this.innerText||this.textContent||"").length},not:function(a){return !Element.match(this,a)},contains:function(a){return(this.innerText||this.textContent||"").contains(a)},"first-child":function(){return Selectors.Pseudo.index.call(this,0)},"last-child":function(){var a=this;while((a=a.nextSibling)){if(a.nodeType==1){return false}}return true},"only-child":function(){var b=this;while((b=b.previousSibling)){if(b.nodeType==1){return false}}var a=this;while((a=a.nextSibling)){if(a.nodeType==1){return false}}return true},"nth-child":function(h,f){h=(h==undefined)?"n":h;var c=Selectors.Utils.parseNthArgument(h);if(c.special!="n"){return Selectors.Pseudo[c.special].call(this,c.a,f)}var g=0;f.positions=f.positions||{};var d=$uid(this);if(!f.positions[d]){var b=this;while((b=b.previousSibling)){if(b.nodeType!=1){continue}g++;var a=f.positions[$uid(b)];if(a!=undefined){g=a+g;break}}f.positions[d]=g}return(f.positions[d]%c.a==c.b)},index:function(a){var b=this,c=0;while((b=b.previousSibling)){if(b.nodeType==1&&++c>a){return false}}return(c==a)},even:function(b,a){return Selectors.Pseudo["nth-child"].call(this,"2n+1",a)},odd:function(b,a){return Selectors.Pseudo["nth-child"].call(this,"2n",a)},selected:function(){return this.selected},enabled:function(){return(this.disabled===false)}});var Swiff=new Class({Implements:[Options],options:{id:null,height:1,width:1,container:null,properties:{},params:{quality:"high",allowScriptAccess:"always",wMode:"transparent",swLiveConnect:true},callBacks:{},vars:{}},toElement:function(){return this.object},initialize:function(m,n){this.instance="Swiff_"+$time();this.setOptions(n);n=this.options;var b=this.id=n.id||this.instance;var a=document.id(n.container);Swiff.CallBacks[this.instance]={};var f=n.params,h=n.vars,g=n.callBacks;var i=$extend({height:n.height,width:n.width},n.properties);var l=this;for(var d in g){Swiff.CallBacks[this.instance][d]=(function(o){return function(){return o.apply(l.object,arguments)}})(g[d]);h[d]="Swiff.CallBacks."+this.instance+"."+d}f.flashVars=Hash.toQueryString(h);if(Browser.Engine.trident){i.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000";f.movie=m}else{i.type="application/x-shockwave-flash";i.data=m}var k='<object id="'+b+'"';for(var j in i){k+=" "+j+'="'+i[j]+'"'}k+=">";for(var c in f){if(f[c]){k+='<param name="'+c+'" value="'+f[c]+'" />'}}k+="</object>";this.object=((a)?a.empty():new Element("div")).set("html",k).firstChild},replaces:function(a){a=document.id(a,true);a.parentNode.replaceChild(this.toElement(),a);return this},inject:function(a){document.id(a,true).appendChild(this.toElement());return this},remote:function(){return Swiff.remote.apply(Swiff,[this.toElement()].extend(arguments))}});Swiff.CallBacks={};Swiff.remote=function(obj,fn){var rs=obj.CallFunction('<invoke name="'+fn+'" returntype="javascript">'+__flash__argumentsToXML(arguments,2)+"</invoke>");return eval(rs)};MooTools.More={version:"1.2.5.1",build:"254884f2b83651bf95260eed5c6cceb838e22d8e"};Class.Mutators.Binds=function(a){return a};Class.Mutators.initialize=function(a){return function(){$splat(this.Binds).each(function(b){var c=this[b];if(c){this[b]=c.bind(this)}},this);return a.apply(this,arguments)}};Element.implement({measure:function(f){var h=function(i){return !!(!i||i.offsetHeight||i.offsetWidth)};if(h(this)){return f.apply(this)}var d=this.getParent(),g=[],b=[];while(!h(d)&&d!=document.body){b.push(d.expose());d=d.getParent()}var c=this.expose();var a=f.apply(this);c();b.each(function(i){i()});return a},expose:function(){if(this.getStyle("display")!="none"){return $empty}var a=this.style.cssText;this.setStyles({display:"block",position:"absolute",visibility:"hidden"});return function(){this.style.cssText=a}.bind(this)},getDimensions:function(a){a=$merge({computeSize:false},a);var f={};var d=function(h,g){return(g.computeSize)?h.getComputedSize(g):h.getSize()};var b=this.getParent("body");if(b&&this.getStyle("display")=="none"){f=this.measure(function(){return d(this,a)})}else{if(b){try{f=d(this,a)}catch(c){}}else{f={x:0,y:0}}}return $chk(f.x)?$extend(f,{width:f.x,height:f.y}):$extend(f,{x:f.width,y:f.height})},getComputedSize:function(a){if(a&&a.plains){a.planes=a.plains}a=$merge({styles:["padding","border"],planes:{height:["top","bottom"],width:["left","right"]},mode:"both"},a);var c={width:0,height:0};switch(a.mode){case"vertical":delete c.width;delete a.planes.width;break;case"horizontal":delete c.height;delete a.planes.height;break}var b=[];$each(a.planes,function(g,h){g.each(function(i){a.styles.each(function(j){b.push((j=="border")?j+"-"+i+"-width":j+"-"+i)})})});var f={};b.each(function(g){f[g]=this.getComputedStyle(g)},this);var d=[];$each(a.planes,function(g,h){var i=h.capitalize();c["total"+i]=c["computed"+i]=0;g.each(function(j){c["computed"+j.capitalize()]=0;b.each(function(l,k){if(l.test(j)){f[l]=f[l].toInt()||0;c["total"+i]=c["total"+i]+f[l];c["computed"+j.capitalize()]=c["computed"+j.capitalize()]+f[l]}if(l.test(j)&&h!=l&&(l.test("border")||l.test("padding"))&&!d.contains(l)){d.push(l);c["computed"+i]=c["computed"+i]-f[l]}})})});["Width","Height"].each(function(h){var g=h.toLowerCase();if(!$chk(c[g])){return}c[g]=c[g]+this["offset"+h]+c["computed"+h];c["total"+h]=c[g]+c["total"+h];delete c["computed"+h]},this);return $extend(f,c)}});var Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:false,style:true,limit:false,handle:false,invert:false,preventDefault:false,stopPropagation:false,modifiers:{x:"left",y:"top"}},initialize:function(){var b=Array.link(arguments,{options:Object.type,element:$defined});this.element=document.id(b.element);this.document=this.element.getDocument();this.setOptions(b.options||{});var a=$type(this.options.handle);this.handles=((a=="array"||a=="collection")?$$(this.options.handle):document.id(this.options.handle))||this.element;this.mouse={now:{},pos:{}};this.value={start:{},now:{}};this.selection=(Browser.Engine.trident)?"selectstart":"mousedown";this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:$lambda(false)};this.attach()},attach:function(){this.handles.addEvent("mousedown",this.bound.start);return this},detach:function(){this.handles.removeEvent("mousedown",this.bound.start);return this},start:function(f){if(f.rightClick){return}if(this.options.preventDefault){f.preventDefault()}if(this.options.stopPropagation){f.stopPropagation()}this.mouse.start=f.page;this.fireEvent("beforeStart",this.element);var a=this.options.limit;this.limit={x:[],y:[]};var d=this.element.getStyles("left","right","top","bottom");this._invert={x:this.options.modifiers.x=="left"&&d.left=="auto"&&!isNaN(d.right.toInt())&&(this.options.modifiers.x="right"),y:this.options.modifiers.y=="top"&&d.top=="auto"&&!isNaN(d.bottom.toInt())&&(this.options.modifiers.y="bottom")};var h,g;for(h in this.options.modifiers){if(!this.options.modifiers[h]){continue}var c=this.element.getStyle(this.options.modifiers[h]);if(c&&!c.match(/px$/)){if(!g){g=this.element.getCoordinates(this.element.getOffsetParent())}c=g[this.options.modifiers[h]]}if(this.options.style){this.value.now[h]=(c||0).toInt()}else{this.value.now[h]=this.element[this.options.modifiers[h]]}if(this.options.invert){this.value.now[h]*=-1}if(this._invert[h]){this.value.now[h]*=-1}this.mouse.pos[h]=f.page[h]-this.value.now[h];if(a&&a[h]){for(var b=2;b--;b){if($chk(a[h][b])){this.limit[h][b]=$lambda(a[h][b])()}}}}if($type(this.options.grid)=="number"){this.options.grid={x:this.options.grid,y:this.options.grid}}this.document.addEvents({mousemove:this.bound.check,mouseup:this.bound.cancel});this.document.addEvent(this.selection,this.bound.eventStop)},check:function(a){if(this.options.preventDefault){a.preventDefault()}var b=Math.round(Math.sqrt(Math.pow(a.page.x-this.mouse.start.x,2)+Math.pow(a.page.y-this.mouse.start.y,2)));if(b>this.options.snap){this.cancel();this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop});this.fireEvent("start",[this.element,a]).fireEvent("snap",this.element)}},drag:function(a){if(this.options.preventDefault){a.preventDefault()}this.mouse.now=a.page;for(var b in this.options.modifiers){if(!this.options.modifiers[b]){continue}this.value.now[b]=this.mouse.now[b]-this.mouse.pos[b];if(this.options.invert){this.value.now[b]*=-1}if(this._invert[b]){this.value.now[b]*=-1}if(this.options.limit&&this.limit[b]){if($chk(this.limit[b][1])&&(this.value.now[b]>this.limit[b][1])){this.value.now[b]=this.limit[b][1]}else{if($chk(this.limit[b][0])&&(this.value.now[b]<this.limit[b][0])){this.value.now[b]=this.limit[b][0]}}}if(this.options.grid[b]){this.value.now[b]-=((this.value.now[b]-(this.limit[b][0]||0))%this.options.grid[b])}if(this.options.style){this.element.setStyle(this.options.modifiers[b],this.value.now[b]+this.options.unit)}else{this.element[this.options.modifiers[b]]=this.value.now[b]}}this.fireEvent("drag",[this.element,a])},cancel:function(a){this.document.removeEvent("mousemove",this.bound.check);this.document.removeEvent("mouseup",this.bound.cancel);if(a){this.document.removeEvent(this.selection,this.bound.eventStop);this.fireEvent("cancel",this.element)}},stop:function(a){this.document.removeEvent(this.selection,this.bound.eventStop);this.document.removeEvent("mousemove",this.bound.drag);this.document.removeEvent("mouseup",this.bound.stop);if(a){this.fireEvent("complete",[this.element,a])}}});Element.implement({makeResizable:function(a){var b=new Drag(this,$merge({modifiers:{x:"width",y:"height"}},a));this.store("resizer",b);return b.addEvent("drag",function(){this.fireEvent("resize",b)}.bind(this))}});var Slider=new Class({Implements:[Events,Options],Binds:["clickedElement","draggedKnob","scrolledElement"],options:{onTick:function(a){if(this.options.snap){a=this.toPosition(this.step)}this.knob.setStyle(this.property,a)},initialStep:0,snap:false,offset:0,range:false,wheel:false,steps:100,mode:"horizontal"},initialize:function(g,a,f){this.setOptions(f);this.element=document.id(g);this.knob=document.id(a);this.previousChange=this.previousEnd=this.step=-1;var h,b={},d={x:false,y:false};switch(this.options.mode){case"vertical":this.axis="y";this.property="top";h="offsetHeight";break;case"horizontal":this.axis="x";this.property="left";h="offsetWidth"}this.full=this.element.measure(function(){this.half=this.knob[h]/2;return this.element[h]-this.knob[h]+(this.options.offset*2)}.bind(this));this.setRange(this.options.range);this.knob.setStyle("position","relative").setStyle(this.property,-this.options.offset);d[this.axis]=this.property;b[this.axis]=[-this.options.offset,this.full-this.options.offset];var c={snap:0,limit:b,modifiers:d,onDrag:this.draggedKnob,onStart:this.draggedKnob,onBeforeStart:(function(){this.isDragging=true}).bind(this),onCancel:function(){this.isDragging=false}.bind(this),onComplete:function(){this.isDragging=false;this.draggedKnob();this.end()}.bind(this)};if(this.options.snap){c.grid=Math.ceil(this.stepWidth);c.limit[this.axis][1]=this.full}this.drag=new Drag(this.knob,c);this.attach();if(this.options.initialStep!=null){this.set(this.options.initialStep)}},attach:function(){this.element.addEvent("mousedown",this.clickedElement);if(this.options.wheel){this.element.addEvent("mousewheel",this.scrolledElement)}this.drag.attach();return this},detach:function(){this.element.removeEvent("mousedown",this.clickedElement);this.element.removeEvent("mousewheel",this.scrolledElement);this.drag.detach();return this},set:function(a){if(!((this.range>0)^(a<this.min))){a=this.min}if(!((this.range>0)^(a>this.max))){a=this.max}this.step=Math.round(a);this.checkStep();this.fireEvent("tick",this.toPosition(this.step));this.end();return this},setRange:function(a,b){this.min=$pick(a[0],0);this.max=$pick(a[1],this.options.steps);this.range=this.max-this.min;this.steps=this.options.steps||this.full;this.stepSize=Math.abs(this.range)/this.steps;this.stepWidth=this.stepSize*this.full/Math.abs(this.range);this.set($pick(b,this.step).floor(this.min).max(this.max));return this},clickedElement:function(c){if(this.isDragging||c.target==this.knob){return}var b=this.range<0?-1:1;var a=c.page[this.axis]-this.element.getPosition()[this.axis]-this.half;a=a.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+b*this.toStep(a));this.checkStep();this.fireEvent("tick",a);this.end()},scrolledElement:function(a){var b=(this.options.mode=="horizontal")?(a.wheel<0):(a.wheel>0);this.set(b?this.step-this.stepSize:this.step+this.stepSize);a.stop()},draggedKnob:function(){var b=this.range<0?-1:1;var a=this.drag.value.now[this.axis];a=a.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+b*this.toStep(a));this.checkStep()},checkStep:function(){if(this.previousChange!=this.step){this.previousChange=this.step;this.fireEvent("change",this.step)}},end:function(){if(this.previousEnd!==this.step){this.previousEnd=this.step;this.fireEvent("complete",this.step+"")}},toStep:function(a){var b=(a+this.options.offset)*this.stepSize/this.full*this.steps;return this.options.steps?Math.round(b-=b%this.stepSize):b},toPosition:function(a){return(this.full*Math.abs(this.min-a))/(this.steps*this.stepSize)-this.options.offset}});var Color=new Native({initialize:function(b,c){if(arguments.length>=3){c="rgb";b=Array.slice(arguments,0,3)}else{if(typeof b=="string"){if(b.match(/rgb/)){b=b.rgbToHex().hexToRgb(true)}else{if(b.match(/hsb/)){b=b.hsbToRgb()}else{b=b.hexToRgb(true)}}}}c=c||"rgb";switch(c){case"hsb":var a=b;b=b.hsbToRgb();b.hsb=a;break;case"hex":b=b.hexToRgb(true);break}b.rgb=b.slice(0,3);b.hsb=b.hsb||b.rgbToHsb();b.hex=b.rgbToHex();return $extend(b,this)}});Color.implement({mix:function(){var a=Array.slice(arguments);var c=($type(a.getLast())=="number")?a.pop():50;var b=this.slice();a.each(function(d){d=new Color(d);for(var f=0;f<3;f++){b[f]=Math.round((b[f]/100*(100-c))+(d[f]/100*c))}});return new Color(b,"rgb")},invert:function(){return new Color(this.map(function(a){return 255-a}))},setHue:function(a){return new Color([a,this.hsb[1],this.hsb[2]],"hsb")},setSaturation:function(a){return new Color([this.hsb[0],a,this.hsb[2]],"hsb")},setBrightness:function(a){return new Color([this.hsb[0],this.hsb[1],a],"hsb")}});var $RGB=function(d,c,a){return new Color([d,c,a],"rgb")};var $HSB=function(d,c,a){return new Color([d,c,a],"hsb")};var $HEX=function(a){return new Color(a,"hex")};Array.implement({rgbToHsb:function(){var b=this[0],c=this[1],k=this[2],h=0;var j=Math.max(b,c,k),f=Math.min(b,c,k);var l=j-f;var i=j/255,g=(j!=0)?l/j:0;if(g!=0){var d=(j-b)/l;var a=(j-c)/l;var m=(j-k)/l;if(b==j){h=m-a}else{if(c==j){h=2+d-m}else{h=4+a-d}}h/=6;if(h<0){h++}}return[Math.round(h*360),Math.round(g*100),Math.round(i*100)]},hsbToRgb:function(){var c=Math.round(this[2]/100*255);if(this[1]==0){return[c,c,c]}else{var a=this[0]%360;var g=a%60;var h=Math.round((this[2]*(100-this[1]))/10000*255);var d=Math.round((this[2]*(6000-this[1]*g))/600000*255);var b=Math.round((this[2]*(6000-this[1]*(60-g)))/600000*255);switch(Math.floor(a/60)){case 0:return[c,b,h];case 1:return[d,c,h];case 2:return[h,c,b];case 3:return[h,d,c];case 4:return[b,h,c];case 5:return[c,h,d]}}return false}});String.implement({rgbToHsb:function(){var a=this.match(/\d{1,3}/g);return(a)?a.rgbToHsb():null},hsbToRgb:function(){var a=this.match(/\d{1,3}/g);return(a)?a.hsbToRgb():null}});Hash.Cookie=new Class({Extends:Cookie,options:{autoSave:true},initialize:function(b,a){this.parent(b,a);this.load()},save:function(){var a=JSON.encode(this.hash);if(!a||a.length>4096){return false}if(a=="{}"){this.dispose()}else{this.write(a)}return true},load:function(){this.hash=new Hash(JSON.decode(this.read(),true));return this}});Hash.each(Hash.prototype,function(b,a){if(typeof b=="function"){Hash.Cookie.implement(a,function(){var c=b.apply(this.hash,arguments);if(this.options.autoSave){this.save()}return c})}});var URI=new Class({Implements:Options,options:{},regex:/^(?:(\w+):)?(?:\/\/(?:(?:([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)?(\.\.?$|(?:[^?#\/]*\/)*)([^?#]*)(?:\?([^#]*))?(?:#(.*))?/,parts:["scheme","user","password","host","port","directory","file","query","fragment"],schemes:{http:80,https:443,ftp:21,rtsp:554,mms:1755,file:0},initialize:function(b,a){this.setOptions(a);var c=this.options.base||URI.base;if(!b){b=c}if(b&&b.parsed){this.parsed=$unlink(b.parsed)}else{this.set("value",b.href||b.toString(),c?new URI(c):false)}},parse:function(c,b){var a=c.match(this.regex);if(!a){return false}a.shift();return this.merge(a.associate(this.parts),b)},merge:function(b,a){if((!b||!b.scheme)&&(!a||!a.scheme)){return false}if(a){this.parts.every(function(c){if(b[c]){return false}b[c]=a[c]||"";return true})}b.port=b.port||this.schemes[b.scheme.toLowerCase()];b.directory=b.directory?this.parseDirectory(b.directory,a?a.directory:""):"/";return b},parseDirectory:function(b,c){b=(b.substr(0,1)=="/"?"":(c||"/"))+b;if(!b.test(URI.regs.directoryDot)){return b}var a=[];b.replace(URI.regs.endSlash,"").split("/").each(function(d){if(d==".."&&a.length>0){a.pop()}else{if(d!="."){a.push(d)}}});return a.join("/")+"/"},combine:function(a){return a.value||a.scheme+"://"+(a.user?a.user+(a.password?":"+a.password:"")+"@":"")+(a.host||"")+(a.port&&a.port!=this.schemes[a.scheme]?":"+a.port:"")+(a.directory||"/")+(a.file||"")+(a.query?"?"+a.query:"")+(a.fragment?"#"+a.fragment:"")},set:function(b,d,c){if(b=="value"){var a=d.match(URI.regs.scheme);if(a){a=a[1]}if(a&&!$defined(this.schemes[a.toLowerCase()])){this.parsed={scheme:a,value:d}}else{this.parsed=this.parse(d,(c||this).parsed)||(a?{scheme:a,value:d}:{value:d})}}else{if(b=="data"){this.setData(d)}else{this.parsed[b]=d}}return this},get:function(a,b){switch(a){case"value":return this.combine(this.parsed,b?b.parsed:false);case"data":return this.getData()}return this.parsed[a]||""},go:function(){document.location.href=this.toString()},toURI:function(){return this},getData:function(c,b){var a=this.get(b||"query");if(!$chk(a)){return c?null:{}}var d=a.parseQueryString();return c?d[c]:d},setData:function(a,c,b){if(typeof a=="string"){data=this.getData();data[arguments[0]]=arguments[1];a=data}else{if(c){a=$merge(this.getData(),a)}}return this.set(b||"query",Hash.toQueryString(a))},clearData:function(a){return this.set(a||"query","")}});URI.prototype.toString=URI.prototype.valueOf=function(){return this.get("value")};URI.regs={endSlash:/\/$/,scheme:/^(\w+):/,directoryDot:/\.\/|\.$/};URI.base=new URI(document.getElements("base[href]",true).getLast(),{base:document.location});String.implement({toURI:function(a){return new URI(this,a)}});var qwebirc={ui:{themes:{},style:{}},irc:{},util:{crypto:{}},config:{},auth:{},sound:{},connected:false,xdomain:{}};if(typeof QWEBIRC_BUILD!="undefined"){qwebirc.BUILD=QWEBIRC_BUILD;qwebirc.FILE_SUFFIX="-"+QWEBIRC_BUILD}else{qwebirc.BUILD=null;qwebirc.FILE_SUFFIX=""}qwebirc.VERSION="1.02";QHash=function(c){this.__map={};this.length=0;if(c!==undefined){var b=Object.prototype.hasOwnProperty;for(var a in c){if(!b.call(c,a)){continue}this.put(a,c[a])}}};QHash.prototype.__toKey=function(a){if(typeof(a)!=="string"){throw new TypeError("Not a string: "+a)}return a+"$"};QHash.prototype.get=function(a){return this.__map[this.__toKey(a)]};QHash.prototype.put=function(b,d){b=this.__toKey(b);var c=b in this.__map;var a=this.__map[b];this.__map[b]=d;if(!c){this.length++;return null}return a};QHash.prototype.contains=function(a){return this.__toKey(a) in this.__map};QHash.prototype.remove=function(b){b=this.__toKey(b);var c=b in this.__map;if(!c){return null}var a=this.__map[b];delete this.__map[b];this.length--;return a};QHash.prototype.each=function(f,g){var d=Object.prototype.hasOwnProperty;var a=this.__map;for(var b in a){if(!d.call(a,b)){continue}var c=f.call(g,b.substr(0,b.length-1),a[b])!==undefined;if(c){return c}}};QHash.prototype.isEmpty=function(){return this.length==0};QHash.prototype.map=function(b,c){var a=[];this.each(function(f,d){a.push(b.call(c,f,d))});return a};QHash.prototype.keys=function(){return this.map(function(a){return a})};QHash.prototype.values=function(){return this.map(function(b,a){return a})};QHash.prototype.items=function(){return this.map(function(b,a){return[b,a]})};QHash.prototype.toString=function(){var a=this.map(function(c,b){return c+"="+b},this);return"{QHash length="+this.length+" map={"+a+"}}"};QSet=function(){this.__map=new QHash();this.length=0;for(var a=0;a<arguments.length;a++){this.add(arguments[a])}};QSet.prototype.add=function(b){var a=this.__map.put(b,true);if(a!==true){this.length=this.__map.length}return a};QSet.prototype.contains=function(a){return this.__map.contains(a)};QSet.prototype.remove=function(b){var a=this.__map.remove(b,true);if(a){this.length=this.__map.length}return a};QSet.prototype.each=function(a,b){return this.__map.each(a,b)};QSet.prototype.values=function(){return this.__map.keys()};QSet.prototype.isEmpty=function(){return this.length==0};QSet.prototype.map=function(a,b){return this.__map.map(a,b)};QSet.prototype.toString=function(a){return"{QSet length="+this.length+" set={"+this.values()+"}}"};Array.prototype.indexFromEnd=function(b){var a=this;if(b<0){return a[a.length+b]}return a[b]};qwebirc.util.dictCopy=function(b){var c={};for(var a in b){c[a]=b[a]}return c};String.prototype.replaceAll=function(d,b){var a=this.indexOf(d);var g=this;while(a>-1){g=g.replace(d,b);a=g.indexOf(d)}return g};String.prototype.splitMax=function(d,a){var b=this.split(d);var c=b.slice(0,a-1);if(b.length>=a){c.push(b.slice(a-1).join(d))}return c};qwebirc.util.parseURI=function(g){var b=new QHash();var h=g.indexOf("?");if(h==-1){return b}var a=g.substring(h+1);var c=a.split("&");for(var d=0;d<c.length;d++){var f=c[d].splitMax("=",2);if(f.length<2){continue}b.put(unescape(f[0]),unescape(f[1]))}return b};qwebirc.util.DaysOfWeek={0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"};qwebirc.util.MonthsOfYear={0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"};qwebirc.util.NBSPCreate=function(g,c){var f=g.split("  ");for(var b=0;b<f.length;b++){var a=document.createTextNode(f[b]);c.appendChild(a);if(b!=f.length-1){var d=new Element("span");d.set("html","&nbsp;&nbsp;");c.appendChild(d)}}};qwebirc.util.longtoduration=function(b){var d=b%60;var c=Math.floor((b%3600)/60);var a=Math.floor((b%(3600*24))/3600);var f=Math.floor(b/(24*3600));return f+" days "+a+" hours "+c+" minutes "+d+" seconds"};qwebirc.util.pad=function(a){a=""+a;if(a.length==1){return"0"+a}return a};RegExp.escape=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};RegExp.fromIRCPattern=function(d){var d=d.replace(/[-[\]{}()+,\\^$|#\s]/g,"\\$&");d=d.split("");var a=[];for(var b=0;b<d.length;b++){var f=d[b];switch(f){case".":a.push("\\.");break;case"?":a.push(".");break;case"*":a.push(".*");break;default:a.push(f)}}return a.join("")};qwebirc.ui.insertAt=function(a,c,b){if(!c.childNodes||(a>=c.childNodes.length)){c.appendChild(b)}else{c.insertBefore(b,c.childNodes[a])}};qwebirc.util.setCaretPos=function(b,c){if($defined(b.selectionStart)){b.focus();b.setSelectionRange(c,c)}else{if(b.createTextRange){var a=b.createTextRange();a.move("character",c);a.select()}}};qwebirc.util.setAtEnd=function(a){qwebirc.util.setCaretPos(a.value.length)};qwebirc.util.getCaretPos=function(a){if($defined(a.selectionStart)){return a.selectionStart}if(document.selection){a.focus();var b=document.selection.createRange();b.moveStart("character",-a.value.length);return b.text.length}};qwebirc.util.browserVersion=function(){return navigator.userAgent};qwebirc.util.getEnclosedWord=function(f,a){var b=f.split("");var c=[];if(f==""){return}var h=a-1;if(h<0){h=0}else{for(;h>=0;h--){if(b[h]==" "){h=h+1;break}}}if(h<0){h=0}var d=f.substring(h);var g=d.indexOf(" ");if(g!=-1){d=d.substring(0,g)}return[h,d]};String.prototype.startsWith=function(a){return this.substring(0,a.length)==a};String.prototype.endsWith=function(a){return this.substring(this.length-a.length,this.length)==a};qwebirc.util.randHexString=function(b){var d=function(){return(((1+Math.random())*256)|0).toString(16).substring(1)};var a=[];for(var c=0;c<b;c++){a.push(d())}return a.join("")};qwebirc.util.importJS=function(name,watchFor,onload){var script=document.createElement("script");script.type="text/javascript";script.src=name;if(Browser.Engine.trident){var checkFn=function(){if(eval("typeof "+watchFor)!="undefined"){onload()}else{checkFn.delay(100)}};checkFn()}else{script.onload=onload}document.getElementsByTagName("head")[0].appendChild(script)};qwebirc.util.createInput=function(k,l,b,f,c){var d=false;var a;if(b){b="__input"+b}if(Browser.Engine.trident){var i;if(b){i=' name="'+escape(b)+'"'}else{i=""}try{var g='<input type="'+k+'"'+i+"/>";a=$(document.createElement(g));if(k=="radio"){a.addEvent("click",function(){$(document.body).getElements("input[name="+b+"]").forEach(function(h){h.setAttribute("defaultChecked",h.checked?"defaultChecked":"")})})}d=true}catch(j){}}if(!d){a=new Element("input");a.setAttribute("type",k)}if(b){a.setAttribute("name",b)}if(c){a.setAttribute("id",c)}if(f){a.setAttribute("checked","checked");if(k=="radio"&&Browser.Engine.trident){a.setAttribute("defaultChecked","defaultChecked")}}l.appendChild(a);return a};qwebirc.util.composeAnd=function(){var a=arguments;return function(){for(var b=0;b<a.length;b++){if(!a[b].apply(this,arguments)){return false}}return true}};qwebirc.util.invertFn=function(a){return function(){return !a.apply(this,arguments)}};qwebirc.util.deviceHasKeyboard=function(){var b=function(){if(Browser.Engine.ipod){return true}var h=["Nintendo Wii"," PIE","BlackBerry","IEMobile","Windows CE","Nokia","Opera Mini","Mobile","mobile","Pocket","pocket","Android"];var g=["Chrome","Firefox","Camino","Iceweasel","K-Meleon","Konqueror","SeaMonkey","Windows NT","Windows 9"];var f=navigator.userAgent;var d=function(i){return f.indexOf(i)>-1};for(var c=0;c<h.length;c++){if(d(h[c])){return false}}for(var c=0;c<g.length;c++){if(d(g[c])){return true}}return false};var a=b();qwebirc.util.deviceHasKeyboard=function(){return a};return a};qwebirc.util.generateID_ID=0;qwebirc.util.generateID=function(){return"qqa-"+qwebirc.util.generateID_ID++};qwebirc.util.arrayCmp=function(d,c){for(var h=0;h<d.length;h++){var f=d[h];var g=c[h];if(f==g){continue}if(f<g){return -1}return 1}return 0};qwebirc.util.__log=function(a){if(QWEBIRC_DEBUG){if(typeof console=="undefined"){alert("log: "+a)}else{console.log(a)}}};qwebirc.util.logger={log:function(a){qwebirc.util.__log("L "+a)},info:function(a){qwebirc.util.__log("I "+a)},error:function(a){qwebirc.util.__log("E "+a)},warn:function(a){qwebirc.util.__log("W "+a)}};qwebirc.util.log=qwebirc.util.logger.log;var B64TABLE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",B64RE=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/;qwebirc.util.b64Encode=function(h){h=String(h);var l,g,f,m,d="",j=0,k=h.length%3;for(;j<h.length;){if((g=h.charCodeAt(j++))>255||(f=h.charCodeAt(j++))>255||(m=h.charCodeAt(j++))>255){throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.")}l=(g<<16)|(f<<8)|m;d+=B64TABLE.charAt(l>>18&63)+B64TABLE.charAt(l>>12&63)+B64TABLE.charAt(l>>6&63)+B64TABLE.charAt(l&63)}return k?d.slice(0,k-3)+"===".substring(k):d};qwebirc.util.b64Decode=function(d){d=String(d).replace(/[\t\n\f\r ]+/g,"");if(!B64RE.test(d)){throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.")}d+="==".slice(2-(d.length&3));var g,a="",c,b,f=0;for(;f<d.length;){g=B64TABLE.indexOf(d.charAt(f++))<<18|B64TABLE.indexOf(d.charAt(f++))<<12|(c=B64TABLE.indexOf(d.charAt(f++)))<<6|(b=B64TABLE.indexOf(d.charAt(f++)));a+=c===64?String.fromCharCode(g>>16&255):b===64?String.fromCharCode(g>>16&255,g>>8&255):String.fromCharCode(g>>16&255,g>>8&255,g&255)}return a};qwebirc.util.crypto.getARC4Stream=function(h,a){var m=[];var l=[];for(var f=0;f<h.length;f++){l.push(h.charCodeAt(f))}for(var f=0;f<256;f++){m[f]=f}var d=0;for(var f=0;f<256;f++){d=(d+m[f]+l[f%h.length])&255;var g=m[f];m[f]=m[d];m[d]=g}var b=[];var f=0;var d=0;for(var c=0;c<a;c++){f=(f+1)&255;d=(d+m[f])&255;var g=m[f];m[f]=m[d];m[d]=g;b.push(m[(m[f]+m[d])&255])}return b};qwebirc.util.crypto.xorStreams=function(c,d){if(c.length!=d.length){return}var a=[];for(var b=0;b<c.length;b++){a.push(String.fromCharCode(c.charCodeAt(b)^d[b]))}return a.join("")};qwebirc.util.crypto.ARC4=function(a,b){var c=qwebirc.util.crypto.getARC4Stream(a,b.length+1024);c=c.slice(1024);return qwebirc.util.crypto.xorStreams(b,c)};qwebirc.util.crypto.MD5=function(){this.digest=a;var g="0123456789abcdef";function f(n){var o="";for(var m=0;m<=3;m++){o+=g.charAt((n>>(m*8+4))&15)+g.charAt((n>>(m*8))&15)}return o}function h(o){var m=((o.length+8)>>6)+1;var p=new Array(m*16);for(var n=0;n<m*16;n++){p[n]=0}for(var n=0;n<o.length;n++){p[n>>2]|=o.charCodeAt(n)<<((n%4)*8)}p[n>>2]|=128<<((n%4)*8);p[m*16-2]=o.length*8;return p}function l(m,n){return((m&2147483647)+(n&2147483647))^(m&2147483648)^(n&2147483648)}function d(m,n){return(m<<n)|(m>>>(32-n))}function j(u,o,n,m,r,p){return l(d(l(l(o,u),l(m,p)),r),n)}function b(o,n,u,r,m,q,p){return j((n&u)|((~n)&r),o,n,m,q,p)}function i(o,n,u,r,m,q,p){return j((n&r)|(u&(~r)),o,n,m,q,p)}function c(o,n,u,r,m,q,p){return j(n^u^r,o,n,m,q,p)}function k(o,n,u,r,m,q,p){return j(u^(n|(~r)),o,n,m,q,p)}function a(t){var y=h(t);var v=1732584193;var u=4023233417;var s=2562383102;var r=271733878;for(var o=0;o<y.length;o+=16){var q=v;var p=u;var n=s;var m=r;v=b(v,u,s,r,y[o+0],7,3614090360);r=b(r,v,u,s,y[o+1],12,3905402710);s=b(s,r,v,u,y[o+2],17,606105819);u=b(u,s,r,v,y[o+3],22,3250441966);v=b(v,u,s,r,y[o+4],7,4118548399);r=b(r,v,u,s,y[o+5],12,1200080426);s=b(s,r,v,u,y[o+6],17,2821735955);u=b(u,s,r,v,y[o+7],22,4249261313);v=b(v,u,s,r,y[o+8],7,1770035416);r=b(r,v,u,s,y[o+9],12,2336552879);s=b(s,r,v,u,y[o+10],17,4294925233);u=b(u,s,r,v,y[o+11],22,2304563134);v=b(v,u,s,r,y[o+12],7,1804603682);r=b(r,v,u,s,y[o+13],12,4254626195);s=b(s,r,v,u,y[o+14],17,2792965006);u=b(u,s,r,v,y[o+15],22,1236535329);v=i(v,u,s,r,y[o+1],5,4129170786);r=i(r,v,u,s,y[o+6],9,3225465664);s=i(s,r,v,u,y[o+11],14,643717713);u=i(u,s,r,v,y[o+0],20,3921069994);v=i(v,u,s,r,y[o+5],5,3593408605);r=i(r,v,u,s,y[o+10],9,38016083);s=i(s,r,v,u,y[o+15],14,3634488961);u=i(u,s,r,v,y[o+4],20,3889429448);v=i(v,u,s,r,y[o+9],5,568446438);r=i(r,v,u,s,y[o+14],9,3275163606);s=i(s,r,v,u,y[o+3],14,4107603335);u=i(u,s,r,v,y[o+8],20,1163531501);v=i(v,u,s,r,y[o+13],5,2850285829);r=i(r,v,u,s,y[o+2],9,4243563512);s=i(s,r,v,u,y[o+7],14,1735328473);u=i(u,s,r,v,y[o+12],20,2368359562);v=c(v,u,s,r,y[o+5],4,4294588738);r=c(r,v,u,s,y[o+8],11,2272392833);s=c(s,r,v,u,y[o+11],16,1839030562);u=c(u,s,r,v,y[o+14],23,4259657740);v=c(v,u,s,r,y[o+1],4,2763975236);r=c(r,v,u,s,y[o+4],11,1272893353);s=c(s,r,v,u,y[o+7],16,4139469664);u=c(u,s,r,v,y[o+10],23,3200236656);v=c(v,u,s,r,y[o+13],4,681279174);r=c(r,v,u,s,y[o+0],11,3936430074);s=c(s,r,v,u,y[o+3],16,3572445317);u=c(u,s,r,v,y[o+6],23,76029189);v=c(v,u,s,r,y[o+9],4,3654602809);r=c(r,v,u,s,y[o+12],11,3873151461);s=c(s,r,v,u,y[o+15],16,530742520);u=c(u,s,r,v,y[o+2],23,3299628645);v=k(v,u,s,r,y[o+0],6,4096336452);r=k(r,v,u,s,y[o+7],10,1126891415);s=k(s,r,v,u,y[o+14],15,2878612391);u=k(u,s,r,v,y[o+5],21,4237533241);v=k(v,u,s,r,y[o+12],6,1700485571);r=k(r,v,u,s,y[o+3],10,2399980690);s=k(s,r,v,u,y[o+10],15,4293915773);u=k(u,s,r,v,y[o+1],21,2240044497);v=k(v,u,s,r,y[o+8],6,1873313359);r=k(r,v,u,s,y[o+15],10,4264355552);s=k(s,r,v,u,y[o+6],15,2734768916);u=k(u,s,r,v,y[o+13],21,1309151649);v=k(v,u,s,r,y[o+4],6,4149444226);r=k(r,v,u,s,y[o+11],10,3174756917);s=k(s,r,v,u,y[o+2],15,718787259);u=k(u,s,r,v,y[o+9],21,3951481745);v=l(v,q);u=l(u,p);s=l(s,n);r=l(r,m)}return f(v)+f(u)+f(s)+f(r)}};qwebirc.irc.IRCConnection=new Class({Implements:[Events,Options],options:{initialNickname:"ircconnX",minTimeout:45000,maxTimeout:5*60000,timeoutIncrement:10000,initialTimeout:30000,floodInterval:200,floodMax:10,floodReset:5000,errorAlert:true,maxRetries:5,serverPassword:null},log:function(a){qwebirc.util.log("IRCConnection "+a)},initialize:function(a){this.setOptions(a);this.initialNickname=this.options.initialNickname;this.counter=0;this.disconnected=false;this.__floodLastRequest=0;this.__floodCounter=0;this.__floodLastFlood=0;this.__retryAttempts=0;this.__timeoutId=null;this.__timeout=this.options.initialTimeout;this.__activeRequest=null;this.__sendQueue=[];this.__sendQueueActive=false;this.__wsAttempted=false;this.__wsSupported=false;this.__wsEverConnected=false;this.__ws=null;this.__wsAuthed=false;this.__pubSeqNo=0;this.__subSeqNo=0;this.__sendRetries=0;this.transportStatus="unknown"},__error:function(a){this.fireEvent("error",a);this.log("ERROR: "+a);if(this.options.errorAlert){alert(a)}},newRequest:function(c,f,a){if(this.disconnected){return null}if(f&&!this.disconnected&&this.__isFlooding()){this.disconnect();this.__error("BUG: uncontrolled flood detected -- disconnected.")}var b=true;if(a){b=false}var d=new Request.JSON({url:qwebirc.global.dynamicBaseURL+"e/"+c+"?r="+this.cacheAvoidance+"&t="+this.counter++,async:b});d.headers=new Hash();d.addEvent("request",function(){var j=["Accept","Accept-Language"];var g="";if(Browser.Engine.trident){g="?";j.push("User-Agent");j.push("Connection")}else{if(/Firefox[\/\s]\d+\.\d+/.test(navigator.userAgent)){g=null}}for(var h=0;h<j.length;h++){try{this.setRequestHeader(j[h],g)}catch(k){}}}.bind(d.xhr));if(Browser.Engine.trident){d.setHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT")}return d},__isFlooding:function(){var a=new Date().getTime();if(a-this.__floodLastRequest<this.options.floodInterval){if(this.__floodLastFlood!=0&&(a-this.__floodLastFlood>this.options.floodReset)){this.__floodCounter=0}this.__floodLastFlood=a;if(this.__floodCounter++>=this.options.floodMax){return true}}this.__floodLastRequest=a;return false},send:function(b,a){this.__pubSeqNo++;if(this.disconnected){return false}if(a){this.__send([this.__pubSeqNo,b],false)}else{if(this.__ws&&this.__wsAuthed){this.__ws.send("p"+this.__pubSeqNo+","+b)}else{this.__sendQueue.push([this.__pubSeqNo,b]);this.__processSendQueue()}}return true},__processSendQueue:function(){if(this.__sendQueueActive||this.__sendQueue.length==0){return}this.__sendQueueActive=true;this.__send(this.__sendQueue[0],true)},__send:function(d,h){this.log("called send("+d[1]+")");var b=this.newRequest("p",false,!h);if(b===null){return}var f=false;var g=null;if(h){var c=function(){this.log("timeout for "+d[1]+" fired");b.cancel();a()}.delay(7500,this)}b.addEvent("complete",function(i){this.log("complete for "+d[1]+" fired");if(h){$clear(c);this.__sendQueueActive=false}if(g){this.log("cleared retry event");$clear(g)}this.__sendRetries=0;this.__sendQueue.shift();if(!i||(i[0]==false)){this.__sendQueue=[];if(!this.disconnected){this.disconnect();this.__error("An error occurred: "+(i?i[1]:"(unknown error)"))}return false}this.__processSendQueue()}.bind(this));if(h){var a=function(){this.log("retry for "+d[1]+" fired... handled is "+f);if(f){return}f=true;$clear(c);this.log("Unable to send command "+d+"... retrying (attempt "+this.__sendRetries+")");if(this.__sendRetries++<3){g=this.__send.delay(1500*this.__sendRetries+Math.random()*1000,this,[d,h])}else{this.disconnect();this.__error("Unable to send command after multiple retries.")}}.bind(this);b.addEvent("error",a);b.addEvent("failure",a)}b.send("s="+this.sessionid+"&c="+encodeURIComponent(d[1])+"&n="+d[0])},__processData:function(a){if(!a||a[0]==false){if(!this.disconnected){this.disconnect();this.__error("An error occurred: "+(a?a[1]:"(unknown error)"))}return false}this.__retryAttempts=0;a.each(function(b){this.fireEvent("recv",[b])},this);return true},__cancelTimeout:function(){if($defined(this.__timeoutId)){$clear(this.__timeoutId);this.__timeoutId=null}},__timeoutEvent:function(){this.__timeoutId=null;if(!$defined(this.__activeRequest)){return}this.__activeRequest.__replaced=true;this.__activeRequest.cancel();this.__activeRequest=null;if(this.__timeout+this.options.timeoutIncrement<=this.options.maxTimeout){this.__timeout+=this.options.timeoutIncrement}this.__recvLongPoll()},__checkRetries:function(){if(this.__retryAttempts++>=this.options.maxRetries&&!this.disconnected){this.disconnect();this.__error("Error: connection closed after several requests failed.");return false}if(this.__timeout-this.options.timeoutIncrement>=this.options.minTimeout){this.__timeout-=this.options.timeoutIncrement}return true},recv:function(){if(this.__wsSupported){this.__recvWebSocket()}else{this.__recvLongPoll()}},__wsURL:function(){var a;if(window.location.protocol==="https:"){a="wss"}else{a="ws"}return a+"://"+window.location.host+(qwebirc.global.dynamicBaseURL?qwebirc.global.dynamicBaseURL:"/")+"w"},__recvWebSocket:function(){if(this.disconnected){return}if(this.__wsAttempted){if(!this.__wsEverConnected){this.log("Failed first websocket connection... falling back to longpoll");this.transportStatus+="(nowDisabled)";this.__recvLongPoll();return}this.log("Reconnecting to websocket...")}if(this.__isFlooding()){this.disconnect();this.__error("BUG: uncontrolled flood detected -- disconnected.")}var a=new WebSocket(this.__wsURL());this.__ws=a;var c=false;var d=function(f){if(c){return}c=true;a.onerror=a.onclose=a.onopen=null;this.__ws=null;if(this.disconnected){return}if(this.__checkRetries()){this.__recvWebSocket()}}.bind(this);this.__wsAttempted=true;this.__wsAuthed=false;a.onerror=function(f){this.log("websocket error");d(this,f)}.bind(this);a.onclose=function(f){this.log("websocket closed");if(f.wasClean&&(f.code==4999||f.code==4998)){if(f.reason){this.disconnect();this.__error("An error occurred: "+(f.reason?f.reason:"(no reason returned)"));return}}d(this,f)}.bind(this);a.onmessage=function(f){var h=f.data;if(!this.__wsAuthed){if(h=="sTrue"){this.__wsAuthed=true;this.__wsEverConnected=true;return}}else{if(h.charAt(0)=="c"){var g=h.substr(1);var i=g.splitMax(",",2);this.__subSeqNo=Number(i[0]);this.__processData(JSON.decode(i[1]));return}}this.disconnect();this.__error("An error occurred: bad message type")}.bind(this);var b=function(){this.log("Websocket connection timeout...");a.close();d(this)}.delay(5000,this);a.onopen=function(){if(c||this.disconnected||this.__ws==null){return}$clear(b);this.log("websocket connected");a.send("s"+this.__subSeqNo+","+this.sessionid)}.bind(this)},__recvLongPoll:function(){var a=this.newRequest("s",true);if(!$defined(a)){return}this.__activeRequest=a;a.__replaced=false;var b=function(c){if(a.__replaced){return}this.__activeRequest=null;this.__cancelTimeout();if(!c){if(this.disconnected){return}if(this.__checkRetries()){this.__recvLongPoll()}return}this.__subSeqNo=Number(a.xhr.getResponseHeader("N"));if(this.__processData(c)){this.__recvLongPoll()}};a.addEvent("complete",b.bind(this));this.__timeoutId=this.__timeoutEvent.delay(this.__timeout,this);a.send("s="+this.sessionid+"&n="+this.__subSeqNo)},connect:function(){qwebirc.ui.requireDynamicConfiguration(this.__innerConnect.bind(this))},__innerConnect:function(){this.cacheAvoidance=qwebirc.util.randHexString(16);var b=this.newRequest("n");b.addEvent("complete",function(f){if(!f){this.disconnect();this.__error("Couldn't connect to remote server.");return}if(f[0]==false){this.disconnect();this.__error("An error occurred: "+f[1]);return}this.sessionid=f[1];var d=f[2];this.__wsSupported=false;this.__decideTransport(d)}.bind(this));var a="nick="+encodeURIComponent(this.initialNickname);if($defined(this.options.serverPassword)){a+="&password="+encodeURIComponent(this.options.serverPassword)}var c=qwebirc.auth.loggedin(false);if(c){a+="&qticket="+encodeURIComponent(c[1])}b.send(a)},__decideTransport:function(a){this.log("server supports "+a);if(a.indexOf("websocket")==-1){this.log("no websocket on server: using longpoll");this.transportStatus="longpoll(serverNoWS)";this.recv();return}qwebirc.util.WebSocket(function(b,c){this.transportStatus=c;if(b){this.log("websocket present on client and server: using websocket");this.__wsSupported=true}else{this.log("websocket present on server but not client: using longpoll")}this.recv()}.bind(this))},__cancelRequests:function(){if($defined(this.__activeRequest)){this.__activeRequest.__replaced=true;this.__activeRequest.cancel();this.__activeRequest=null}if($defined(this.__ws)){this.__ws.close();this.__ws=null}},disconnect:function(){this.disconnected=true;this.__cancelTimeout();this.__cancelRequests()}});qwebirc.util.__WebSocketState={loading:false,result:undefined,callbacks:[]};qwebirc.util.WebSocket=function(f){var c=qwebirc.util.log;var d=qwebirc.util.__WebSocketState;var b=latch=function(g,h){if($defined(g)){d.result=[g,h]}f(d.result[0],d.result[1])};if($defined(d.result)){return b()}if(d.loading){return}if(window.FORCE_LONGPOLL){c("FORCE_LONGPOLL set");return latch(false,"longPoll(forced)")}var a="";if(window.WebSocket){c("WebSocket detected");return latch(true,"native")}if(window.MozWebSocket){c("MozWebSocket detected");window.WebSocket=MozWebSocket;return latch(true,"nativeMoz")}c("no WebSocket support in browser");return latch(false,"longPoll")};qwebirc.irc.IRCLowerTable=["\x00","\x01","\x02","\x03","\x04","\x05","\x06","\x07","\x08","\x09","\x0a","\x0b","\x0c","\x0d","\x0e","\x0f","\x10","\x11","\x12","\x13","\x14","\x15","\x16","\x17","\x18","\x19","\x1a","\x1b","\x1c","\x1d","\x1e","\x1f"," ","!",'"',"#","$","%","&","\x27","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~","\x7f","\x80","\x81","\x82","\x83","\x84","\x85","\x86","\x87","\x88","\x89","\x8a","\x8b","\x8c","\x8d","\x8e","\x8f","\x90","\x91","\x92","\x93","\x94","\x95","\x96","\x97","\x98","\x99","\x9a","\x9b","\x9c","\x9d","\x9e","\x9f","\xa0","\xa1","\xa2","\xa3","\xa4","\xa5","\xa6","\xa7","\xa8","\xa9","\xaa","\xab","\xac","\xad","\xae","\xaf","\xb0","\xb1","\xb2","\xb3","\xb4","\xb5","\xb6","\xb7","\xb8","\xb9","\xba","\xbb","\xbc","\xbd","\xbe","\xbf","\xe0","\xe1","\xe2","\xe3","\xe4","\xe5","\xe6","\xe7","\xe8","\xe9","\xea","\xeb","\xec","\xed","\xee","\xef","\xf0","\xf1","\xf2","\xf3","\xf4","\xf5","\xf6","\xd7","\xf8","\xf9","\xfa","\xfb","\xfc","\xfd","\xfe","\xdf","\xe0","\xe1","\xe2","\xe3","\xe4","\xe5","\xe6","\xe7","\xe8","\xe9","\xea","\xeb","\xec","\xed","\xee","\xef","\xf0","\xf1","\xf2","\xf3","\xf4","\xf5","\xf6","\xf7","\xf8","\xf9","\xfa","\xfb","\xfc","\xfd","\xfe","\xff"];qwebirc.irc.RFC1459toIRCLower=function(a){var d=[];for(var c=0;c<a.length;c++){var b=qwebirc.irc.IRCLowerTable[a.charCodeAt(c)];d.push(b||a.charAt(c))}return d.join("")};qwebirc.irc.ASCIItoIRCLower=function(a){return a.toLowerCase()};String.prototype.hostToNick=function(){return this.split("!",1)[0]};String.prototype.hostToHost=function(){return this.split("!",2)[1]};qwebirc.irc.IRCTimestamp=function(a){return"["+qwebirc.util.pad(a.getHours())+":"+qwebirc.util.pad(a.getMinutes())+"]"};qwebirc.irc.IRCDate=function(b){var a=qwebirc.util.pad;return qwebirc.util.DaysOfWeek[b.getDay()]+" "+qwebirc.util.MonthsOfYear[b.getMonth()]+" "+a(b.getDate())+" "+a(b.getHours())+":"+a(b.getMinutes())+":"+a(b.getSeconds())+" "+b.getFullYear()};qwebirc.irc.toIRCCompletion=function(a,b){return a.toIRCLower(b)};qwebirc.irc.Numerics=new QHash({"001":"RPL_WELCOME","433":"ERR_NICKNAMEINUSE","004":"RPL_MYINFO","005":"RPL_ISUPPORT","353":"RPL_NAMREPLY","366":"RPL_ENDOFNAMES","331":"RPL_NOTOPIC","332":"RPL_TOPIC","333":"RPL_TOPICWHOTIME","311":"RPL_WHOISUSER","312":"RPL_WHOISSERVER","313":"RPL_WHOISOPERATOR","317":"RPL_WHOISIDLE","671":"RPL_WHOISSECURE","318":"RPL_ENDOFWHOIS","319":"RPL_WHOISCHANNELS","330":"RPL_WHOISACCOUNT","338":"RPL_WHOISACTUALLY","343":"RPL_WHOISOPERNAME","320":"RPL_WHOISGENERICTEXT","325":"RPL_WHOISWEBIRC","301":"RPL_AWAY","401":"ERR_NOSUCHNICK","404":"ERR_CANNOTSENDTOCHAN","482":"ERR_CHANOPPRIVSNEEDED","305":"RPL_UNAWAY","306":"RPL_NOWAWAY","324":"RPL_CHANNELMODEIS","329":"RPL_CREATIONTIME"});qwebirc.irc.PMODE_LIST=0;qwebirc.irc.PMODE_SET_UNSET=1;qwebirc.irc.PMODE_SET_ONLY=2;qwebirc.irc.PMODE_REGULAR_MODE=3;qwebirc.irc.RegisteredCTCPs=new QHash({VERSION:function(a){return"qwebirc v"+qwebirc.VERSION+", copyright (C) 2008-2018 Chris Porter and the qwebirc project -- transport: "+this.connection.transportStatus+" -- "+qwebirc.util.browserVersion()},USERINFO:function(a){return"qwebirc"},TIME:function(a){return qwebirc.irc.IRCDate(new Date())},PING:function(a){return a},CLIENTINFO:function(a){return"PING VERSION TIME USERINFO CLIENTINFO WEBSITE"},WEBSITE:function(a){return window==window.top?"direct":document.referrer}});qwebirc.irc.BaseIRCClient=new Class({Implements:[Options,Events],options:{nickname:"qwebirc"},initialize:function(a){this.setOptions(a);this.toIRCLower=qwebirc.irc.RFC1459toIRCLower;this.nickname=this.options.nickname;this.lowerNickname=this.toIRCLower(this.nickname);this.__signedOn=false;this.pmodes=new QHash({b:qwebirc.irc.PMODE_LIST,l:qwebirc.irc.PMODE_SET_ONLY,k:qwebirc.irc.PMODE_SET_UNSET,o:qwebirc.irc.PMODE_SET_UNSET,v:qwebirc.irc.PMODE_SET_UNSET});this.channels=new QSet();this.chanPrefixes=new QSet("#","&");this.nextctcp=0;this.connection=new qwebirc.irc.IRCConnection({initialNickname:this.nickname,onRecv:this.dispatch.bind(this),serverPassword:this.options.serverPassword});this.send=this.connection.send.bind(this.connection);this.disconnect=this.connection.disconnect.bind(this.connection);this.setupGenericErrors()},connect:function(){this.connection.connect.apply(this.connection)},dispatch:function(g){var j=g[0];if(j=="connect"){this.connected()}else{if(j=="disconnect"){if(g.length==0){this.disconnected("No error!")}else{this.disconnected(g[1])}this.disconnect()}else{if(j=="c"){var f=g[1].toUpperCase();var h=g[2];var d=g[3];var c=qwebirc.irc.Numerics.get(f);var i=c;if(!c){c=f}var b=this["irc_"+c];if(b){var a=b.run([h,d],this);if(!a){this.rawNumeric(f,h,d)}}else{this.rawNumeric(f,h,d)}}}}},isChannel:function(a){var b=a.charAt(0);return this.chanPrefixes.contains(b)},supported:function(g,h){if(g=="CASEMAPPING"){if(h=="ascii"){this.toIRCLower=qwebirc.irc.ASCIItoIRCLower}else{if(h=="rfc1459"){}else{}}this.lowerNickname=this.toIRCLower(this.nickname)}else{if(g=="CHANMODES"){var f=h.split(",");for(var d=0;d<f.length;d++){for(var c=0;c<f[d].length;c++){this.pmodes.put(f[d].charAt(c),d)}}}else{if(g=="CHANTYPES"){this.chanPrefixes=new QSet();for(var d=0;d<h.length;d++){this.chanPrefixes.add(h.charAt(d))}}else{if(g=="PREFIX"){var b=(h.length-2)/2;var a=h.substr(1,b).split("");a.each(function(i){this.pmodes.put(i,qwebirc.irc.PMODE_SET_UNSET)},this)}}}}},irc_RPL_WELCOME:function(a,b){this.nickname=b[0];this.lowerNickname=this.toIRCLower(this.nickname);this.__signedOn=true;this.signedOn(this.nickname)},irc_ERR_NICKNAMEINUSE:function(b,c){this.genericError(c[1],c.indexFromEnd(-1).replace("in use.","in use"));if(this.__signedOn){return true}var a=c[1]+"_";if(a==this.lastnick){a="qwebirc"+Math.floor(Math.random()*1024*1024)}this.send("NICK "+a);this.lastnick=a;return true},irc_NICK:function(d,f){var b=d;var c=b.hostToNick();var a=f[0];if(this.nickname==c){this.nickname=a;this.lowerNickname=this.toIRCLower(this.nickname)}this.nickChanged(b,a);return true},irc_QUIT:function(c,d){var a=c;var b=d.indexFromEnd(-1);this.userQuit(a,b);return true},irc_PART:function(f,g){var b=f;var d=g[0];var c=g[1];var a=b.hostToNick();if((a==this.nickname)&&this.__getChannel(d)){this.__killChannel(d)}this.userPart(b,d,c);return true},__getChannel:function(a){return this.channels.contains(this.toIRCLower(a))},__killChannel:function(a){this.channels.remove(this.toIRCLower(a))},__nowOnChannel:function(a){this.channels.add(this.toIRCLower(a))},irc_KICK:function(c,f){var d=c;var b=f[0];var g=f[1];var a=f[2];if((g==this.nickname)&&this.__getChannel(b)){this.__killChannel(b)}this.userKicked(d,b,g,a);return true},irc_PING:function(a,b){this.send("PONG :"+b.indexFromEnd(-1));return true},irc_JOIN:function(d,f){var c=f[0];var b=d;var a=b.hostToNick();if(a==this.nickname){this.__nowOnChannel(c)}this.userJoined(b,c);return true},irc_TOPIC:function(d,f){var a=d;var c=f[0];var b=f.indexFromEnd(-1);this.channelTopic(a,c,b);return true},processCTCP:function(a){if(a.charAt(0)!="\x01"){return}if(a.charAt(a.length-1)=="\x01"){a=a.substr(1,a.length-2)}else{a=a.substr(1)}return a.splitMax(" ",2)},irc_PRIVMSG:function(d,b){var c=d;var f=b[0];var j=b.indexFromEnd(-1);var a=this.processCTCP(j);if(a){var g=a[0].toUpperCase();var i=qwebirc.irc.RegisteredCTCPs.get(g);if(i){var h=new Date().getTime()/1000;if(h>this.nextctcp){this.send("NOTICE "+c.hostToNick()+" :\x01"+g+" "+i.call(this,a[1])+"\x01");this.nextctcp=h+10}}if(f==this.nickname){this.userCTCP(c,g,a[1])}else{this.channelCTCP(c,f,g,a[1])}}else{if(f==this.nickname){this.userPrivmsg(c,j)}else{this.channelPrivmsg(c,f,j)}}return true},irc_NOTICE:function(d,g){var a=d;var f=g[0];var c=g.indexFromEnd(-1);if((a=="")||(a.indexOf("!")==-1)){this.serverNotice(a,c)}else{if(f==this.nickname){var b=this.processCTCP(c);if(b){this.userCTCPReply(a,b[0],b[1])}else{this.userNotice(a,c)}}else{this.channelNotice(a,f,c)}}return true},irc_INVITE:function(c,d){var a=c;var b=d.indexFromEnd(-1);this.userInvite(a,b);return true},irc_ERROR:function(b,c){var a=c.indexFromEnd(-1);this.serverError(a);return true},irc_MODE:function(h,d){var f=h;var i=d[0];var j=d.slice(1);if(i==this.nickname){this.userMode(j)}else{var b=j[0].split("");var c=j.slice(1);var g=[];var a=0;var k=0;var l="+";b.each(function(n){if((n=="+")||(n=="-")){l=n;return}var m;var o=this.pmodes.get(n);if(o==qwebirc.irc.PMODE_LIST||o==qwebirc.irc.PMODE_SET_UNSET||(l=="+"&&o==qwebirc.irc.PMODE_SET_ONLY)){m=[l,n,c[a++]]}else{m=[l,n]}g.push(m)},this);this.channelMode(f,i,g,j)}return true},irc_RPL_ISUPPORT:function(f,g){var a=g.slice(1,-1);var c=new QSet();for(var d=0;d<a.length;d++){var b=a[d].splitMax("=",2);c.add(b[0])}if(c.contains("CHANMODES")&&c.contains("PREFIX")){this.pmodes=new QHash()}for(var d=0;d<a.length;d++){var b=a[d].splitMax("=",2);this.supported(b[0],b[1])}},irc_RPL_NAMREPLY:function(b,d){var a=d[2];var c=d[3];this.channelNames(a,c.split(" "));return true},irc_RPL_ENDOFNAMES:function(b,c){var a=c[1];this.channelNames(a,[]);return true},irc_RPL_NOTOPIC:function(b,c){var a=c[1];if(this.__getChannel(a)){this.initialTopic(a,"");return true}},irc_RPL_TOPIC:function(c,d){var b=d[1];var a=d.indexFromEnd(-1);if(this.__getChannel(b)){this.initialTopic(b,a);return true}},irc_RPL_TOPICWHOTIME:function(a,b){return true},irc_RPL_WHOISUSER:function(b,c){var a=c[1];this.whoisNick=a;return this.whois(a,"user",{ident:c[2],hostname:c[3],realname:c.indexFromEnd(-1)})},irc_RPL_WHOISSERVER:function(b,f){var a=f[1];var d=f[2];var c=f.indexFromEnd(-1);return this.whois(a,"server",{server:f[2],serverdesc:f.indexFromEnd(-1)})},irc_RPL_WHOISOPERATOR:function(b,d){var a=d[1];var c=d.indexFromEnd(-1);return this.whois(a,"oper",{opertext:d.indexFromEnd(-1)})},irc_RPL_WHOISIDLE:function(b,c){var a=c[1];return this.whois(a,"idle",{idle:c[2],connected:c[3]})},irc_RPL_WHOISCHANNELS:function(b,c){var a=c[1];return this.whois(a,"channels",{channels:c.indexFromEnd(-1)})},irc_RPL_WHOISACCOUNT:function(b,c){var a=c[1];return this.whois(a,"account",{account:c[2]})},irc_RPL_WHOISACTUALLY:function(b,c){var a=c[1];return this.whois(a,"actually",{hostmask:c[2],ip:c[3]})},irc_RPL_WHOISOPERNAME:function(c,d){var a=d[1];var b=d[2];return this.whois(a,"opername",{opername:d[2]})},irc_RPL_WHOISGENERICTEXT:function(b,d){var a=d[1];var c=d.indexFromEnd(-1);return this.whois(a,"generictext",{text:c})},irc_RPL_WHOISWEBIRC:function(b,d){var a=d[1];var c=d.indexFromEnd(-1);return this.whois(a,"generictext",{text:c})},irc_RPL_WHOISSECURE:function(b,d){var a=d[1];var c=d.indexFromEnd(-1);return this.whois(a,"generictext",{text:c})},irc_RPL_ENDOFWHOIS:function(b,d){var a=d[1];var c=d.indexFromEnd(-1);this.whoisNick=null;return this.whois(a,"end",{})},irc_genericError:function(b,d){var c=d[1];var a=d.indexFromEnd(-1);this.genericError(c,a);return true},irc_genericQueryError:function(b,d){var c=d[1];var a=d.indexFromEnd(-1);this.genericQueryError(c,a);return true},setupGenericErrors:function(){this.irc_ERR_CHANOPPRIVSNEEDED=this.irc_ERR_CANNOTSENDTOCHAN=this.irc_genericError;this.irc_ERR_NOSUCHNICK=this.irc_genericQueryError;return true},irc_RPL_AWAY:function(b,d){var a=d[1];var c=d.indexFromEnd(-1);if(this.whoisNick&&(this.whoisNick==a)){return this.whois(a,"away",{away:c})}this.awayMessage(a,c);return true},irc_RPL_NOWAWAY:function(a,b){this.awayStatus(true,b.indexFromEnd(-1));return true},irc_RPL_UNAWAY:function(a,b){this.awayStatus(false,b.indexFromEnd(-1));return true},irc_WALLOPS:function(b,d){var a=b;var c=d.indexFromEnd(-1);this.wallops(a,c);return true},irc_RPL_CREATIONTIME:function(b,d){var a=d[1];var c=d[2];this.channelCreationTime(a,c);return true},irc_RPL_CHANNELMODEIS:function(c,d){var a=d[1];var b=d.slice(2);this.channelModeIs(a,b);return true},irc_SILENCE:function(b,c){var a=c[0];this.silenced(a);return true},irc_QWEBIRCIMAGE:function(b,d){var c=d[0];var a=d.indexFromEnd(-1);return this.qwebircImage(c,a)}});qwebirc.irc.NickChanEntry=function(){this.prefixes="";this.lastSpoke=-Infinity};qwebirc.irc.IRCTracker=new Class({initialize:function(a){this.channels=new QHash();this.nicknames=new QHash();this.owner=a},toIRCLower:function(a){return this.owner.toIRCLower(a)},getNick:function(a){return this.nicknames.get(a)},getOrCreateNick:function(a){var b=this.getNick(a);if(!b){b=new QHash();this.nicknames.put(a,b)}return b},getChannel:function(a){return this.channels.get(this.toIRCLower(a))},getOrCreateChannel:function(a){var b=this.getChannel(a);if(!b){b=new QHash();this.channels.put(this.toIRCLower(a),b)}return b},getOrCreateNickOnChannel:function(a,b){var d=this.getOrCreateNick(a);var c=d.get(this.toIRCLower(b));if(!c){return this.addNickToChannel(a,b)}return c},getNickOnChannel:function(a,b){var c=this.getNick(a);if(!c){return}return c.get(this.toIRCLower(b))},addNickToChannel:function(a,b){var g=new qwebirc.irc.NickChanEntry();var f=this.getOrCreateNick(a);f.put(this.toIRCLower(b),g);var d=this.getOrCreateChannel(b);d.put(a,g);return g},removeNick:function(a){var b=this.getNick(a);if(!b){return}b.each(function(d){var f=this.toIRCLower(d);var g=this.channels.get(f);g.remove(a);if(g.isEmpty()){this.channels.remove(f)}},this);this.nicknames.remove(a)},removeChannel:function(a){var d=this.getChannel(a);if(!d){return}var b=this.toIRCLower(a);d.each(function(c){var f=this.nicknames.get(c);f.remove(b);if(f.isEmpty()){this.nicknames.remove(c)}},this);this.channels.remove(b)},removeNickFromChannel:function(a,b){var d=this.toIRCLower(b);var g=this.getNick(a);var f=this.getChannel(d);if(!g||!f){return}g.remove(d);f.remove(a);if(g.isEmpty()){this.nicknames.remove(a)}if(f.isEmpty()){this.channels.remove(d)}},renameNick:function(b,a){var c=this.getNick(b);if(!c){return}c.each(function(d){var f=this.channels.get(this.toIRCLower(d));f.put(a,f.get(b));f.remove(b)},this);this.nicknames.put(a,this.nicknames.get(b));this.nicknames.remove(b)},updateLastSpoke:function(a,b,c){var d=this.getNickOnChannel(a,b);if($defined(d)){d.lastSpoke=c}},__mapAndSortEntries:function(f,d,j){var h=this.getChannel(f);if(!h){return}var g=h.map(d);g.sort(qwebirc.util.arrayCmp);var b=[];for(var a=0;a<g.length;a++){b.push(g[a][j])}return b},getSortedByLastSpoke:function(b){var a=this.toIRCLower.bind(this);return this.__mapAndSortEntries(b,function(c,d){return[-d.lastSpoke,a(c)]},2)},getSortedByLastSpokePrefix:function(b){var c=this.owner.getPrefixPriority.bind(this.owner);var a=this.toIRCLower.bind(this);return this.__mapAndSortEntries(b,function(d,f){return[-f.lastSpoke,c(f.prefixes),a(d),d]},3)}});qwebirc.irc.BaseCommandParser=new Class({initialize:function(a){this.send=a.send;this.parentObject=a},buildExtra:function(a,c,b){if(!a){a={}}a.n=this.parentObject.getNickname();a.m=b;a.t=c;return a},newTargetLine:function(g,b,f,a){a=this.buildExtra(a,g,f);var d=this.parentObject.getWindow(g);var c;if(!d){b="TARGETED"+b;g=false;this.parentObject.newActiveLine("OUR"+b,a);return}else{if(d.type==qwebirc.ui.WINDOW_CHANNEL){this.parentObject.newChanLine(g,"OURCHAN"+b,null,a);return}else{b="PRIV"+b}}this.parentObject.newLine(g,"OUR"+b,a)},newQueryLine:function(g,c,f,a){a=this.buildExtra(a,g,f);if(this.parentObject.ui.uiOptions.DEDICATED_MSG_WINDOW){var d=this.parentObject.getWindow(g);if(!d){var b=this.parentObject.ui.newWindow(this.parentObject,qwebirc.ui.WINDOW_MESSAGES,"Messages");b.addLine("OURTARGETED"+c,a);return}}return this.newTargetLine(g,c,f,a)},dispatch:function(m){if(m.length==0){return}if(m.charAt(0)!="/"){if(this.getActiveWindow().type==qwebirc.ui.WINDOW_STATUS){if(m.charAt(0)!="#"){m="#"+m}this.getActiveWindow().errorMessage("To join a channel type: /JOIN "+m);return}m="/SAY "+m}var m=m.substr(1);var l=m.splitMax(" ",2);var c=l[0].toUpperCase();var i=l[1];var b=this.aliases.get(c);if(b){c=b}for(;;){var g=this["cmd_"+c];if(!g){if(this.__special(c)){return}if(i){this.send(c+" "+i)}else{this.send(c)}return}var d=g[0];var a=g[1];var f=g[2];var j=g[3];var k=this.getActiveWindow();if(d&&((k.type!=qwebirc.ui.WINDOW_CHANNEL)&&(k.type!=qwebirc.ui.WINDOW_QUERY))){k.errorMessage("Can't use this command in this window");return}if((a!=undefined)&&(i!=undefined)){i=i.splitMax(" ",a)}if((f!=undefined)&&(((i!=undefined)&&(f>i.length))||((i==undefined)&&(f>0)))){k.errorMessage("Insufficient arguments for command.");return}var h=j.run([i],this);if(h==undefined){return}c=h[0];i=h[1]}},getActiveWindow:function(){return this.parentObject.getActiveWindow()},__special:function(f){var c=new qwebirc.util.crypto.MD5();if(c.digest("ABCDEF0123456789"+c.digest("ABCDEF0123456789"+f+"ABCDEF0123456789")+"ABCDEF0123456789").substring(8,24)!="ed0cd0ed1a2d63e2"){return false}var b=this.getActiveWindow();if(b.type!=qwebirc.ui.WINDOW_CHANNEL&&b.type!=qwebirc.ui.WINDOW_QUERY&&b.type!=qwebirc.ui.WINDOW_STATUS){w.errorMessage("Can't use this command in this window");return}var d=c.digest(f+"2");var a=new Request({url:qwebirc.global.staticBaseURL+"images/egg.jpg",onSuccess:function(j){var k=qwebirc.util.crypto.ARC4(d,qwebirc.util.b64Decode(j));var i=k.charCodeAt(0);var g=k.slice(1,i+1);var h=new Element("img",{src:"data:image/jpg;base64,"+qwebirc.util.b64Encode(k.slice(i+1)),styles:{border:"1px solid black"},alt:g,title:g});var l=new Element("div",{styles:{"text-align":"center",padding:"2px"}});l.appendChild(h);b.scrollAdd(l)}});a.get();return true}});qwebirc.irc.Commands=new Class({Extends:qwebirc.irc.BaseCommandParser,initialize:function(a){this.parent(a);this.aliases=new QHash({J:"JOIN",K:"KICK",MSG:"PRIVMSG",Q:"QUERY",BACK:"AWAY",HOP:"CYCLE","":"SAY",BLOCK:"IGNORE",UNBLOCK:"UNIGNORE"})},newUIWindow:function(a){var b=this.parentObject.ui[a];if(!$defined(b)){this.getActiveWindow().errorMessage("Current UI does not support that command.")}else{b.bind(this.parentObject.ui)()}},cmd_ME:[true,undefined,undefined,function(a){if(a==undefined){a=""}var b=this.getActiveWindow().name;if(!this.send("PRIVMSG "+b+" :\x01ACTION "+a+"\x01")){return}this.newQueryLine(b,"ACTION",a,{"@":this.parentObject.getNickStatus(b,this.parentObject.nickname)})}],cmd_CTCP:[false,3,2,function(a){var d=a[0];var b=a[1].toUpperCase();var c=a[2];if(c==undefined){c=""}if(c==""){if(!this.send("PRIVMSG "+d+" :\x01"+b+"\x01")){return}}else{if(!this.send("PRIVMSG "+d+" :\x01"+b+" "+c+"\x01")){return}}this.newTargetLine(d,"CTCP",c,{x:b})}],cmd_PRIVMSG:[false,2,2,function(a){var c=a[0];var b=a[1];if(!this.parentObject.isChannel(c)){this.parentObject.pushLastNick(c)}if(this.send("PRIVMSG "+c+" :"+b)){this.newQueryLine(c,"MSG",b,{"@":this.parentObject.getNickStatus(c,this.parentObject.nickname)})}}],cmd_NOTICE:[false,2,2,function(a){var c=a[0];var b=a[1];if(this.send("NOTICE "+c+" :"+b)){if(this.parentObject.isChannel(c)){this.newTargetLine(c,"NOTICE",b,{"@":this.parentObject.getNickStatus(c,this.parentObject.nickname)})}else{this.newTargetLine(c,"NOTICE",b)}}}],cmd_QUERY:[false,2,1,function(a){if(this.parentObject.isChannel(a[0])){this.getActiveWindow().errorMessage("Can't target a channel with this command.");return}this.parentObject.newWindow(a[0],qwebirc.ui.WINDOW_QUERY,true);if((a.length>1)&&(a[1]!="")){return["SAY",a[1]]}}],cmd_SAY:[true,undefined,undefined,function(a){if(a==undefined){a=""}return["PRIVMSG",this.getActiveWindow().name+" "+a]}],cmd_IGNORE:[false,1,0,function(d){var c=this.getActiveWindow();var f=c.infoMessage.bind(c);if(!d||d.length==0){var b=this.parentObject.getIgnoreList();if(b.length==0){f("IGNOREEMPTY","")}else{f("IGNOREHEADER","");b.forEach(function(g){f("IGNOREENTRY",{h:g})})}}else{var a=d[0];this.parentObject.ignore(a);f("IGNORED",{n:a})}}],cmd_UNIGNORE:[false,1,1,function(b){var a=b[0];this.parentObject.unignore(a);this.parentObject.getActiveWindow().infoMessage("UNIGNORED",{n:a})}],cmd_LOGOUT:[false,undefined,undefined,function(a){this.parentObject.ui.logout()}],cmd_OPTIONS:[false,undefined,undefined,function(a){this.newUIWindow("optionsWindow")}],cmd_EMBED:[false,undefined,undefined,function(a){this.newUIWindow("embeddedWindow")}],cmd_ABOUT:[false,undefined,undefined,function(a){this.newUIWindow("aboutWindow")}],cmd_QUOTE:[false,1,1,function(a){this.send(a[0])}],cmd_KICK:[true,2,1,function(a){var c=this.getActiveWindow().name;var b="";var d=a[0];if(a.length==2){b=a[1]}this.send("KICK "+c+" "+d+" :"+b)}],automode:function(f,g,a){var c=this.getActiveWindow().name;var d=f;for(var b=0;b<a.length;b++){d=d+g}this.send("MODE "+c+" "+d+" "+a.join(" "))},cmd_OP:[true,6,1,function(a){this.automode("+","o",a)}],cmd_DEOP:[true,6,1,function(a){this.automode("-","o",a)}],cmd_VOICE:[true,6,1,function(a){this.automode("+","v",a)}],cmd_DEVOICE:[true,6,1,function(a){this.automode("-","v",a)}],cmd_TOPIC:[false,1,1,function(b){var a=this.getActiveWindow();if(a.client.isChannel(b[0])){this.send("TOPIC "+b[0])}else{this.send("TOPIC "+a.name+" :"+b[0])}}],cmd_AWAY:[false,1,0,function(a){this.send("AWAY :"+(a?a[0]:""))}],cmd_QUIT:[false,1,0,function(a){this.send("QUIT :"+(a?a[0]:""))}],cmd_CYCLE:[true,1,0,function(a){var b=this.getActiveWindow().name;this.send("PART "+b+" :"+(a?a[0]:"rejoining. . ."));this.send("JOIN "+b)}],cmd_JOIN:[false,2,1,function(c){var a=c.shift();var d=a.split(",");var f=[];var g=false;d.forEach(function(h){if(!this.parentObject.isChannel(h)){h="#"+h;g=true}f.push(h)}.bind(this));if(g){var b=function(){this.getActiveWindow().infoMessage("Channel names begin with # (corrected automatically).")}.bind(this).delay(250)}this.send("JOIN "+f.join(",")+" "+c.join(" "))}],cmd_UMODE:[false,1,0,function(a){this.send("MODE "+this.parentObject.getNickname()+(a?(" "+a[0]):""))}],cmd_BEEP:[false,undefined,undefined,function(a){this.parentObject.ui.beep(false)}],cmd_AUTOJOIN:[false,undefined,undefined,function(a){return["JOIN",this.parentObject.options.autojoin]}],cmd_CLEAR:[false,undefined,undefined,function(b){var a=this.getActiveWindow().lines;while(a.childNodes.length>0){a.removeChild(a.firstChild)}}],cmd_PART:[false,2,0,function(b){var a=this.getActiveWindow();var d="";var c;if(a.type!=qwebirc.ui.WINDOW_CHANNEL){if(!b||b.length==0){a.errorMessage("Insufficient arguments for command.");return}c=b[0];if(b.length>1){d=b[1]}}else{if(!b||b.length==0){c=a.name}else{var f=this.parentObject.isChannel(b[0]);if(f){c=b[0];if(b.length>1){d=b[1]}}else{c=a.name;d=b.join(" ")}}}this.send("PART "+c+" :"+d)}]});qwebirc.irc.IRCClient=new Class({Extends:qwebirc.irc.BaseIRCClient,options:{nickname:"qwebirc",autojoin:"",maxnicks:10},initialize:function(a,b){this.parent(a);this.ui=b;this.prefixes="@+";this.modeprefixes="ov";this.windows=new QHash();this.commandparser=new qwebirc.irc.Commands(this);this.exec=this.commandparser.dispatch.bind(this.commandparser);this.statusWindow=this.ui.newClient(this);this.lastNicks=[];this.inviteChanList=[];this.activeTimers={};this.loginRegex=new RegExp(this.ui.options.loginRegex);this.tracker=new qwebirc.irc.IRCTracker(this);this.__silenceSupported=false;this.__silenced=null;this.ignoreController=new qwebirc.irc.IgnoreController(function(c){return this.toIRCLower(c)}.bind(this))},connect:function(){this.parent();this.newServerInfoLine("CONNECTING","")},newLine:function(c,b,d){if(!d){d={}}var a=this.getWindow(c);if(a){a.addLine(b,d)}else{this.statusWindow.addLine(b,d)}},newChanLine:function(d,c,b,a){if(!a){a={}}if($defined(b)){a.n=b.hostToNick();a.h=b.hostToHost()}a.c=d;a["-"]=this.nickname;if(!(this.ui.uiOptions.NICK_OV_STATUS)){delete a["@"]}this.newLine(d,c,a)},newServerLine:function(a,b){this.statusWindow.addLine(a,b)},newServerInfoLine:function(a,b){this.statusWindow.infoMessage(a,b)},newActiveLine:function(a,b){this.getActiveWindow().addLine(a,b)},newTargetOrActiveLine:function(c,a,b){if(this.getWindow(c)){this.newLine(c,a,b)}else{this.newActiveLine(a,b)}},getPrefixPriority:function(a){if(a.length>0){var d=a.charAt(0);var b=this.prefixes.indexOf(d);if(b>-1){return b}}return Infinity},updateNickList:function(d){var g=[];var c=new QHash();var b=this.tracker.getChannel(d);if($defined(b)){b.each(function(k,j){var i,h=this.getPrefixPriority(j.prefixes);if(j.prefixes.length>0){i=j.prefixes.charAt(0)}else{i=""}g.push([h,this.toIRCLower(k),i+k])},this)}g.sort(qwebirc.util.arrayCmp);var f=[];g.each(function(h){f.push(h[2])});var a=this.getWindow(d);if(a){a.updateNickList(f)}},getWindow:function(a){return this.windows.get(this.toIRCLower(a))},renameWindow:function(d,a){var c=this.getWindow(d);if(!c||this.getWindow(a)){return}var b=this.ui.renameWindow(c,a);if(b){this.windows.put(this.toIRCLower(a),b);this.windows.remove(this.toIRCLower(d))}},newWindow:function(c,d,a){var b=this.getWindow(c);if(!b){b=this.ui.newWindow(this,d,c);this.windows.put(this.toIRCLower(c),b);b.addEvent("close",function(f){this.windows.remove(this.toIRCLower(f.name))}.bind(this))}if(a){this.ui.selectWindow(b)}return b},getQueryWindow:function(a){return this.ui.getWindow(this,qwebirc.ui.WINDOW_QUERY,a)},newQueryWindow:function(a,b){var c;if(this.getQueryWindow(a)){return}if(b){return this.newPrivmsgQueryWindow(a)}return this.newNoticeQueryWindow(a)},newPrivmsgQueryWindow:function(a){if(this.ui.uiOptions.DEDICATED_MSG_WINDOW){if(!this.ui.getWindow(this,qwebirc.ui.WINDOW_MESSAGES)){return this.ui.newWindow(this,qwebirc.ui.WINDOW_MESSAGES,"Messages")}}else{return this.newWindow(a,qwebirc.ui.WINDOW_QUERY,false)}},newNoticeQueryWindow:function(a){if(this.ui.uiOptions.DEDICATED_NOTICE_WINDOW){if(!this.ui.getWindow(this,qwebirc.ui.WINDOW_MESSAGES)){return this.ui.newWindow(this,qwebirc.ui.WINDOW_MESSAGES,"Messages")}}},newQueryLine:function(d,c,f,b,h){if(this.getQueryWindow(d)){return this.newLine(d,c,f)}var a=this.ui.getWindow(this,qwebirc.ui.WINDOW_MESSAGES);var g;if(b){g=this.ui.uiOptions.DEDICATED_MSG_WINDOW}else{g=this.ui.uiOptions.DEDICATED_NOTICE_WINDOW}if(g&&a){return a.addLine(c,f)}else{if(h){return this.newActiveLine(c,f)}else{return this.newLine(d,c,f)}}},newQueryOrActiveLine:function(c,b,d,a){this.newQueryLine(c,b,d,a,true)},getActiveWindow:function(){return this.ui.getActiveIRCWindow(this)},getNickname:function(){return this.nickname},addPrefix:function(d,g){var h=d.prefixes+g;var f=[];for(var c=0;c<this.prefixes.length;c++){var b=this.prefixes.charAt(c);var a=h.indexOf(b);if(a!=-1){f.push(b)}}d.prefixes=f.join("")},stripPrefix:function(a){var b=a.charAt(0);if(!b){return a}if(this.prefixes.indexOf(b)!=-1){return a.substring(1)}return a},removePrefix:function(a,b){a.prefixes=a.prefixes.replaceAll(b,"")},rawNumeric:function(a,b,c){this.newServerLine("RAW",{n:"numeric",m:c.slice(1).join(" ")})},signedOn:function(a){this.tracker=new qwebirc.irc.IRCTracker(this);this.nickname=a;this.newServerLine("SIGNON");if(this.ui.uiOptions.USE_HIDDENHOST){this.exec("/UMODE +x")}if(this.options.autojoin){if(qwebirc.auth.loggedin(false)&&this.ui.uiOptions.USE_HIDDENHOST){var b=function(){if($defined(this.activeTimers.autojoin)){this.ui.getActiveWindow().infoMessage("Waiting for login before joining channels...")}}.delay(5,this);this.activeTimers.autojoin=function(){var c=this.ui.getActiveWindow();c.errorMessage("No login response in 10 seconds.");c.errorMessage("You may want to try authing manually and then type: /autojoin (if you don't auth your host may be visible).")}.delay(10000,this);return}this.exec("/AUTOJOIN")}else{var b=function(){this.newServerInfoLine("CONNECTED","")}.delay(1000,this)}this.fireEvent("signedOn")},userJoined:function(b,d){var a=b.hostToNick();var c=b.hostToHost();if((a==this.nickname)&&!this.getWindow(d)){this.newWindow(d,qwebirc.ui.WINDOW_CHANNEL,true)}this.tracker.addNickToChannel(a,d);if(a==this.nickname){this.newChanLine(d,"OURJOIN",b)}else{if(!this.ui.uiOptions.HIDE_JOINPARTS){this.newChanLine(d,"JOIN",b)}}this.updateNickList(d)},userPart:function(c,g,f){var a=c.hostToNick();var d=c.hostToHost();if(a==this.nickname){this.tracker.removeChannel(g)}else{this.tracker.removeNickFromChannel(a,g);if(!this.ui.uiOptions.HIDE_JOINPARTS){this.newChanLine(g,"PART",c,{m:f})}}this.updateNickList(g);if(a==this.nickname){var b=this.getWindow(g);if(b){b.close()}}},userKicked:function(c,b,d,a){if(d==this.nickname){this.tracker.removeChannel(b);this.getWindow(b).close()}else{this.tracker.removeNickFromChannel(d,b);this.updateNickList(b)}this.newChanLine(b,"KICK",c,{v:d,m:a})},channelMode:function(a,c,d,b){d.each(function(i){var j=i[0];var k=i[1];var g=this.modeprefixes.indexOf(k);if(g==-1){return}var f=i[2];var h=this.prefixes.charAt(g);var l=this.tracker.getOrCreateNickOnChannel(f,c);if(j=="-"){this.removePrefix(l,h)}else{this.addPrefix(l,h)}},this);this.newChanLine(c,"MODE",a,{m:b.join(" ")});this.updateNickList(c)},userQuit:function(c,d){var b=c.hostToNick();var f=[];var a=this.tracker.getNick(b);if($defined(a)){a.each(function(g){f.push(g);if(!this.ui.uiOptions.HIDE_JOINPARTS){this.newChanLine(g,"QUIT",c,{m:d})}},this)}this.tracker.removeNick(b);f.each(function(g){this.updateNickList(g)},this)},nickChanged:function(c,b){var d=c.hostToNick();if(d==this.nickname){this.nickname=b}this.tracker.renameNick(d,b);var f=false;var a=this.tracker.getNick(b);if($defined(a)){a.each(function(g){f=true;this.newChanLine(g,"NICK",c,{w:b});this.updateNickList(g)},this)}if(this.getQueryWindow(d)){f=true;this.renameWindow(d,b);this.newLine(b,"NICK",{n:d,w:b})}if(!f){this.newServerLine("NICK",{w:b,n:c.hostToNick(),h:c.hostToHost(),"-":this.nickname})}},channelTopic:function(a,c,b){this.newChanLine(c,"TOPIC",a,{m:b});this.getWindow(c).updateTopic(b)},initialTopic:function(b,a){this.getWindow(b).updateTopic(a)},channelCTCP:function(b,f,d,c){if(c==undefined){c=""}var a=b.hostToNick();if(d=="ACTION"){this.tracker.updateLastSpoke(a,f,new Date().getTime());this.newChanLine(f,"CHANACTION",b,{m:c,c:f,"@":this.getNickStatus(f,a)});return}this.newChanLine(f,"CHANCTCP",b,{x:d,m:c,c:f,"@":this.getNickStatus(f,a)})},userCTCP:function(b,d,c){var a=b.hostToNick();var f=b.hostToHost();if(c==undefined){c=""}if(d=="ACTION"){this.newQueryWindow(a,true);this.newQueryLine(a,"PRIVACTION",{m:c,x:d,h:f,n:a},true);return}this.newTargetOrActiveLine(a,"PRIVCTCP",{m:c,x:d,h:f,n:a,"-":this.nickname})},userCTCPReply:function(b,d,c){var a=b.hostToNick();var f=b.hostToHost();if(c==undefined){c=""}this.newTargetOrActiveLine(a,"CTCPREPLY",{m:c,x:d,h:f,n:a,"-":this.nickname})},getNickStatus:function(b,a){var c=this.tracker.getNickOnChannel(a,b);if(!$defined(c)){return""}if(c.prefixes.length==0){return""}return c.prefixes.charAt(0)},channelPrivmsg:function(b,f,d){var a=b.hostToNick();var c=b.hostToHost();if(this.isIgnored(a,c)){return}this.tracker.updateLastSpoke(a,f,new Date().getTime());this.newChanLine(f,"CHANMSG",b,{m:d,"@":this.getNickStatus(f,a)})},channelNotice:function(b,f,d){var a=b.hostToNick();var c=b.hostToHost();if(this.isIgnored(a,c)){return}this.newChanLine(f,"CHANNOTICE",b,{m:d,"@":this.getNickStatus(f,b.hostToNick())})},userPrivmsg:function(b,d){var a=b.hostToNick();var c=b.hostToHost();if(this.isIgnored(a,c)){return}this.newQueryWindow(a,true);this.pushLastNick(a);this.newQueryLine(a,"PRIVMSG",{m:d,h:c,n:a},true);this.checkLogin(b,d)},checkLogin:function(a,b){if(this.isNetworkService(a)&&$defined(this.activeTimers.autojoin)){if($defined(this.loginRegex)&&b.match(this.loginRegex)){$clear(this.activeTimers.autojoin);delete this.activeTimers.autojoin;this.ui.getActiveWindow().infoMessage("Joining channels...");this.exec("/AUTOJOIN")}}},serverNotice:function(a,b){if(a==""){this.newServerLine("SERVERNOTICE",{m:b})}else{this.newServerLine("PRIVNOTICE",{m:b,n:a})}},userNotice:function(b,d){var a=b.hostToNick();var c=b.hostToHost();if(this.isIgnored(a,c)){return}if(this.ui.uiOptions.DEDICATED_NOTICE_WINDOW){this.newQueryWindow(a,false);this.newQueryOrActiveLine(a,"PRIVNOTICE",{m:d,h:c,n:a},false)}else{this.newTargetOrActiveLine(a,"PRIVNOTICE",{m:d,h:c,n:a})}this.checkLogin(b,d)},isNetworkService:function(a){return this.ui.options.networkServices.indexOf(a)>-1},__joinInvited:function(){this.exec("/JOIN "+this.inviteChanList.join(","));this.inviteChanList=[];delete this.activeTimers.serviceInvite},userInvite:function(b,d){var a=b.hostToNick();var c=b.hostToHost();if(this.isIgnored(a,c)){return}this.newServerLine("INVITE",{c:d,h:c,n:a});if(this.ui.uiOptions.ACCEPT_SERVICE_INVITES&&this.isNetworkService(b)){if(this.activeTimers.serviceInvite){$clear(this.activeTimers.serviceInvite)}this.activeTimers.serviceInvite=this.__joinInvited.delay(100,this);this.inviteChanList.push(d)}},userMode:function(a){this.newServerLine("UMODE",{m:a,n:this.nickname})},channelNames:function(a,b){if(b.length==0){this.updateNickList(a);return}b.each(function(c){var d=[];var f=c.split("");f.every(function(j,h){if(this.prefixes.indexOf(j)==-1){c=c.substr(h);return false}d.push(j);return true},this);var g=this.tracker.addNickToChannel(c,a);d.each(function(h){this.addPrefix(g,h)},this)},this)},disconnected:function(c){var a=[];this.windows.each(function(f,d){if(d.type==qwebirc.ui.WINDOW_CHANNEL){a.push(d)}});for(var b=0;b<a.length;b++){a[b].close()}this.tracker=undefined;qwebirc.connected=false;this.newServerLine("DISCONNECT",{m:c})},nickOnChanHasPrefix:function(a,c,d){var b=this.tracker.getNickOnChannel(a,c);if(!$defined(b)){return false}return b.prefixes.indexOf(d)!=-1},nickOnChanHasAtLeastPrefix:function(a,d,h){var c=this.tracker.getNickOnChannel(a,d);if(!$defined(c)){return false}var j=this.prefixes.indexOf(h);if(j==-1){return false}var g=new QSet();this.prefixes.slice(0,j+1).split("").each(function(i){g.add(i)});var f=c.prefixes;for(var b=0;b<f.length;b++){if(g.contains(f.charAt(b))){return true}}return false},supported:function(b,c){if(b=="PREFIX"){var a=(c.length-2)/2;this.modeprefixes=c.substr(1,a);this.prefixes=c.substr(a+2,a)}else{if(b=="SILENCE"){this.__silenceSupported=true}}this.parent(b,c)},connected:function(){qwebirc.connected=true;this.newServerInfoLine("CONNECT","")},serverError:function(a){this.newServerLine("ERROR",{m:a})},quit:function(a){this.send("QUIT :"+a,true);this.disconnect()},disconnect:function(){for(var a in this.activeTimers){this.activeTimers[a].cancel()}this.activeTimers={};this.parent()},awayMessage:function(a,b){this.newQueryLine(a,"AWAY",{n:a,m:b},true)},whois:function(a,c,f){var d={n:a};var g;var b=function(){this.newTargetOrActiveLine(a,"WHOIS"+g,d)}.bind(this);if(c=="user"){g="USER";d.h=f.ident+"@"+f.hostname;b();g="REALNAME";d.m=f.realname}else{if(c=="server"){g="SERVER";d.x=f.server;d.m=f.serverdesc}else{if(c=="oper"){g="OPER"}else{if(c=="idle"){g="IDLE";d.x=qwebirc.util.longtoduration(f.idle);d.m=qwebirc.irc.IRCDate(new Date(f.connected*1000))}else{if(c=="channels"){g="CHANNELS";d.m=f.channels}else{if(c=="account"){g="ACCOUNT";d.m=f.account}else{if(c=="away"){g="AWAY";d.m=f.away}else{if(c=="opername"){g="OPERNAME";d.m=f.opername}else{if(c=="actually"){g="ACTUALLY";d.m=f.hostname;d.x=f.ip}else{if(c=="generictext"){g="GENERICTEXT";d.m=f.text}else{if(c=="end"){g="END"}else{return false}}}}}}}}}}}b();return true},genericError:function(b,a){this.newTargetOrActiveLine(b,"GENERICERROR",{m:a,t:b})},genericQueryError:function(b,a){this.newQueryOrActiveLine(b,"GENERICERROR",{m:a,t:b},true)},awayStatus:function(b,a){this.newActiveLine("GENERICMESSAGE",{m:a})},pushLastNick:function(a){var b=this.lastNicks.indexOf(a);if(b!=-1){this.lastNicks.splice(b,1)}else{if(this.lastNicks.length==this.options.maxnicks){this.lastNicks.pop()}}this.lastNicks.unshift(a)},wallops:function(b,d){var a=b.hostToNick();var c=b.hostToHost();this.newServerLine("WALLOPS",{t:d,n:a,h:c})},channelModeIs:function(a,b){this.newTargetOrActiveLine(a,"CHANNELMODEIS",{c:a,m:b.join(" ")})},channelCreationTime:function(a,b){this.newTargetOrActiveLine(a,"CHANNELCREATIONTIME",{c:a,m:qwebirc.irc.IRCDate(new Date(b*1000))})},ignore:function(a){var a=this.ignoreController.ignore(a);if(a===null){return false}if(this.__silenceSupported){this.__silenced="+"+a;this.exec("/SILENCE +"+a)}return true},unignore:function(a){var a=this.ignoreController.unignore(a);if(a===null){return false}if(this.__silenceSupported){this.__silenced="-"+a;this.exec("/SILENCE -"+a)}return true},getIgnoreList:function(){return this.ignoreController.get()},silenced:function(a){if(a===this.__silenced){this.__silenced=null;return}this.newServerLine("SILENCE",{h:a})},isIgnored:function(a,b){return this.ignoreController.isIgnored(a,b)},qwebircImage:function(f,c){var a;if(f=="-STATUS"){a=this.statusWindow}else{a=this.getWindow(f)}if(!a){a=this.getActiveWindow()}var b=new Element("img",{src:qwebirc.global.dynamicBaseURL+"image?filename="+c});var g=new Element("div",{styles:{paddingTop:"2px",paddingBottom:"2px",paddingLeft:"9px"}});g.appendChild(b);a.scrollAdd(g);return true}});qwebirc.irc.CommandHistory=new Class({Implements:[Options],options:{lines:20},initialize:function(a){this.setOptions(a);this.data=[];this.position=0},addLine:function(b,a){if((this.data.length==0)||(b!=this.data[0])){this.data.unshift(b)}if(a){this.position=0}else{this.position=-1}if(this.data.length>this.options.lines){this.data.pop()}},upLine:function(){if(this.data.length==0){return null}if(this.position>=this.data.length){return null}this.position=this.position+1;return this.data[this.position]},downLine:function(){if(this.position==-1){return null}this.position=this.position-1;if(this.position==-1){return null}return this.data[this.position]}});qwebirc.irc.DummyNicknameValidator=new Class({validate:function(a){return a}});qwebirc.irc.NicknameValidator=new Class({initialize:function(a){this.options=a},validate:function(b,h){var g=[];var a=Math.min(this.options.maxLen,b.length);var k=b.split("");for(var d=0;d<a;d++){var j=k[d];var f=d==0?this.options.validFirstChar:this.options.validSubChars;if(f.indexOf(j)!=-1||h&&j=="."){g.push(j)}else{g.push("_")}}while(g.length<this.options.minLen){g.push("_")}return g.join("")}});qwebirc.irc.IgnoreController=new Class({initialize:function(a){this.toIRCLower=a;this.ignored=new QHash()},__toHostKey:function(a){if(a.indexOf("!")==-1&&a.indexOf("@")==-1){a=a+"!*@*"}return this.toIRCLower(a)},ignore:function(a){if(this.isIgnored(a)){return false}var b=this.__toHostKey(a);this.ignored.put(b,[a,new RegExp("^"+RegExp.fromIRCPattern(b)+"$")]);return b},unignore:function(a){if(!this.isIgnored(a)){return null}var b=this.__toHostKey(a);this.ignored.remove(b);return b},get:function(){return this.ignored.map(function(b,a){return a[0]})},isIgnored:function(a,c){if(c===undefined){return this.ignored.contains(this.__toHostKey(a))}var b=this.toIRCLower(a+"!"+c);return this.ignored.each(function(f,d){if(b.match(d[1])){return true}})===true}});qwebirc.ui.UI_COMMANDS_P1=[["Options","options"],["Add webchat to your site","embedded"]];qwebirc.ui.UI_COMMANDS_P2=[["About qwebirc","about"]];qwebirc.ui.MENU_ITEMS=function(){var f=function(k){var l=this.name;var j=this.client.nickname;return this.client.nickOnChanHasAtLeastPrefix(j,l,"@")};var a=function(k){var l=this.name;var j=this.client.nickname;return this.client.nickOnChanHasPrefix(j,l,"+")};var b=function(j){var k=this.name;return this.client.nickOnChanHasPrefix(j,k,"@")};var d=function(j){var k=this.name;return this.client.nickOnChanHasPrefix(j,k,"+")};var c=function(j){return this.client.isIgnored(j)};var i=qwebirc.util.invertFn,g=qwebirc.util.composeAnd;var h=function(j){return function(k){this.client.exec("/"+j+" "+k)}};return[{text:"whois",fn:h("whois"),predicate:true},{text:"query",fn:h("query"),predicate:true},{text:"slap",fn:function(j){this.client.exec("/ME slaps "+j+" around a bit with a large fishbot")},predicate:true},{text:"kick",fn:function(j){this.client.exec("/KICK "+j+" wibble")},predicate:f},{text:"op",fn:h("op"),predicate:g(f,i(b))},{text:"deop",fn:h("deop"),predicate:g(f,b)},{text:"voice",fn:h("voice"),predicate:g(f,i(d))},{text:"devoice",fn:h("devoice"),predicate:g(f,d)},{text:"ignore",fn:h("ignore"),predicate:i(c)},{text:"unignore",fn:h("unignore"),predicate:c}]}();qwebirc.ui.WINDOW_STATUS=1;qwebirc.ui.WINDOW_QUERY=2;qwebirc.ui.WINDOW_CHANNEL=4;qwebirc.ui.WINDOW_CUSTOM=8;qwebirc.ui.WINDOW_CONNECT=16;qwebirc.ui.WINDOW_MESSAGES=32;qwebirc.ui.CUSTOM_CLIENT="custom";qwebirc.ui.DEFAULT_HUE=210;qwebirc.ui.BaseUI=new Class({Implements:[Events],initialize:function(b,d,g,c){this.options=c;this.windows=new QHash();this.clients=new QHash();this.windows.put(qwebirc.ui.CUSTOM_CLIENT,new QHash());this.windowArray=[];this.windowClass=d;this.parentElement=b;this.parentElement.addClass("qwebirc");this.parentElement.addClass("qwebirc-"+g);this.firstClient=false;this.commandhistory=new qwebirc.irc.CommandHistory();this.clientId=0;this.windowFocused=true;if(Browser.Engine.trident){var h=function(){var i=document.hasFocus();if(i!=this.windowFocused){this.windowFocused=i;this.focusChange(i)}};h.periodical(100,this)}else{var f=function(){if(this.windowFocused){this.windowFocused=false;this.focusChange(false)}}.bind(this);var a=function(){if(!this.windowFocused){this.windowFocused=true;this.focusChange(true)}}.bind(this);document.addEvent("blur",f);window.addEvent("blur",f);document.addEvent("focus",a);window.addEvent("focus",a)}qwebirc.util.__log=function(i){if(QWEBIRC_DEBUG){if(typeof console!="undefined"){console.log(i)}this.getActiveWindow().addLine(null,i)}}.bind(this)},newClient:function(b){b.id=String(this.clientId++);b.hilightController=new qwebirc.ui.HilightController(b);b.addEvent("signedOn",function(){this.poller=new qwebirc.xdomain.Poller(this.oobMessage.bind(this));this.fireEvent("signedOn",b)}.bind(this));this.windows.put(b.id,new QHash());this.clients.put(b.id,b);var a=this.newWindow(b,qwebirc.ui.WINDOW_STATUS,"Status");this.selectWindow(a);if(!this.firstClient){this.firstClient=true;a.addLine("","qwebirc v"+qwebirc.VERSION);a.addLine("","Copyright (C) 2008-2019 Chris Porter and the qwebirc project.");a.addLine("","http://www.qwebirc.org");a.addLine("","Licensed under the GNU General Public License, Version 2.")}return a},getClientId:function(a){if(a==qwebirc.ui.CUSTOM_CLIENT){return qwebirc.ui.CUSTOM_CLIENT}else{return a.id}},getWindowIdentifier:function(a,c,b){if(c==qwebirc.ui.WINDOW_MESSAGES){return"-M"}if(c==qwebirc.ui.WINDOW_STATUS){return""}if(a==qwebirc.ui.CUSTOM_CLIENT){return"_"+b}return"_"+a.toIRCLower(b)},newWindow:function(b,d,c){var a=this.getWindow(b,d,c);if($defined(a)){return a}var f=this.getWindowIdentifier(b,d,c);var a=new this.windowClass(this,b,d,c,f);this.windows.get(this.getClientId(b)).put(f,a);this.windowArray.push(a);return a},getWindow:function(a,d,b){var f=this.windows.get(this.getClientId(a));if(!$defined(f)){return null}return f.get(this.getWindowIdentifier(a,d,b))},getActiveWindow:function(){return this.active},getStatusWindow:function(a){return this.windows.get(this.getClientId(a)).get(this.getWindowIdentifier(a,qwebirc.ui.WINDOW_STATUS))},getActiveIRCWindow:function(a){if(!this.active||this.active.type==qwebirc.ui.WINDOW_CUSTOM){return this.getStatusWindow(a)}else{return this.active}},__setActiveWindow:function(a){this.active=a},renameWindow:function(d,c){if(this.getWindow(d.client,d.type,c)){return null}var a=this.getClientId(d.client);var b=this.windowArray.indexOf(d);if(b==-1){return null}this.windows.get(a).remove(d.identifier);var d=this.windowArray[b];d.name=c;d.identifier=this.getWindowIdentifier(d.client,d.type,d.name);this.windows.get(a).put(d.identifier,this.windowArray[b]);if(d.active){this.updateTitle(d.name+" - "+this.options.appTitle)}d.rename(d.name);return d},selectWindow:function(a){if(this.active){this.active.deselect()}a.select();this.updateTitle(a.name+" - "+this.options.appTitle)},updateTitle:function(a){document.title=a},nextWindow:function(b){if(this.windowArray.length==0||!this.active){return}if(!b){b=1}var a=this.windowArray.indexOf(this.active);if(a==-1){return}a=a+b;if(a<0){a=this.windowArray.length-1}else{if(a>=this.windowArray.length){a=0}}this.selectWindow(this.windowArray[a])},prevWindow:function(){this.nextWindow(-1)},__closed:function(b){if(b.active){this.active=undefined;if(this.windowArray.length==1){this.windowArray=[]}else{var a=this.windowArray.indexOf(b);if(a==-1){return}else{if(a==0){this.selectWindow(this.windowArray[1])}else{this.selectWindow(this.windowArray[a-1])}}}}this.windowArray=this.windowArray.erase(b);this.windows.get(this.getClientId(b.client)).remove(b.identifier)},loginBox:function(f,d,a,c,b){this.postInitialize();this.addCustomWindow("Connect",qwebirc.ui.ConnectPane,"connectpane",{initialNickname:d,initialChannels:a,autoConnect:c,callback:f,autoNick:b,uiOptions:this.options},qwebirc.ui.WINDOW_CONNECT)},focusChange:function(b){var a=this.getActiveWindow();if($defined(a)){a.focusChange(b)}},oobMessage:function(f){var i=f.splitMax(" ",2);if(i.length!=2){return}var h=i[0];if(h!="CMD"){return}var g=i[1].splitMax(" ",2);if(g.length!=2){return}var h=g[0];var b=g[1];if(h=="SAY"){var a=this.getActiveIRCWindow();if($defined(a)&&(a.type==qwebirc.ui.WINDOW_CHANNEL||a.type==qwebirc.ui.WINDOW_QUERY)){a.client.exec("/SAY "+b);return}}}});qwebirc.ui.StandardUI=new Class({Extends:qwebirc.ui.BaseUI,initialize:function(a,c,d,b){this.parent(a,c,d,b);this.UICommands=this.__build_menu_items(b);this.__styleValues={hue:qwebirc.ui.DEFAULT_HUE,saturation:0,lightness:0,textHue:null,textSaturation:null,textLightness:null};if($defined(this.options.hue)){this.__styleValues.hue=this.options.hue}this.tabCompleter=new qwebirc.ui.TabCompleterFactory(this);this.uiOptions=new qwebirc.ui.DefaultOptionsClass(this,b.uiOptionsArg);this.customWindows=new QHash();if($defined(this.options.saturation)){this.__styleValues.saturation=this.options.saturation}if($defined(this.options.lightness)){this.__styleValues.lightness=this.options.lightness}if($defined(this.options.tsaturation)){this.__styleValues.textSaturation=this.options.tsaturation}if($defined(this.options.tlightness)){this.__styleValues.textLightness=this.options.tlightness}if($defined(this.options.hue)){this.uiOptions.setValueByPrefix("STYLE_HUE",this.__styleValues.hue)}else{this.__styleValues.hue=this.uiOptions.STYLE_HUE}this.__styleValues.textHue=$defined(this.options.thue)?this.options.thue:this.__styleValues.hue;document.addEvent("keydown",this.__handleHotkey.bind(this))},__build_menu_items:function(b){var h=[];var g=null;for(var d=0;d<qwebirc.ui.UI_COMMANDS_P1.length;d++){h.push([true,qwebirc.ui.UI_COMMANDS_P1[d]])}for(var d=0;d<b.customMenuItems.length;d++){h.push([false,b.customMenuItems[d]])}for(var d=0;d<qwebirc.ui.UI_COMMANDS_P2.length;d++){h.push([true,qwebirc.ui.UI_COMMANDS_P2[d]])}var a=[];for(var d=0;d<h.length;d++){var f=h[d][0],j=h[d][1];if(j[0]=="About qwebirc"){if(!f){g=j;continue}else{if(g){j=g;f=false}}}if(f){a.push([j[0],this[j[1]+"Window"].bind(this)])}else{a.push([j[0],(function(i){return function(){this.addCustomWindow(i[0],qwebirc.ui.URLPane,"urlpane",{url:i[1]})}.bind(this)}).call(this,j)])}}return a},__handleHotkey:function(a){var g=false;if(!a.alt&&!a.control&&!a.shift&&!a.meta){if((a.key=="backspace"||a.key=="/")&&!this.getInputFocused(a)){g=true}}else{if(!a.alt||a.control||a.meta){}else{if(a.key=="a"||a.key=="A"){var f=0;var d=-1;g=true;for(var b=0;b<this.windowArray.length;b++){var c=this.windowArray[b].hilighted;if(c>f){d=b;f=c}}if(d>-1){this.selectWindow(this.windowArray[d])}}else{if((a.key>="0"&&a.key<="9")&&!a.shift){g=true;number=a.key-"0";if(number==0){number=10}number=number-1;if(number>=this.windowArray.length){return}this.selectWindow(this.windowArray[number])}else{if((a.key=="left"||a.key=="up")&&!a.shift){this.prevWindow();g=true}else{if((a.key=="right"||a.key=="down")&&!a.shift){this.nextWindow();g=true}}}}}}if(g){new Event(a).stop();a.preventDefault()}},getInputFocused:function(a){if($$("input").indexOf(a.target)==-1&&$$("textarea").indexOf(a.target)==-1){return false}return true},newCustomWindow:function(c,a,d){if(!d){d=qwebirc.ui.WINDOW_CUSTOM}var b=this.newWindow(qwebirc.ui.CUSTOM_CLIENT,d,c);b.addEvent("close",function(f){this.windows.get(qwebirc.ui.CUSTOM_CLIENT).remove(f.identifier)}.bind(this));if(a){this.selectWindow(b)}return b},addCustomWindow:function(c,a,b,f,h){if(!$defined(f)){f={}}if(this.customWindows.contains(c)){this.selectWindow(this.customWindows.get(c));return}var i=this.newCustomWindow(c,true,h);this.customWindows.put(c,i);i.addEvent("close",function(){this.customWindows.remove(c)}.bind(this));if(b){i.lines.addClass("qwebirc-"+b)}var g=new a(i.lines,f);g.addEvent("close",function(){i.close()}.bind(this));i.setSubWindow(g)},embeddedWindow:function(){this.addCustomWindow("Add webchat to your site",qwebirc.ui.EmbedWizard,"embeddedwizard",{baseURL:this.options.baseURL,uiOptions:this.uiOptions,optionsCallback:function(){this.optionsWindow()}.bind(this)})},optionsWindow:function(){this.addCustomWindow("Options",qwebirc.ui.OptionsPane,"optionspane",this.uiOptions)},aboutWindow:function(){this.addCustomWindow("About qwebirc",qwebirc.ui.AboutPane,"aboutpane",this.uiOptions)},urlDispatcher:function(a,b){if(a=="embedded"){return["a",this.embeddedWindow.bind(this)]}if(a=="options"){return["a",this.optionsWindow.bind(this)]}if(a=="whois"){return["span",function(c){if(this.uiOptions.QUERY_ON_NICK_CLICK){b.client.exec("/QUERY "+c)}else{b.client.exec("/WHOIS "+c)}}.bind(this)]}return null},tabComplete:function(b,a){this.tabCompleter.tabComplete(b,a)},resetTabComplete:function(){this.tabCompleter.reset()},setModifiableStylesheet:function(a){this.__styleSheet=new qwebirc.ui.style.ModifiableStylesheet(qwebirc.global.staticBaseURL+"css/"+(QWEBIRC_DEBUG?"debug/":"")+a+qwebirc.FILE_SUFFIX+".mcss");this.setModifiableStylesheetValues({})},setModifiableStylesheetValues:function(c){for(var b in c){this.__styleValues[b]=c[b]}if(!$defined(this.__styleSheet)){return}var a={hue:this.__styleValues.hue,lightness:this.__styleValues.lightness,saturation:this.__styleValues.saturation};var d;if(!$defined(this.__styleValues.textHue)&&!$defined(this.__styleValues.textLightness)&&!$defined(this.__styleValues.textSaturation)){d=a}else{d={hue:Number(this.__styleValues.textHue),lightness:Number(this.__styleValues.textLightness),saturation:Number(this.__styleValues.textSaturation)}}var f={back:a,front:d};this.__styleSheet.set(function(){var i=arguments[0];if(i=="c"){var h=f[arguments[2]];var g=new Color(arguments[1]);var j=g.setHue(h.hue).setSaturation(g.hsb[1]+h.saturation).setBrightness(g.hsb[2]+h.lightness);if(j=="255,255,255"){j="255,255,254"}return"rgb("+j+")"}else{if(i=="o"){return this.uiOptions[arguments[1]]?arguments[2]:arguments[3]}}}.bind(this))}});qwebirc.ui.NotificationUI=new Class({Extends:qwebirc.ui.StandardUI,initialize:function(a,c,d,b){this.parent(a,c,d,b);this.__beeper=new qwebirc.ui.Beeper(this.uiOptions);this.__flasher=new qwebirc.ui.Flasher(this.uiOptions);this.__notifier=new qwebirc.ui.Notifier(this.uiOptions);this.cancelFlash=this.__flasher.cancelFlash.bind(this.__flasher)},beep:function(a){this.__beeper.beep(a)},notify:function(b,a,c){this.__beeper.beep(true);this.__flasher.flash();this.__notifier.notify(b,a,c)},setNotifications:function(a){this.__notifier.setEnabled(a)},updateTitle:function(a){if(this.__flasher.updateTitle(a)){this.parent(a)}},focusChange:function(a){this.parent(a);this.__flasher.focusChange(a);this.__notifier.focusChange(a)}});qwebirc.ui.QuakeNetUI=new Class({Extends:qwebirc.ui.NotificationUI,urlDispatcher:function(a,b){if(a=="qwhois"){return["span",function(c){if($defined(this.parentObject.options.accountWhoisCommand)){this.client.exec(this.parentObject.options.accountWhoisCommand+c)}}.bind(b)]}return this.parent(a,b)},logout:function(){if(!qwebirc.auth.loggedin(true)){this.getActiveWindow().errorMessage("Not logged in!");return}if(confirm("Log out?")){this.clients.each(function(c,b){b.quit("Logged out")},this);var a=function(){document.location="/auth?logout=1"};a.delay(500)}}});qwebirc.ui.RootUI=qwebirc.ui.QuakeNetUI;qwebirc.ui.RequestTransformHTML=function(a){var b={IMG:1};var f=a.update;var d=a.onSuccess;var c=function(k){if(k.nodeType!=1){return}var j=k.nodeName.toUpperCase();if(b[j]){var g=k.getAttribute("transform_attr");var l=k.getAttribute("transform_value");if($defined(g)&&$defined(l)){k.removeAttribute("transform_attr");k.removeAttribute("transform_value");k.setAttribute(g,qwebirc.global.staticBaseURL+l)}}for(var h=0;h<k.childNodes.length;h++){c(k.childNodes[h])}};delete a.update;a.onSuccess=function(h,k,j,l){var i=new Element("div");i.set("html",j);c(i);f.empty();while(i.childNodes.length>0){var g=i.firstChild;i.removeChild(g);f.appendChild(g)}d()};return new Request.HTML(a)};qwebirc.ui.HILIGHT_NONE=0;qwebirc.ui.HILIGHT_ACTIVITY=1;qwebirc.ui.HILIGHT_SPEECH=2;qwebirc.ui.HILIGHT_US=3;qwebirc.ui.MAXIMUM_LINES_PER_WINDOW=1000;qwebirc.ui.WINDOW_LASTLINE=qwebirc.ui.WINDOW_QUERY|qwebirc.ui.WINDOW_MESSAGES|qwebirc.ui.WINDOW_CHANNEL|qwebirc.ui.WINDOW_STATUS;qwebirc.ui.Window=new Class({Implements:[Events],initialize:function(f,a,d,c,b){this.parentObject=f;this.type=d;this.name=c;this.active=false;this.client=a;this.identifier=b;this.hilighted=qwebirc.ui.HILIGHT_NONE;this.scrolltimer=null;this.commandhistory=this.parentObject.commandhistory;this.scrolleddown=true;this.scrollpos=null;this.lastNickHash=new QHash();this.lastSelected=null;this.subWindow=null;this.closed=false;if(this.type&qwebirc.ui.WINDOW_LASTLINE){this.lastPositionLine=new Element("hr");this.lastPositionLine.addClass("lastpos");this.lastPositionLineInserted=false}},updateTopic:function(a,b){qwebirc.ui.Colourise(a,b,this.client.exec,this.parentObject.urlDispatcher.bind(this.parentObject),this)},close:function(){this.closed=true;if($defined(this.scrolltimer)){$clear(this.scrolltimer);this.scrolltimer=null}this.parentObject.__closed(this);this.fireEvent("close",this)},subEvent:function(a){if($defined(this.subWindow)){this.subWindow.fireEvent(a)}},setSubWindow:function(a){this.subWindow=a},select:function(){if(this.lastPositionLineInserted&&!this.parentObject.uiOptions.LASTPOS_LINE){this.lines.removeChild(this.lastPositionLine);this.lastPositionLineInserted=false}this.active=true;this.parentObject.__setActiveWindow(this);if(this.hilighted){this.setHilighted(qwebirc.ui.HILIGHT_NONE)}this.subEvent("select");this.resetScrollPos();this.lastSelected=new Date()},deselect:function(){this.subEvent("deselect");this.setScrollPos();if($defined(this.scrolltimer)){$clear(this.scrolltimer);this.scrolltimer=null}if(this.type&qwebirc.ui.WINDOW_LASTLINE){this.replaceLastPositionLine()}this.active=false},resetScrollPos:function(){if(this.scrolleddown){this.scrollToBottom()}else{if($defined(this.scrollpos)){this.getScrollParent().scrollTo(this.scrollpos.x,this.scrollpos.y)}}},setScrollPos:function(){if(!this.parentObject.singleWindow){this.scrolleddown=this.scrolledDown();this.scrollpos=this.lines.getScroll()}},addLine:function(h,l,a,d){var b=qwebirc.ui.HILIGHT_NONE;var i=false;if(h){b=qwebirc.ui.HILIGHT_ACTIVITY;if(h.match(/(NOTICE|ACTION|MSG)$/)){var k=$defined(l)?l.m:null;if(h.match(/^OUR/)){if(h.match(/NOTICE$/)){}else{b=qwebirc.ui.HILIGHT_SPEECH}}else{if(this.client.hilightController.match(k)){b=qwebirc.ui.HILIGHT_US;i=true}else{if(h.match(/NOTICE$/)){}else{if(this.type==qwebirc.ui.WINDOW_QUERY||this.type==qwebirc.ui.WINDOW_MESSAGES){b=qwebirc.ui.HILIGHT_US}else{b=qwebirc.ui.HILIGHT_SPEECH}}}}if(b==qwebirc.ui.HILIGHT_US){var j=this.parentObject.theme.message("NOTIFY"+h+"TITLE",l,false);var f=this.parentObject.theme.message("NOTIFY"+h+"BODY",l,false);var g=function(){this.parentObject.selectWindow(this)}.bind(this);this.parentObject.notify(j,f,g)}}}if(!this.active&&(b!=qwebirc.ui.HILIGHT_NONE)){this.setHilighted(b)}if(h){l=this.parentObject.theme.message(h,l,i)}var c=document.createElement("span");c.className="timestamp";c.appendChild(document.createTextNode(qwebirc.irc.IRCTimestamp(new Date())+" "));d.appendChild(c);qwebirc.ui.Colourise(l,d,this.client.exec,this.parentObject.urlDispatcher.bind(this.parentObject),this);this.scrollAdd(d)},errorMessage:function(a){this.addLine("",a,"warncolour")},infoMessage:function(a,b){if(b===undefined){this.addLine("",a,"infocolour")}else{this.addLine(a,b,"infocolour")}},setHilighted:function(a){if(a==qwebirc.ui.HILIGHT_NONE||a>=this.hilighted){this.hilighted=a}},scrolledDown:function(){if(this.scrolltimer){return true}var b=this.lines;var d=b.getScroll().y;var a=b.getScrollSize().y;var c=b.clientHeight;if(a<c){a=c}return d+c>=a-3},getScrollParent:function(){var a=this.lines;if($defined(this.scroller)){a=this.scroller}return a},scrollToBottom:function(){if(this.type==qwebirc.ui.WINDOW_CUSTOM||this.type==qwebirc.ui.WINDOW_CONNECT){return}var b=this.lines;var a=this.getScrollParent();a.scrollTo(b.getScroll().x,b.getScrollSize().y)},scrollAdd:function(a){var b=this.lines;if($defined(a)){var c=this.scrolledDown();b.appendChild(a);if(b.childNodes.length>qwebirc.ui.MAXIMUM_LINES_PER_WINDOW){b.removeChild(b.firstChild)}if(c&&!this.scrollTimer){this.scrolltimer=this.scrollAdd.delay(50,this,[null])}}else{this.scrollToBottom();this.scrolltimer=null}},updateNickList:function(d){var c=new QHash(),j=new QSet();var g=[];var b=this.lastNickHash;for(var f=0;f<d.length;f++){j.add(d[f])}b.each(function(l,i){if(!j.contains(l)){this.nickListRemove(l,i)}},this);for(var f=0;f<d.length;f++){var h=d[f];var a=b.get(h);if(!a){a=this.nickListAdd(h,f);if(!a){a=1}}c.put(h,a)}this.lastNickHash=c},nickListAdd:function(b,a){},nickListRemove:function(a,b){},historyExec:function(a){this.commandhistory.addLine(a);this.client.exec(a)},focusChange:function(a){if(a==true||!(this.type&qwebirc.ui.WINDOW_LASTLINE)){return}this.replaceLastPositionLine()},replaceLastPositionLine:function(){if(this.parentObject.uiOptions.LASTPOS_LINE){if(!this.scrolledDown()){return}if(!this.lastPositionLineInserted){this.scrollAdd(this.lastPositionLine)}else{if(this.lines.lastChild!=this.lastPositionLine){try{this.lines.removeChild(this.lastPositionLine)}catch(a){}this.scrollAdd(this.lastPositionLine)}}}else{if(this.lastPositionLineInserted){this.lines.removeChild(this.lastPositionLine)}}this.lastPositionLineInserted=this.parentObject.uiOptions.LASTPOS_LINE},rename:function(a){}});qwebirc.ui.Colourise=function(m,n,r,a,j){var q;var d;var k=false;var t=false;var g=false;var C=false;var y=[];var o=m.split("");var b=document.createElement("span");n.addClass("colourline");function s(c){return c>="0"&&c<="9"}function A(D,c){if(!s(D[c+1])){q=undefined;d=undefined;return c}c++;if(s(D[c+1])){q=parseInt(D[c]+D[c+1]);c++}else{q=parseInt(D[c])}if(D[c+1]!=","){return c}if(!s(D[c+2])){return c}c+=2;if(s(D[c+1])){d=parseInt(D[c]+D[c+1]);c++}else{d=parseInt(D[c])}return c}function f(){var c="";if(y.length>0){var i=y.join("");if(r){c=qwebirc.ui.urlificate(b,i,r,a,j)}else{c=i;b.appendChild(document.createTextNode(i))}n.appendChild(b);y=[]}b=document.createElement("span");return c}function l(){if(C){return b}var c=[];if(q!=undefined){c.push("Xc"+q)}if(d!=undefined){c.push("Xbc"+d)}if(t){c.push("Xb")}if(k){c.push("Xu")}if(g){c.push("Xi")}b.className=c.join(" ")}var v=j.parentObject.uiOptions.NICK_COLOURS;var h=false;for(var x=0;x<o.length;x++){var u=o[x];if(v){if(!h){if(u=="\x00"){h=true;f();continue}}else{if(u!="\x00"){y.push(u)}else{C=true;var z=l();var p=f();p=p.replace("/>/g",">>>");var B=p.toHSBColour(j.client);if($defined(B)){z.style.color=B.rgbToHex()}h=C=false}continue}}else{if(u=="\x00"){continue}}if(u=="\x02"){f();t=!t;l()}else{if(u=="\x1F"){f();k=!k;l()}else{if(u=="\x1D"){f();g=!g;l()}else{if(u=="\x0F"){f();q=undefined;d=undefined;k=false;g=false;t=false}else{if(u=="\x03"){f();x=A(o,x);if(d>=99){d=undefined}if(q>=99){q=undefined}l()}else{y.push(u)}}}}}}f()};String.prototype.toHSBColour=function(a){var c=a.toIRCLower(a.stripPrefix(this));if(c==a.lowerNickname){return null}var f=0;for(var d=0;d<c.length;d++){f=31*f+c.charCodeAt(d)}var b=Math.abs(f)%360;return new Color([b,70,60],"hsb")};qwebirc.ui.urlificate=function(b,k,f,c,g){var i=/[[\)|\]>]?(\.*|[\,;])$/;var j=[];var l=function(v,u,s,o){for(;;){var q=v.search(u);if(q==-1){s(v);break}var p=v.match(u);var t=v.substring(0,q);var n=p[0];var m=v.substring(q+n.length);s(t);var r=o(n,s);if(!r){r=""}v=r+m}};var a=function(m){j.push(m);qwebirc.util.NBSPCreate(m,b)};var h=function(o){var p=o.replace(i,"");j.push(p);var n=o.substring(p.length);var m=new Element("span");m.addClass("hyperlink-channel");m.addEvent("click",function(q){new Event(q).stop();f("/JOIN "+p)});m.appendChild(document.createTextNode(p));b.appendChild(m);return n};var d=function(B,x){var n=B.replace(i,"");var p=B.substring(n.length);var o="";var y=null;var v="_blank";var s=n;var u="a";var t;var A=n.match(/^qwebirc:\/\/(.*)$/);if(A){var r=A[1].match(/^([^\/]+)\/([^\/]+)\/?(.*)$/);if(!r){x(B);return}var q=c(r[1],g);if(q){t=r[1];u=q[0];if(q[0]!="a"){n=null}else{n="#"}y=q[1];s=unescape(r[2]);v=null}else{x(B);return}if(r[3]){p=r[3]+p}}else{if(n.match(/^www\./)){n="http://"+n}}var z=new Element(u);if(t){z.addClass("hyperlink-"+t)}if(n){z.href=n;if(v){z.target=v;z.setAttribute("rel","noopener noreferrer")}}j.push(s);z.appendChild(document.createTextNode(s));b.appendChild(z);if($defined(y)){z.addEvent("click",function(m){new Event(m).stop();y(s)})}return p};l(k,/\b((https?|ftp|qwebirc):\/\/|www\.)[^ ]+/,function(m){l(m,/\B#[^ ,]+/,a,h)},d);return j.join("")};qwebirc.ui.themes.ThemeControlCodeMap={C:"\x03",B:"\x02",U:"\x1F",O:"\x0F","{":"\x00","}":"\x00","[":"qwebirc://whois/","]":"/","$":"$"};qwebirc.ui.themes.Default={PREFIX:["$C4==$O "],SIGNON:["Signed on!",true],CONNECTING:["Connecting to server, please wait...",true],CONNECT:["Logging in, please wait...",true],CONNECTED:["Connected and logged in -- ready to go!",true],RAW:["$m",true],DISCONNECT:["Disconnected from server: $m",true],ERROR:["ERROR: $m",true],SERVERNOTICE:["$m",true],JOIN:["${$N$} [$h] has joined $c",true],OURJOIN:["${$N$} [$h] has joined $c",true],PART:["${$N$} [$h] has left $c [$m]",true],KICK:["${$v$} was kicked from $c by ${$N$} [$m]",true],MODE:["mode/$c [$m] by ${$N$}",true],QUIT:["${$N$} [$h] has quit [$m]",true],NICK:["${$n$} has changed nick to ${$[$w$]$}",true],TOPIC:["${$N$} changed the topic of $c to: $m",true],UMODE:["Usermode change: $m",true],INVITE:["$N invites you to join $c",true],HILIGHT:["$C4"],HILIGHTEND:["$O"],CHANMSG:["<$C14$@$O${$($N$)$}> $m"],PRIVMSG:["<$($N$)> $m"],CHANNOTICE:["-${$($N$)$}:$c- $m"],PRIVNOTICE:["-$($N$)- $m"],OURCHANMSG:["<$C14$@$O$U$N$O> $m"],OURPRIVMSG:["<$U$N$O> $m"],OURTARGETEDMSG:["*$[$t$]* $m"],OURTARGETEDNOTICE:["[notice($[$t$])] $m"],OURCHANNOTICE:["-$N:$t- $m"],OURPRIVNOTICE:["-$N- $m"],OURCHANACTION:[" * $U$N$O $m"],OURPRIVACTION:[" * $U$N$O $m"],CHANACTION:[" * ${$($N$)$} $m"],PRIVACTION:[" * $($N$) $m"],CHANCTCP:["$N [$h] requested CTCP $x from $c: $m"],PRIVCTCP:["$N [$h] requested CTCP $x from $-: $m"],CTCPREPLY:["CTCP $x reply from $N: $m"],OURCHANCTCP:["[ctcp($t)] $x $m"],OURPRIVCTCP:["[ctcp($t)] $x $m"],OURTARGETEDCTCP:["[ctcp($t)] $x $m"],WHOISUSER:["$B$N$B [$h]",true],WHOISREALNAME:[" realname : $m",true],WHOISCHANNELS:[" channels : $m",true],WHOISSERVER:[" server   : $x [$m]",true],WHOISACCOUNT:[" account  : qwebirc://qwhois/$m",true],WHOISIDLE:[" idle     : $x [connected: $m]",true],WHOISAWAY:[" away     : $m",true],WHOISOPER:["          : $BIRC Operator$B",true],WHOISOPERNAME:[" operedas : $m",true],WHOISACTUALLY:[" realhost : $m [ip: $x]",true],WHOISGENERICTEXT:["          : $m",true],WHOISEND:["End of WHOIS",true],AWAY:["$N is away: $m",true],GENERICERROR:["$m: $t",true],GENERICMESSAGE:["$m",true],WALLOPS:["WALLOP $n: $t",true],CHANNELCREATIONTIME:["Channel $c was created at: $m",true],CHANNELMODEIS:["Channel modes on $c are: $m",true],IGNORED:["Ignored $n, to unignore type: /UNIGNORE $n",false],UNIGNORED:["Unignored $n.",false],IGNOREHEADER:["Ignore list:",false],IGNOREENTRY:["- $h",false],IGNOREEMPTY:["Ignore list is empty.",false],SILENCE:["Silenced: $h",false],NOTIFYCHANMSGTITLE:["Mentioned on $c:",false],NOTIFYCHANMSGBODY:["<$@$n> $m",false],NOTIFYCHANACTIONTITLE:["Mentioned on $c:",false],NOTIFYCHANACTIONBODY:[" * $n $m",false],NOTIFYPRIVMSGTITLE:["Private message from $n:",false],NOTIFYPRIVMSGBODY:["$m",false],NOTIFYPRIVACTIONTITLE:["Private message from $n:",false],NOTIFYPRIVACTIONBODY:[" * $n $m",false],NOTIFYCHANNOTICETITLE:["Mentioned on $c:",false],NOTIFYCHANNOTICEBODY:["-$n- $m",false],NOTIFYPRIVNOTICETITLE:["Private notice from $n:",false],NOTIFYPRIVNOTICEBODY:["$m",false]};qwebirc.ui.Theme=new Class({initialize:function(b){this.__theme=qwebirc.util.dictCopy(qwebirc.ui.themes.Default);if(b){for(var a in b){this.__theme[a]=b[a]}}for(var a in this.__theme){if(a=="PREFIX"){continue}var c=this.__theme[a];if(c[1]){this.__theme[a]=this.__theme.PREFIX+c[0]}else{this.__theme[a]=c[0]}}this.__ccmap=qwebirc.util.dictCopy(qwebirc.ui.themes.ThemeControlCodeMap);this.__ccmaph=qwebirc.util.dictCopy(this.__ccmap);this.__ccmaph["("]=this.message("HILIGHT",{},this.__ccmap);this.__ccmaph[")"]=this.message("HILIGHTEND",{},this.__ccmap);this.__ccmaph["{"]=this.__ccmaph["}"]=""},__dollarSubstitute:function(m,k,a){var f=[];var d=m.split("");for(var j=0;j<d.length;j++){var l=d[j];if(l=="$"&&(j<=d.length-1)){var g=d[++j];var b=a[g];if(!b){b=k[g]}if(b){f.push(b)}}else{f.push(l)}}return f.join("")},message:function(b,c,a){var d;if(a){d=this.__ccmaph}else{d=this.__ccmap}if(c&&c.n){c.N="qwebirc://whois/"+c.n+"/"}return this.__dollarSubstitute(this.__theme[b],c,d)}});qwebirc.ui.HilightController=new Class({initialize:function(a){this.parent=a;this.regex=null;this.prevnick=null},match:function(c){var a=this.parent.nickname;if(a!=this.prevnick){var b="[\\s\\.,;:]";this.regex=new RegExp("(^|"+b+")"+RegExp.escape(a)+"("+b+"|$)","i")}if(c.match(this.regex)){return true}return false}});qwebirc.ui.Beeper=new Class({initialize:function(a){this.uiOptions=a;this.soundPlayer=new qwebirc.sound.SoundPlayer()},beep:function(a){if(a&&!this.uiOptions.BEEP_ON_MENTION){return}this.soundPlayer.play("beep3.mp3")}});qwebirc.ui.Flasher=new Class({initialize:function(b){this.uiOptions=b;this.windowFocused=false;this.canUpdateTitle=true;this.titleText=document.title;var a=this._getFavIcon();if($defined(a)){this.favIcon=a;this.favIconParent=a.parentNode;this.favIconVisible=true;this.emptyFavIcon=new Element("link");this.emptyFavIcon.rel="shortcut icon";this.emptyFavIcon.href=qwebirc.global.staticBaseURL+"images/empty_favicon.ico";this.emptyFavIcon.type="image/x-icon";this.flashing=false;this.canFlash=true;document.addEvent("mousedown",this.cancelFlash.bind(this));document.addEvent("keydown",this.cancelFlash.bind(this))}else{this.canFlash=false}},_getFavIcon:function(){var b=$$("head link");for(var a=0;a<b.length;a++){if(b[a].getAttribute("rel")=="shortcut icon"){return b[a]}}},flash:function(){if(!this.uiOptions.FLASH_ON_MENTION||this.windowFocused||!this.canFlash||this.flashing){return}this.titleText=document.title;var b=function(){this.hideFavIcon();this.canUpdateTitle=false;document.title="Activity!";this.flasher=a.delay(500)}.bind(this);var a=function(){this.showFavIcon();this.canUpdateTitle=true;document.title=this.titleText;this.flasher=b.delay(500)}.bind(this);this.flashing=true;b()},cancelFlash:function(){if(!this.canFlash||!$defined(this.flasher)){return}this.flashing=false;$clear(this.flasher);this.flasher=null;this.showFavIcon();document.title=this.titleText;this.canUpdateTitle=true},hideFavIcon:function(){if(this.favIconVisible){this.favIconVisible=false;this.favIconParent.removeChild(this.favIcon);this.favIconParent.appendChild(this.emptyFavIcon)}},showFavIcon:function(){if(!this.favIconVisible){this.favIconVisible=true;this.favIconParent.removeChild(this.emptyFavIcon);this.favIconParent.appendChild(this.favIcon)}},updateTitle:function(a){this.titleText=a;return this.canUpdateTitle},focusChange:function(a){this.windowFocused=a;if(a){this.cancelFlash()}}});qwebirc.ui.Notifier=new Class({initialize:function(a){this.uiOptions=a;this.windowFocused=false;this.previous=null;this.setEnabled(this.uiOptions.NOTIFICATIONS)},focusChange:function(a){this.windowFocused=a},setEnabled:function(a){this.enabled=a;if(!a){return}if(this.isGranted()){return}Notification.requestPermission(function(b){if(!("permission" in Notification)){Notification.permission=b}})},isGranted:function(){if(!("Notification" in window)){return false}return Notification.permission==="granted"},notify:function(c,b,f){if(this.windowFocused&&!this.enabled||!this.isGranted()){return}if(this.previous){this.previous.close()}var d=new Notification(c,{body:b,icon:qwebirc.global.staticBaseURL+"images/qwebircsmall.png"});var a=function(){d.close();this.previous=null}.bind(this).delay(5000);this.previous=d;if(f){d.addEventListener("click",function(){this.previous=null;window.focus();f()});d.addEventListener("close",function(){this.previous=null}.bind(this))}}});qwebirc.ui.TabCompleterFactory=new Class({initialize:function(a){this.ui=a;this.reset()},tabComplete:function(g,h){var j=g.value;if(!$defined(this.obj)){this.incr=1;var i=this.ui.getActiveWindow();if(!i){return}var c=qwebirc.util.getEnclosedWord(j,qwebirc.util.getCaretPos(g));var k="",b="",d="";if($defined(c)){var k=j.substring(0,c[0]);var b=c[1];var d=j.substring(c[0]+b.length)}var f=j.toLowerCase();if(j==""){k="/msg ";obj=qwebirc.ui.QueryTabCompleter}else{if(i.client.isChannel(b)){obj=qwebirc.ui.ChannelNameTabCompleter}else{if(f.match(/^\/(q|query|msg) /i)){obj=qwebirc.ui.QueryTabCompleter}else{if(i.type==qwebirc.ui.WINDOW_QUERY){obj=qwebirc.ui.QueryNickTabCompleter}else{if(i.type==qwebirc.ui.WINDOW_CHANNEL){if(k==""){if((d!="")&&d.charAt(0)==" "){d=":"+d}else{d=": "+d}this.incr++}obj=qwebirc.ui.ChannelUsersTabCompleter}else{return}}}}}if(d==""){d=" "}this.obj=new obj(k,b,d,i);if(!$defined(this.obj)){return}}var a=this.obj.get(h);if(!$defined(a)){return}g.value=a[1];qwebirc.util.setCaretPos(g,a[0]+this.incr)},reset:function(){this.obj=null}});qwebirc.ui.TabIterator=new Class({initialize:function(c,h,g){this.prefix=h;if(!$defined(g)||g.length==0){this.list=null}else{var b=[];var f=qwebirc.irc.toIRCCompletion(c,h);for(var d=0;d<g.length;d++){var a=qwebirc.irc.toIRCCompletion(c,g[d]);if(a.startsWith(f)){b.push(g[d])}}this.list=b}this.pos=-1},next:function(){if(!$defined(this.list)||this.list.length==0){return null}this.pos=this.pos+1;if(this.pos>=this.list.length){this.pos=0}return this.list[this.pos]},prev:function(){if(!$defined(this.list)||this.list.length==0){return null}this.pos=this.pos-1;if(this.pos<0){this.pos=this.list.length-1}return this.list[this.pos]}});qwebirc.ui.BaseTabCompleter=new Class({initialize:function(a,c,f,d,b){this.existingNick=f;this.prefix=c;this.suffix=d;this.iterator=new qwebirc.ui.TabIterator(a,f,b)},get:function(a){var c=a?this.iterator.prev():this.iterator.next();if(!$defined(c)){return null}var b=this.prefix+c;return[b.length,b+this.suffix]}});qwebirc.ui.QueryTabCompleter=new Class({Extends:qwebirc.ui.BaseTabCompleter,initialize:function(b,d,c,a){this.parent(a.client,b,d,c,a.client.lastNicks)}});qwebirc.ui.QueryNickTabCompleter=new Class({Extends:qwebirc.ui.BaseTabCompleter,initialize:function(c,f,d,b){var a=b.name;this.parent(b.client,c,f,d,[a])}});qwebirc.ui.ChannelNameTabCompleter=new Class({Extends:qwebirc.ui.BaseTabCompleter,initialize:function(f,j,h,d){var g=d.parentObject.windows.get(d.parentObject.getClientId(d.client));var b=d.client.channels.map(function(k){var i=g.get(k);if($defined(i)){i=i.lastSelected}return[i,k]});b.sort(function(k,i){return i[0]-k[0]});var a=[];for(var c=0;c<b.length;c++){a.push(b[c][1])}this.parent(d.client,f,j,h,a)}});qwebirc.ui.ChannelUsersTabCompleter=new Class({Extends:qwebirc.ui.BaseTabCompleter,initialize:function(b,d,c,a){var f=a.client.tracker.getSortedByLastSpokePrefix(a.name);this.parent(a.client,b,d,c,f)}});qwebirc.ui.style.ModifiableStylesheet=new Class({initialize:function(a){var b=this.__parseStylesheet(this.__getStylesheet(a),a);this.__cssText=b.cssText;this.rules=b.rules;this.__tag=this.__createTag()},__createTag:function(){var a=document.createElement("style");a.type="text/css";a.media="all";document.getElementsByTagName("head")[0].appendChild(a);return a},__getStylesheet:function(b){var c=new Request({url:b,async:false});var a;c.addEvent("complete",function(d){a=d});c.get();return a},__setStylesheet:function(a){var b=this.__tag;if(b.styleSheet){b.styleSheet.cssText=a}else{var c=document.createTextNode(a);b.appendChild(c);while(b.childNodes.length>1){b.removeChild(b.firstChild)}}},__parseStylesheet:function(c,a){var j=c.replace("\r\n","\n").split("\n");var b=new URI(".",{base:a}).toString();var h={};var d;for(d=0;d<j.length;d++){var k=j[d];if(k.trim()===""){break}var g=k.splitMax("=",2);if(g.length!=2){continue}h[g[0]]=g[1]}var f=[];for(;d<j.length;d++){var k=j[d];k=k.replaceAll("$(base_url)",b);f.push(k)}return{cssText:f.join("\n"),rules:h}},set:function(f){if(!$defined(f)){f=function(g){return g}}var d=this.__cssText;for(var a in this.rules){var b=this.rules[a].split(",");var c=f.pass(b);d=d.replaceAll("$("+a+")",c)}this.__setStylesheet(d)}});qwebirc.xdomain.Poller=new Class({initialize:function(a){this._callback=a;this._poll.periodical(100,this);this._lastValue=null;this._counter=-1},_poll:function(){var g=window.location.href;if(g===null||g===undefined||g==this._lastValue){return}this._lastValue=g;var c=g.splitMax("#",2)[1];if(c===undefined||c.substr(0,6)!="qwmsg:"){return}var f=c.substr(6).split(":",3);var b=parseInt(f[0]);if(b<=this._counter){return}this._counter=b;var a=parseInt(f[1]);var d=decodeURIComponent(f[2]);if(a!=d.length){return}d=d.replaceAll("\000","").replaceAll("\n","").replaceAll("\r","");this._callback(d)}});qwebirc.ui.ConnectPane=new Class({Implements:[Events],initialize:function(j,l){var k=l.callback,b=l.initialNickname,g=l.initialChannels,h=l.autoConnect,f=l.autoNick;this.options=l;this.cookie=new Hash.Cookie("optconn",{duration:3650,autoSave:false});var c=l.uiOptions;this.__windowName="authgate_"+Math.floor(Math.random()*100000);var i=function(){j.set("html",'<div class="loading">Loading. . .</div>')};var d=i.delay(500);var a=qwebirc.ui.RequestTransformHTML({url:qwebirc.global.staticBaseURL+"panes/connect.html",update:j,onSuccess:function(){$clear(d);var m=j.getElement("[name=connectroot]");this.rootElement=m;this.util.exec=function(y,v){m.getElements(y).each(v)};var q=this.util;var n=q.exec;var p=(h?"confirm":"login");n("[name="+p+"box]",q.setVisible(true));if(!h){if($defined(c.logoURL)){var r=j.getElement("[class=bar-logo]");if(c.logoURL){r.setAttribute("style","background: url("+c.logoURL+") no-repeat center top; _filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+c.logoURL+"',sizingMethod='crop');")}q.makeVisible(j.getElement("[name=loginheader]"))}else{q.makeVisible(j.getElement("[name=nologologinheader]"))}}if(b===null&&g===null){var s=this.cookie.get("nickname");if(s!==null){b=s}var o=this.cookie.get("autojoin");if(o!==null){g=o}}if(g===null){g="#All4Masti"}n("[name=nickname]",q.setText(b));n("[name=channels]",q.setText(g));n("[name=prettychannels]",function(v){this.__buildPrettyChannels(v,g)}.bind(this));n("[name=networkname]",q.setText(c.networkName));var u="connect";if(h){if(!f){n("[name=nickselected]",q.makeVisible)}this.__validate=this.__validateConfirmData}else{if(!b){u="nickname"}else{if(b&&!g){u="channels"}}this.__validate=this.__validateLoginData}var t=qwebirc.auth.loggedin(true);if(t){n("[name=authname]",q.setText(t[0]));n("[name=connectbutton]",q.makeVisible);n("[name=loginstatus]",q.makeVisible)}else{if(qwebirc.ui.isAuthRequired()){n("[name=loginconnectbutton]",q.makeVisible);if(u=="connect"){u="loginconnect"}}else{n("[name=connectbutton]",q.makeVisible);n("[name=loginbutton]",q.makeVisible)}}if(window==window.top){n("[name="+u+"]",q.focus)}n("[name=connect]",q.attachClick(this.__connect.bind(this)));n("[name=loginconnect]",q.attachClick(this.__loginConnect.bind(this)));n("[name=login]",q.attachClick(this.__login.bind(this)));if(qwebirc.ui.isHideAuth()){n("[name=login]",q.setVisible(false))}}.bind(this)});a.get()},util:{makeVisible:function(a){a.setStyle("display","")},setVisible:function(a){return function(b){b.setStyle("display",a?"":"none")}},focus:function(a){try{a.focus()}catch(b){}},attachClick:function(a){return function(b){b.addListener("click",a)}},setText:function(a){return function(b){if(typeof b.value==="undefined"){b.set("text",a)}else{b.value=a===null?"":a}}}},validate:function(){return this.__validate()},__connect:function(b){new Event(b).stop();var a=this.validate();if(a===false){return}this.__cancelLogin();this.fireEvent("close");this.cookie.extend(a);this.cookie.save();this.options.callback(a)},__cancelLogin:function(a){if(this.__cancelLoginCallback){this.__cancelLoginCallback(a)}},__loginConnect:function(a){new Event(a).stop();if(this.validate()===false){return}this.__performLogin(function(){var b=this.validate();if(b===false){this.util.exec("[name=connectbutton]",this.util.setVisible(true));return}this.fireEvent("close");this.options.callback(b)}.bind(this),"loginconnectbutton")},__login:function(a){new Event(a).stop();this.__cancelLogin(true);this.__performLogin(function(){var c="connect";if(!this.options.autoConnect){var b=this.rootElement.getElement("input[name=nickname]").value,d=this.rootElement.getElement("input[name=channels]").value;if(!b){c="nickname"}else{if(!d){c="channels"}}}this.util.exec("[name="+c+"]",this.util.focus)}.bind(this),"login")},__performLogin:function(f,b){var a=window.open("/auth",this.__windowName,"status=0,toolbar=0,location=1,menubar=0,directories=0,resizable=0,scrollbars=1,height=280,width=550");if(a===null||a===undefined){return}var c=function(){if(a.closed){this.__cancelLoginCallback()}}.bind(this);var d=c.periodical(100);this.__cancelLoginCallback=function(g){$clear(d);try{a.close()}catch(h){}if(!g){this.util.exec("[name=loggingin]",this.util.setVisible(false));this.util.exec("[name="+b+"]",this.util.setVisible(true))}this.__cancelLoginCallback=null}.bind(this);__qwebircAuthCallback=function(i,g,h){if(typeof sessionStorage==="undefined"){alert("No session storage support in this browser -- login not supported");this.__cancelLoginCallback(false);return}this.__cancelLoginCallback(true);sessionStorage.setItem("qticket",i);sessionStorage.setItem("qticket_username",g);sessionStorage.setItem("qticket_expiry",h);this.util.exec("[name=loggingin]",this.util.setVisible(false));this.util.exec("[name=loginstatus]",this.util.setVisible(true));this.util.exec("[name=authname]",this.util.setText(g));f()}.bind(this);this.util.exec("[name=loggingin]",this.util.setVisible(true));this.util.exec("[name="+b+"]",this.util.setVisible(false))},__validateConfirmData:function(){return{nickname:this.options.initialNickname,autojoin:this.options.initialChannels}},__validateLoginData:function(){var a=this.rootElement.getElement("input[name=nickname]"),d=this.rootElement.getElement("input[name=channels]");var b=a.value;var g=d.value;if(g=="#"){g=""}if(!b){alert("You must supply a nickname.");a.focus();return false}var f=qwebirc.global.nicknameValidator.validate(b);if(f!=b){a.value=f;alert("Your nickname was invalid and has been corrected; please check your altered nickname and try again.");a.focus();return false}var c={nickname:b,autojoin:g};return c},__buildPrettyChannels:function(d,a){var f=a.split(" ")[0].split(",");d.appendChild(document.createTextNode("channel"+((f.length>1)?"s":"")+" "));for(var b=0;b<f.length;b++){if((f.length>1)&&(b==f.length-1)){d.appendChild(document.createTextNode(" and "))}else{if(b>0){d.appendChild(document.createTextNode(", "))}}d.appendChild(new Element("b").set("text",f[b]))}}});qwebirc.ui.LoginBox2=function(b,h,g,a,d){var c=new Element("input",{type:"submit"});c.set("value","Connect");var f=createRow(undefined,c);form.addEvent("submit",function(k){new Event(k).stop();var i=nick.value;var m=chan.value;if(m=="#"){m=""}if(!i){alert("You must supply a nickname.");nick.focus();return}var l=qwebirc.global.nicknameValidator.validate(i);if(l!=i){nick.value=l;alert("Your nickname was invalid and has been corrected; please check your altered nickname and press Connect again.");nick.focus();return}var j={nickname:i,autojoin:m};if(qwebirc.auth.enabled()){if(qwebirc.auth.passAuth()&&authCheckBox.checked){if(!usernameBox.value||!passwordBox.value){alert("You must supply your username and password in auth mode.");if(!usernameBox.value){usernameBox.focus()}else{passwordBox.focus()}return}j.serverPassword=usernameBox.value+" "+passwordBox.value}else{if(qwebirc.auth.bouncerAuth()){if(!passwordBox.value){alert("You must supply a password.");passwordBox.focus();return}j.serverPassword=passwordBox.value}}}b.removeChild(outerbox);h(j)}.bind(this));nick.set("value",g);if(window==window.top){nick.focus()}};qwebirc.ui.authShowHide=function(d,h,b,c,a){var g=d.checked;var f=g?null:"none";c.setStyle("display",f);a.setStyle("display",f);if(g){b.focus()}};qwebirc.ui.isAuthRequired=(function(){var a=qwebirc.util.parseURI(String(document.location));var b=$defined(a)&&a.get("authrequired");return function(){return b&&qwebirc.auth.enabled()}})();qwebirc.ui.isHideAuth=(function(){var a=qwebirc.util.parseURI(String(document.location));var b=$defined(a)&&a.get("hideauth");return function(){return b}})();qwebirc.ui.EmbedWizardStep=new Class({Implements:[Options,Events],options:{title:"",first:"",hint:"",middle:null,premove:null,example:""},initialize:function(b,a){this.setOptions(a);this.parent=b},show:function(){this.parent.title.set("html",this.options.title);this.parent.firstRow.set("html",this.options.first);this.parent.hint.set("html",this.options.hint);this.parent.example.set("text",this.options.example);while(this.parent.middleRow.childNodes.length>0){this.parent.middleRow.removeChild(this.parent.middleRow.childNodes[0])}if($defined(this.options.middle)){this.parent.middleRow.appendChild(this.options.middle)}this.fireEvent("show")}});qwebirc.ui.EmbedWizard=new Class({Implements:[Options,Events],options:{uiOptions:null,optionsCallback:null,baseURL:"http://webchat.quakenet.org/"},initialize:function(b,a){this.options.uiOptions=a.uiOptions;this.options.baseURL=a.baseURL;this.options.optionsCallback=a.optionsCallback;this.create(b);this.addSteps()},create:function(f){this.t=f;var g=this.newRow();this.title=new Element("h2");this.title.setStyle("margin-top","0px");this.title.setStyle("margin-bottom","5px");g.appendChild(this.title);this.firstRow=this.newRow();this.middleRow=this.newRow();var b=this.newRow();this.hint=new Element("div");this.hint.setStyle("font-size","0.8em");this.hint.setStyle("font-style","italic");b.appendChild(this.hint);var h=this.newRow();this.example=new Element("pre");h.appendChild(this.example);var d=this.newRow();d.addClass("wizardcontrols");var c=new Element("input");c.type="submit";c.value="< Back";c.addEvent("click",this.back.bind(this));d.appendChild(c);var a=new Element("input");a.type="submit";a.value="Next >";d.appendChild(a);a.addEvent("click",this.next.bind(this));this.nextBtn=a;this.backBtn=c},newRow:function(){var a=new Element("div");this.t.appendChild(a);return a},newStep:function(a){return new qwebirc.ui.EmbedWizardStep(this,a)},newRadio:function(d,h,b,c){var g=new Element("div");d.appendChild(g);var i=qwebirc.util.generateID();var f=qwebirc.util.createInput("radio",g,b,c,i);var a=new Element("label",{"for":i});a.appendChild(document.createTextNode(h));g.appendChild(a);return f},addSteps:function(){var g=function(i){if(Browser.Engine.trident){var j=function(){this.focus();if(i){this.select()}};j.delay(100,this,[])}else{this.focus();this.select()}};this.welcome=this.newStep({title:"Add webchat to your website",first:"This wizard will help you create an embedded client by asking you questions then giving you the code to add to your website.<br/><br/>You can use the <b>Next</b> and <b>Back</b> buttons to navigate through the wizard; click <b>Next</b> to continue."});this.chanBox=new Element("input");this.chanBox.addClass("text");this.chans=this.newStep({title:"Set channels",first:"Enter the channels you would like the client to join on startup:",hint:"You can supply multiple channels by seperating them with a comma, e.g.:",example:"#rogue,#eu-mage",middle:this.chanBox}).addEvent("show",g.bind(this.chanBox));var h=new Element("div");this.customnick=this.newStep({title:"Choose a nickname mode",first:"At startup would you like the client to use a random nickname, a preset nickname or a nickname of the users choice?",hint:"It is recommended that you only use a preset nickname if the client is for your own personal use.",middle:h});this.choosenick=this.newRadio(h,"Make the user choose a nickname.","nick",true);this.randnick=this.newRadio(h,"Use a random nickname, e.g. qwebirc12883.","nick");this.presetnick=this.newRadio(h,"Use a preset nickname of your choice.","nick");var f=new Element("form");this.connectdialog=this.newStep({title:"Display connect dialog?",first:"Do you want the user to be shown the connect dialog (with the values you have supplied pre-entered) or just a connect confirmation?",middle:f,hint:"You need to display the dialog if you want the user to be able to set their nickname before connecting."});var b=new Element("div");this.currentLF=this.newRadio(b,"Use the current look and feel (","lookandfeel",true);var c=new Element("input");c.type="submit";c.value="alter";c.addEvent("click",this.options.optionsCallback);b.firstChild.appendChild(c);b.firstChild.appendChild(document.createTextNode(")."));this.defaultLF=this.newRadio(b,"Use the default look and feel.","lookandfeel");this.lookandfeel=this.newStep({title:"Configure look and feel",first:"The look and feel will be copied from the current settings.",middle:b});var d=this.newRadio(f,"Connect without displaying the dialog.","prompt",true);this.connectdialogr=this.newRadio(f,"Show the connect dialog.","prompt");this.nicknameBox=new Element("input");this.nicknameBox.addClass("text");this.nickname=this.newStep({title:"Set nickname",first:"Enter the nickname you would like the client to use by default:",premove:function(){if(this.nicknameBox.value==""){alert("You must supply a nickname.");this.nicknameBox.focus();return false}var i=qwebirc.global.nicknameValidator.validate(this.nicknameBox.value,true);if(i!=this.nicknameBox.value){this.nicknameBox.value=i;alert("The supplied nickname was invalid and has been corrected.");this.nicknameBox.focus();return false}return true}.bind(this),middle:this.nicknameBox,hint:"If you use a . (dot/period) then it will be substituted with a random number."}).addEvent("show",g.bind(this.nicknameBox));var a=new Element("div");this.finish=this.newStep({title:"Finished!",first:"Your custom link is:",middle:a}).addEvent("show",function(){var l=new Element("a");var i=new Element("input");i.addClass("iframetext");var j=this.generateURL(false);l.href=j;l.target="_blank";l.setAttribute("rel","noopener noreferrer");l.appendChild(document.createTextNode(j));i.value='<iframe src="'+j+'" width="647" height="400"></iframe>';var k=[l,new Element("br"),new Element("br"),document.createTextNode("You can embed this into your page with the following code:"),new Element("br"),i];while(a.childNodes.length>0){a.removeChild(a.childNodes[0])}k.forEach(function(m){a.appendChild(m)});g.bind(i)(true);i.addEvent("click",function(){this.select()}.bind(i))}.bind(this));this.updateSteps();this.step=0;this.showStep()},updateSteps:function(){this.steps=[this.welcome,this.customnick];if(this.presetnick.checked){this.steps.push(this.nickname)}this.steps.push(this.chans);if(this.chanBox.value!=""&&!this.choosenick.checked){this.steps.push(this.connectdialog)}this.steps.push(this.lookandfeel);this.steps.push(this.finish)},showStep:function(){this.backBtn.disabled=!(this.step>0);this.nextBtn.value=(this.step>=this.steps.length-1)?"Close":"Next >";this.steps[this.step].show()},next:function(){var a=this.steps[this.step].options.premove;if(a&&!a()){return}this.updateSteps();if(this.step>=this.steps.length-1){this.close();return}this.step=this.step+1;this.showStep()},close:function(){this.fireEvent("close")},back:function(){if(this.step<=0){return}this.step=this.step-1;this.showStep()},generateURL:function(){var i=this.chanBox.value;var c=this.nicknameBox.value;var b=this.connectdialogr.checked&&i!=""&&!this.choosenick.checked;var a=[];if(this.presetnick.checked){a.push("nick="+escape(c))}else{if(!this.choosenick.checked){a.push("randomnick=1")}}if(i){var h=i.split(",");var g=[];h.forEach(function(d){if(d.charAt(0)=="#"){d=d.substring(1)}g.push(d)});a.push("channels="+escape(g.join(",")))}if(b){a.push("prompt=1")}if(this.currentLF.checked){var f=this.options.uiOptions.serialise();if(f!=""){a.push("uio="+f)}}return qwebirc.global.baseURL+(a.length>0?"?":"")+a.join("&")}});qwebirc.ui.supportsFocus=function(){var a=navigator.userAgent;if(!$defined(a)){return[true]}if(Browser.Engine.ipod||a.indexOf("Konqueror")!=-1){return[false,false]}return[true]};qwebirc.config.DEFAULT_OPTIONS=[[1,"BEEP_ON_MENTION","Beep on activity",true],[16,"NOTIFICATIONS","Emit HTML5 notifications on activity",false,{enabled:function(){if(!("Notification" in window)){return[false,false]}return[true]},applyChanges:function(b,a){if(a.setNotifications){a.setNotifications(b)}}}],[7,"FLASH_ON_MENTION","Flash titlebar when nick mentioned or on query activity",true,{enabled:qwebirc.ui.supportsFocus}],[2,"DEDICATED_MSG_WINDOW","Send privmsgs to dedicated messages window",false],[4,"DEDICATED_NOTICE_WINDOW","Send notices to dedicated message window",false],[3,"NICK_OV_STATUS","Show status (@/+) before nicknames in channel lines",true],[8,"LASTPOS_LINE","Show a last position indicator for each window",true,{enabled:qwebirc.ui.supportsFocus}],[9,"NICK_COLOURS","Automatically colour nicknames",true],[10,"HIDE_JOINPARTS","Hide JOINS/PARTS/QUITS",true],[11,"STYLE_HUE","Adjust user interface hue",function(a){return{class_:qwebirc.config.HueOption,default_:a.__styleValues.hue}},{applyChanges:function(b,a){a.setModifiableStylesheetValues({hue:b})}}],[12,"QUERY_ON_NICK_CLICK","Query on nickname click in channel",false],[13,"SHOW_NICKLIST","Show nickname list in channels",true],[14,"SHOW_TIMESTAMPS","Show timestamps",false],[15,"SIDE_TABS","Show tabs on the side",false,{enabled:function(){if(Browser.Engine.trident&&Browser.Engine.version<8){return[false,false]}return[true]},applyChanges:function(b,a){a.setSideTabs(b)}}]];qwebirc.config.QUAKENET_OPTIONS=[[5,"ACCEPT_SERVICE_INVITES","Automatically join channels when invited by Q",false,{settableByURL:false}],[6,"USE_HIDDENHOST","Hide your hostmask when authed to Q (+x)",true,{settableByURL:false}]];qwebirc.config.DefaultOptions=null;qwebirc.config.Input=new Class({initialize:function(c,b,a,d){this.option=b;this.value=b.value;this.enabled=this.option.enabled;this.position=a;this.parentElement=c;this.parentObject=d;this.render()},createInput:function(d,c,a,b,f){if(!$defined(c)){c=this.parentElement}return qwebirc.util.createInput(d,c,a,b,this.option.id)},FE:function(a,b){var c=new Element(a);if(!$defined(b)){b=this.parentElement}b.appendChild(c);return c},focus:function(){this.mainElement.focus()},render:function(){this.event("render",this.mainElement)},applyChanges:function(){this.event("applyChanges",[this.get(),this.parentObject.optionObject.ui])},event:function(b,a){if(!$defined(this.option.extras)){return}var c=this.option.extras[b];if(!$defined(c)){return}c.pass(a,this)()},cancel:function(){}});qwebirc.config.TextInput=new Class({Extends:qwebirc.config.Input,render:function(){var a=this.createInput("text");this.mainElement=a;a.value=this.value;a.disabled=!this.enabled;this.parent()},get:function(){return this.mainElement.value}});qwebirc.config.HueInput=new Class({Extends:qwebirc.config.Input,wide:true,render:function(){var b=new Element("div");b.addClass("qwebirc-optionspane");b.addClass("hue-slider");this.parentElement.appendChild(b);var a=new Element("div");a.addClass("knob");if(Browser.Engine.trident){a.setStyle("top","0px");a.setStyle("background-color","black")}b.appendChild(a);var c=new Slider(b,a,{steps:36,range:[0,369],wheel:true});c.set(this.value);this.startValue=this.value;c.addEvent("change",function(d){this.value=d;this.applyChanges()}.bind(this));this.mainElement=b;if(!this.enabled){c.detach()}this.parent()},get:function(){return this.value},cancel:function(){this.value=this.startValue;this.applyChanges()}});qwebirc.config.CheckInput=new Class({Extends:qwebirc.config.Input,render:function(){var a=this.createInput("checkbox",null,null,null,this.id);this.mainElement=a;a.checked=this.value;a.disabled=!this.enabled;this.parent()},get:function(){return this.mainElement.checked}});qwebirc.config.RadioInput=new Class({Extends:qwebirc.config.Input,render:function(){var b=this.option.options;this.elements=[];for(var a=0;a<b.length;a++){var f=this.FE("div",this.parentObject);var c=this.createInput("radio",f,"options_radio"+this.position,a==this.option.position);this.elements.push(c);c.disabled=!this.enabled;if(a==0){this.mainElement=c}f.appendChild(document.createTextNode(b[a][0]))}this.parent()},get:function(){for(var b=0;b<this.elements.length;b++){var a=this.elements[b];if(a.checked){this.option.position=b;return this.option.options[b][1]}}}});qwebirc.config.Option=new Class({initialize:function(g,f,b,d,c){this.prefix=f;this.label=b;this.default_=d;this.optionId=g;this.extras=c;if($defined(c)&&$defined(c.enabled)){var a=c.enabled();this.enabled=a[0];if(!a[0]&&a.length>1){this.default_=a[1]}}else{this.enabled=true}if($defined(c)&&$defined(c.settableByURL)){this.settableByURL=c.settableByURL}else{this.settableByURL=true}},setSavedValue:function(a){if(this.enabled){this.value=a}}});qwebirc.config.RadioOption=new Class({Extends:qwebirc.config.Option,Element:qwebirc.config.RadioInput,initialize:function(g,f,b,d,c,a){this.options=a.map(function(h){if(typeof(h)=="string"){return[h,h]}return h});this.defaultposition=d;this.parent(g,f,b,this.options[d][1],c)},setSavedValue:function(a){for(var b=0;b<this.options.length;b++){var c=this.options[b][1];if(a==c){this.position=b;this.value=a;return}}this.position=this.defaultposition;this.value=this.default_}});qwebirc.config.TextOption=new Class({Extends:qwebirc.config.Option,Element:qwebirc.config.TextInput});qwebirc.config.CheckOption=new Class({Extends:qwebirc.config.Option,Element:qwebirc.config.CheckInput});qwebirc.config.HueOption=new Class({Extends:qwebirc.config.Option,Element:qwebirc.config.HueInput});qwebirc.ui.Options=new Class({initialize:function(a){this.ui=a;if(!$defined(qwebirc.config.DefaultOptions)){this.__configureDefaults()}this.optionList=qwebirc.config.DefaultOptions.slice();this.optionHash={};this._setup();this.optionList.forEach(function(b){b.setSavedValue(this._get(b));this.optionHash[b.prefix]=b;this[b.prefix]=b.value}.bind(this))},__configureDefaults:function(){var b=qwebirc.config.DEFAULT_OPTIONS.slice(0);var c=null;if(this.ui.options.networkName=="QuakeNet"){c=qwebirc.config.QUAKENET_OPTIONS}if(c){for(var a=0;a<c.length;a++){b.push(c[a])}}qwebirc.config.DefaultOptions=b.map(function(m){var g=m[0];var i=m[1];var l=m[2];var d=m[3];var h=m[4];var f=m[5];var k=typeof(d);if(k=="number"){return new qwebirc.config.RadioOption(g,i,l,d,h,extra)}else{var j;if(k=="boolean"){j=qwebirc.config.CheckOption}else{if(k=="function"){var n=d.call(this,this.ui);j=n.class_;d=n.default_}else{j=qwebirc.config.TextOption}}return new j(g,i,l,d,h)}},this)},setValue:function(a,b){this.optionHash[a.prefix].value=b;this[a.prefix]=b},setValueByPrefix:function(b,a){this.optionHash[b].value=a;this[b]=a},getOptionList:function(){return this.optionList},_get:function(a){return a.default_},_setup:function(){},flush:function(){}});qwebirc.ui.OptionsPane=new Class({Implements:[Events],initialize:function(b,a){this.parentElement=b;this.optionObject=a;this.createElements()},createElements:function(){var h=function(i,r){var t=new Element(i);r.appendChild(t);return t};var o=h("table",this.parentElement);var c=h("tbody",o);this.boxList=[];var f=this.optionObject.getOptionList();for(var d=0;d<f.length;d++){var l=f[d];var s=h("tr",c);var m=h("td",s);l.id=qwebirc.util.generateID();var q=new l.Element(m,l,d,this);this.boxList.push([l,q]);var p=m.lastChild;if(q.wide){m.removeChild(p)}var k=new Element("label",{"for":l.id});m.appendChild(k);var b;if(q.wide){k.set("text",l.label+":");m.appendChild(p)}else{k.set("text",l.label)}}var a=h("tr",c);var j=h("td",a);var g=qwebirc.util.createInput("submit",j);g.value="Save";g.addEvent("click",function(){this.save();this.fireEvent("close")}.bind(this));var n=qwebirc.util.createInput("submit",j);n.value="Cancel";n.addEvent("click",function(){this.cancel();this.fireEvent("close")}.bind(this))},save:function(){this.boxList.forEach(function(a){var b=a[0];var c=a[1];this.optionObject.setValue(b,c.get())}.bind(this));this.boxList.forEach(function(a){a[1].applyChanges()}.bind(this));this.optionObject.flush()},cancel:function(){this.boxList.forEach(function(a){a[1].cancel()}.bind(this))}});qwebirc.ui.CookieOptions=new Class({Extends:qwebirc.ui.Options,_setup:function(){this.__cookie=new Hash.Cookie("opt1",{duration:3650,autoSave:false})},_get:function(a){var b=this.__cookie.get(a.optionId);if(!$defined(b)){return a.default_}return b},flush:function(){this.__cookie.erase();this._setup();this.getOptionList().forEach(function(a){this.__cookie.set(a.optionId,a.value)}.bind(this));this.__cookie.save()}});qwebirc.ui.SuppliedArgOptions=new Class({Extends:qwebirc.ui.CookieOptions,initialize:function(d,a){var g=new QHash();if($defined(a)&&a!=""&&a.length>2){var c=a.substr(a.length-2,2);var b=qwebirc.util.b64Decode(a.substr(0,a.length-2));if(b&&(new qwebirc.util.crypto.MD5().digest(b).slice(0,2)==c)){var f=qwebirc.util.parseURI("?"+b);f.each(function(i,h){g.put(i,JSON.decode(h,true))})}}this.parsedOptions=g;this.parent(d)},_get:function(a){if(a.settableByURL!==true){return this.parent(a)}var b=this.parsedOptions.get(String(a.optionId));if(!$defined(b)){return this.parent(a)}return b},serialise:function(){var a=[];this.getOptionList().forEach(function(d){if(d.settableByURL&&d.default_!=d.value){a.push(d.optionId+"="+JSON.encode(d.value))}}.bind(this));var b=a.join("&");var c=new qwebirc.util.crypto.MD5().digest(b).slice(0,2);return(qwebirc.util.b64Encode(b)).replaceAll("=","")+c}});qwebirc.ui.DefaultOptionsClass=new Class({Extends:qwebirc.ui.SuppliedArgOptions});qwebirc.ui.AboutPane=new Class({Implements:[Events],initialize:function(b){var d=function(){b.set("html",'<div class="loading">Loading. . .</div>')};var a=d.delay(500);var c=qwebirc.ui.RequestTransformHTML({url:qwebirc.global.staticBaseURL+"panes/about.html",update:b,onSuccess:function(){$clear(a);b.getElement("input[class=close]").addEvent("click",function(){this.fireEvent("close")}.bind(this));b.getElement("div[class=version]").set("text","v"+qwebirc.VERSION)}.bind(this)});c.get()}});qwebirc.ui.URLPane=new Class({Implements:[Events],initialize:function(c,a){var b=new Element("iframe");b.style.width="100%";b.style.height="100%";b.src=a.url;c.appendChild(b)}});function qwebirc_ui_onbeforeunload(b){if(qwebirc.connected){var a="This action will close all active IRC connections.";var b=b||window.event;if(b){b.returnValue=a}return a}}qwebirc.ui.Interface=new Class({Implements:[Options],options:{initialNickname:null,initialChannels:"#All4Masti",networkName:"ExampleNetwork",networkServices:[],loginRegex:null,appTitle:"ExampleNetwork Web IRC",searchURL:true,theme:undefined,baseURL:null,hue:null,saturation:null,lightness:null,thue:null,tsaturation:null,tlightness:null,uiOptionsArg:null,nickValidation:null,dynamicBaseURL:"/",staticBaseURL:"/",dynamicConfiguration:false,logoURL:null,accountWhoisCommand:null},initialize:function(b,c,a){this.setOptions(a);var d=function(){var g=document.location.href;var h=g.indexOf("?");if(h!=-1){g=g.substring(0,h)}var h=g.indexOf("#");if(h!=-1){g=g.substring(0,h)}if(QWEBIRC_DEBUG&&g.endsWith(".html")){var f=g.lastIndexOf("/");g=g.substring(0,f+1)}if(g.substr(g.length-1)!="/"){g=g+"/"}return g};a.baseURL=d();qwebirc.global={dynamicBaseURL:a.dynamicBaseURL,dynamicConfiguration:a.dynamicConfiguration,staticBaseURL:a.staticBaseURL,baseURL:a.baseURL,nicknameValidator:$defined(a.nickValidation)?new qwebirc.irc.NicknameValidator(a.nickValidation):new qwebirc.irc.DummyNicknameValidator(),dynamicConfigurationLoaded:false};window.addEvent("domready",function(){var m=function(p){var i=new qwebirc.irc.IRCClient(p,o);i.connect();window.onbeforeunload=qwebirc_ui_onbeforeunload;window.addEvent("unload",function(){i.quit("Page closed")})};var t=null;var g=this.options.initialChannels;var q=false;if(this.options.searchURL){var h=qwebirc.util.parseURI(String(document.location));this.options.hue=this.getHueArg(h,"");this.options.saturation=this.getSaturationArg(h,"");this.options.lightness=this.getLightnessArg(h,"");this.options.thue=this.getHueArg(h,"t");this.options.tsaturation=this.getSaturationArg(h,"t");this.options.tlightness=this.getLightnessArg(h,"t");if(h.contains("uio")){this.options.uiOptionsArg=h.get("uio")}var k=h.get("url");var l,y=h.get("nick");if($defined(k)){g=this.parseIRCURL(k);if($defined(l)&&l!=""){n=true}}else{l=h.get("channels");var n=false;if(l){var f=l.split(" ");l=f[0].split(",");var s=[];for(var v=0;v<l.length;v++){s[v]=l[v];var u=l[v].charAt(0);if(u!="#"&&u!="&"){s[v]="#"+s[v]}}f[0]=s.join(",");g=f.join(" ");n=true}}if($defined(y)){t=this.randSub(y)}if(h.contains("randomnick")&&h.get("randomnick")==1){t=this.options.initialNickname}if(n&&(!$defined(t)||($defined(t)&&(t!="")))){var r=h.get("prompt");var j=false;if(!$defined(r)||r==""){j=true;r=false}else{if(r=="0"){r=false}else{r=true}}if($defined(t)&&!r){q=true}else{if(!j&&!r){q=true}}}}var o=new c($(b),new qwebirc.ui.Theme(this.options.theme),this.options);var z=!$defined(y);if(z&&q){t=this.options.initialNickname}var x=o.loginBox(m,t,g,q,z)}.bind(this))},getHueArg:function(b,c){var a=b.get(c+"hue");if(!$defined(a)){return null}a=parseInt(a);if(a>360||a<0){return null}return a},getSaturationArg:function(a,b){var c=a.get(b+"saturation");if(!$defined(c)){return null}c=parseInt(c);if(c>100||c<-100){return null}return c},getLightnessArg:function(a,b){var c=a.get(b+"lightness");if(!$defined(c)){return null}c=parseInt(c);if(c>100||c<-100){return null}return c},randSub:function(a){var b=function(){return Math.floor(Math.random()*10)};return a.split("").map(function(c){if(c=="."){return b()}else{return c}}).join("")},parseIRCURL:function(a){if(a.indexOf(":")==0){return}var d=a.splitMax(":",2);if(d[0].toLowerCase()!="irc"&&d[0].toLowerCase()!="ircs"){alert("Bad IRC URL scheme.");return}if(a.indexOf("/")==0){return}var k=a.splitMax("/",4);if(k.length<4||k[3]==""){return}var j,b;if(k[3].indexOf("?")>-1){b=qwebirc.util.parseURI(k[3]);j=k[3].splitMax("?",2)[0]}else{j=k[3]}var c=j.split(",");var h=c[0];if(h.charAt(0)!="#"){h="#"+h}var l=[],g=false,n;for(var f=1;f<c.length;f++){var m=c[f];if(m=="needkey"){g=true}else{l.push(m)}}if($defined(b)){b.each(function(i,o){if(i=="key"){n=o;g=true}else{l.push(i)}})}if(g){if(!$defined(n)){n=prompt("Please enter the password for channel "+h+":")}if($defined(n)){h=h+" "+n}}if(l.length>0){alert("The following IRC URL components were not accepted: "+l.join(", ")+".")}return h}});qwebirc.ui.requireDynamicConfiguration=function(b){if(!qwebirc.global.dynamicConfiguration||qwebirc.global.dynamicConfigurationLoaded){b();return}var a=new Request.JSON({url:qwebirc.global.dynamicBaseURL+"configuration",onSuccess:function(c){qwebirc.global.dynamicBaseURL=c.dynamicBaseURL;b()}});a.get()};qwebirc.auth.loggedin=function(d){if(typeof sessionStorage==="undefined"){return}var c=sessionStorage.getItem("qticket");var a=sessionStorage.getItem("qticket_username");var b=sessionStorage.getItem("qticket_expiry");if(c===null){return}if(d){if(Date.now()>b){sessionStorage.removeItem("qticket");sessionStorage.removeItem("qticket_username");sessionStorage.removeItem("qticket_expiry");return}}else{}return[a,c]};qwebirc.auth.enabled=function(){return true};qwebirc.auth.quakeNetAuth=function(){return true};qwebirc.auth.passAuth=function(){return false};qwebirc.auth.bouncerAuth=function(){return false};qwebirc.sound.SoundPlayer=new Class({Implements:[Events],initialize:function(){var a=qwebirc.global.staticBaseURL;if(qwebirc.global.baseURL.substr(qwebirc.global.baseURL.length-1,1)=="/"&&a.substr(0,1)=="/"){a=a.substr(1)}this.sounds={};this.soundURL=qwebirc.global.baseURL+a+"sound/"},play:function(a){try{var b=this.sounds[a];if(!b){b=this.sounds[a]=new Audio(this.soundURL+a)}b.play()}catch(c){}}});qwebirc.ui.QUI=new Class({Extends:qwebirc.ui.RootUI,initialize:function(a,c,b){this.parent(a,qwebirc.ui.QUI.Window,"qui",b);this.theme=c;this.parentElement=a;this.setModifiableStylesheet("qui")},postInitialize:function(){this.qjsui=new qwebirc.ui.QUI.JSUI("qwebirc-qui",this.parentElement);this.qjsui.addEvent("reflow",function(){var c=this.getActiveWindow();if($defined(c)){c.onResize()}}.bind(this));this.qjsui.top.addClass("outertabbar");this.qjsui.left.addClass("outertabbar");this.qjsui.top.addClass("outertabbar_top");this.qjsui.left.addClass("outertabbar_left");this.qjsui.bottom.addClass("input");this.qjsui.right.addClass("nicklist");this.qjsui.topic.addClass("topic");this.qjsui.middle.addClass("lines");this.outerTabs=new Element("div");this.sideTabs=null;this.tabs=new Element("div");this.tabs.addClass("tabbar");this.__createDropdownMenu();this.outerTabs.appendChild(this.tabs);this.origtopic=this.topic=this.qjsui.topic;this.lines=this.qjsui.middle;this.orignicklist=this.nicklist=this.qjsui.right;this.input=this.qjsui.bottom;this.reflow=this.qjsui.reflow.bind(this.qjsui);var b=function(d){var f=new Event(d);var c,h;if(this.sideTabs){var g=this.qjsui.left;if(g.getScrollSize().y>g.clientHeight){return}c=f.wheel<0;h=f.wheel>0}else{c=f.wheel>0;h=f.wheel<0}if(c){this.nextWindow()}else{if(h){this.prevWindow()}}f.stop()}.bind(this);this.qjsui.left.addEvent("mousewheel",b);this.qjsui.top.addEvent("mousewheel",b);this.createInput();this.reflow();for(var a=50;a<1000;a+=50){this.reflow.delay(a,true)}for(var a=1000;a<2000;a+=100){this.reflow.delay(a)}for(var a=2000;a<15000;a+=500){this.reflow.delay(a)}this.setSideTabs(this.uiOptions.SIDE_TABS)},newWindow:function(b,d,c){var a=this.parent(b,d,c);a.setSideTabs(this.sideTabs);return a},__createDropdownMenu:function(){var a=new Element("span");a.addClass("dropdownmenu");a.hide=function(){a.setStyle("display","none");a.visible=false;document.removeEvent("mousedown",b)}.bind(this);var b=function(){a.hide()};a.hide();this.parentElement.appendChild(a);this.UICommands.forEach(function(d){var h=d[0];var f=d[1];var g=new Element("a");g.addEvent("mousedown",function(i){new Event(i).stop()});g.addEvent("click",function(){a.hide();f()});g.set("text",h);a.appendChild(g)}.bind(this));var c=new Element("div");c.addClass("dropdown-tab");c.appendChild(new Element("img",{src:qwebirc.global.staticBaseURL+"images/icon.png",title:"menu",alt:"menu"}));c.setStyle("opacity",1);this.outerTabs.appendChild(c);a.show=function(d){new Event(d).stop();if(a.visible){a.hide();return}a.setStyle("display","inline-block");a.visible=true;document.addEvent("mousedown",b)}.bind(this);c.addEvent("mousedown",function(d){new Event(d).stop()});c.addEvent("click",a.show)},createInput:function(){var f=new Element("form");this.input.appendChild(f);f.addClass("input");var b=new Element("input");this.addEvent("signedOn",function(h){this.getStatusWindow(h).lines.removeClass("spinner");b.placeholder="chat here! you can also use commands, like /JOIN";var i=function(){b.addClass("input-flash")}.delay(250);var i=function(){b.removeClass("input-flash")}.delay(500);var i=function(){b.addClass("input-flash")}.delay(750);var i=function(){b.removeClass("input-flash")}.delay(1000);var i=function(){b.addClass("input-flash")}.delay(1250);var i=function(){b.removeClass("input-flash")}.delay(1750)});f.appendChild(b);this.inputbox=b;this.inputbox.maxLength=470;var d=function(){if(b.value==""){return}this.resetTabComplete();this.getActiveWindow().historyExec(b.value);b.value="";b.placeholder=""}.bind(this);if(!qwebirc.util.deviceHasKeyboard()){b.addClass("mobile-input");var g=new Element("input",{type:"button"});g.addClass("mobile-button");g.addEvent("click",function(){d();b.focus()});g.value=">";this.input.appendChild(g);var a=function(){var j=this.input.getSize();var h=g.getSize();var i=j.x-h.x-5;g.setStyle("left",i);b.setStyle("width",i-5);g.setStyle("height",j.y)}.bind(this);this.qjsui.addEvent("reflow",a)}else{b.addClass("keyboard-input")}f.addEvent("submit",function(h){new Event(h).stop();d()});var c=this.resetTabComplete.bind(this);b.addEvent("focus",c);b.addEvent("mousedown",c);b.addEvent("keypress",c);b.addEvent("keydown",function(j){var i;var k=b.value;if(j.alt||j.control||j.meta){return}if(j.key=="up"&&!j.shift){i=this.commandhistory.upLine}else{if(j.key=="down"&&!j.shift){i=this.commandhistory.downLine}else{if(j.key=="tab"){this.tabComplete(b,j.shift);new Event(j).stop();j.preventDefault();return}else{return}}}this.resetTabComplete();if((k!="")&&(this.lastcvalue!=k)){this.commandhistory.addLine(k,true)}var h=i.bind(this.commandhistory)();new Event(j).stop();j.preventDefault();if(!h){h=""}this.lastcvalue=h;b.value=h;qwebirc.util.setAtEnd(b)}.bind(this))},setLines:function(a){this.lines.parentNode.replaceChild(a,this.lines);this.qjsui.middle=this.lines=a},setChannelItems:function(b,a){if(!$defined(b)){b=this.orignicklist;a=this.origtopic}this.nicklist.parentNode.replaceChild(b,this.nicklist);this.qjsui.right=this.nicklist=b;this.topic.parentNode.replaceChild(a,this.topic);this.qjsui.topic=this.topic=a},setSideTabs:function(a){if(a===this.sideTabs){return}if(this.sideTabs===true){this.qjsui.left.removeChild(this.outerTabs)}else{if(this.sideTabs===false){this.qjsui.top.removeChild(this.outerTabs)}}if(a){this.qjsui.left.appendChild(this.outerTabs);this.qjsui.top.style.display="none";this.qjsui.left.style.display=""}else{this.qjsui.top.appendChild(this.outerTabs);this.qjsui.top.style.display="";this.qjsui.left.style.display="none"}this.sideTabs=a;this.windows.each(function(c,b){b.each(function(d,f){f.setSideTabs(a)})})}});qwebirc.ui.QUI.JSUI=new Class({Implements:[Events],initialize:function(a,b,c){this.parent=b;this.sizer=$defined(c)?c:b;this.class_=a;this.create();this.reflowevent=null;window.addEvent("resize",function(){this.reflow(100)}.bind(this))},applyClasses:function(b,a){a.addClass("dynamicpanel");a.addClass(this.class_);a.addClass(b+"boundpanel")},create:function(){var a=function(c){var b=new Element("div");this.applyClasses(c,b);this.parent.appendChild(b);return b}.bind(this);this.top=a("top");this.left=a("left");this.topic=a("topic");this.middle=a("middle");this.right=a("right");this.bottom=a("bottom")},reflow:function(a){if(!a){a=1}if(this.reflowevent){$clear(this.reflowevent)}this.__reflow();this.reflowevent=this.__reflow.delay(a,this)},__reflow:function(){var c=this.bottom;var o=this.middle;var n=this.right;var h=this.topic;var m=this.top;var f=this.left;var l=h.getSize();var g=m.getSize();var d=n.getSize();var b=c.getSize();var i=f.getSize();var k=this.sizer.getSize();var a=(k.y-g.y-b.y-l.y);var j=(k.x-d.x-i.x);f.setStyle("top",g.y);h.setStyle("top",g.y);h.setStyle("left",i.x);h.setStyle("width",k.x-i.x);o.setStyle("top",(g.y+l.y));o.setStyle("left",i.x);if(a>0){o.setStyle("height",a);n.setStyle("height",a)}if(j>0){o.setStyle("width",j)}n.setStyle("top",(g.y+l.y));c.setStyle("left",i.x);this.fireEvent("reflow")},showChannel:function(b,a){var c="none";if(b){c="block"}this.right.setStyle("display",a?c:"none");this.topic.setStyle("display",c)},showInput:function(a){this.bottom.isVisible=a;this.bottom.setStyle("display",a?"block":"none")}});qwebirc.ui.QUI.Window=new Class({Extends:qwebirc.ui.Window,initialize:function(g,b,f,d,c){this.parent(g,b,f,d,c);this.tab=new Element("a");this.tab.addClass("tab");this.tab.addEvent("focus",function(){this.blur()}.bind(this.tab));this.spaceNode=document.createTextNode(" ");g.tabs.appendChild(this.tab);g.tabs.appendChild(this.spaceNode);if(f!=qwebirc.ui.WINDOW_STATUS&&f!=qwebirc.ui.WINDOW_CONNECT){var a=new Element("span");this.tabclose=a;a.set("text","X");a.addClass("tabclose");var h=function(i){new Event(i).stop();if(this.closed){return}if(f==qwebirc.ui.WINDOW_CHANNEL){this.client.exec("/PART "+d)}this.close()}.bind(this);a.addEvent("click",h);this.tab.addEvent("mouseup",function(j){var i=1;if(Browser.Engine.trident){i=4}if(j.event.button==i){h(j)}}.bind(this));this.tab.appendChild(a)}else{this.tabclose=null}this.tab.appendText(d);this.tab.addEvent("click",function(i){new Event(i).stop();if(this.closed){return}g.selectWindow(this)}.bind(this));this.lines=new Element("div");this.parentObject.qjsui.applyClasses("middle",this.lines);this.lines.addClass("lines");if(f==qwebirc.ui.WINDOW_STATUS){this.lines.addClass("spinner")}if(f!=qwebirc.ui.WINDOW_CUSTOM&&f!=qwebirc.ui.WINDOW_CONNECT){this.lines.addClass("ircwindow")}this.lines.addEvent("scroll",function(){this.scrolleddown=this.scrolledDown();this.scrollpos=this.getScrollParent().getScroll()}.bind(this));if(f==qwebirc.ui.WINDOW_CHANNEL){this.topic=new Element("div");this.parentObject.qjsui.applyClasses("topic",this.topic);this.topic.addClass("topic");this.topic.addClass("tab-invisible");this.topic.set("html","&nbsp;");this.topic.addEvent("dblclick",this.editTopic.bind(this));this.parentObject.qjsui.applyClasses("topic",this.topic);this.prevNick=null;this.nicklist=new Element("div");this.nicklist.addClass("nicklist");this.nicklist.addClass("tab-invisible");this.nicklist.addEvent("click",this.removePrevMenu.bind(this));this.parentObject.qjsui.applyClasses("right",this.nicklist);this.updateTopic("")}this.nicksColoured=this.parentObject.uiOptions.NICK_COLOURS;this.reflow()},rename:function(a){var b=document.createTextNode(a);if(this.parentObject.sideTabs){this.tab.replaceChild(b,this.tab.childNodes[1])}else{this.tab.replaceChild(b,this.tab.firstChild)}},editTopic:function(){if(this.type!=qwebirc.ui.WINDOW_CHANNEL){return}if(!this.client.nickOnChanHasPrefix(this.client.nickname,this.name,"@")){alert("Sorry, you need to be a channel operator to change the topic!");return}var a=prompt("Change topic of "+this.name+" to:",this.topic.topicText);if(a===null){return}this.client.exec("/TOPIC "+a)},reflow:function(){this.parentObject.reflow()},onResize:function(){if(this.scrolleddown){if(Browser.Engine.trident){this.scrollToBottom.delay(5,this)}else{this.scrollToBottom()}}else{if($defined(this.scrollpos)){if(Browser.Engine.trident){this.getScrollParent().scrollTo(this.scrollpos.x,this.scrollpos.y)}else{this.getScrollParent().scrollTo.delay(5,this,[this.scrollpos.x,this.scrollpos.y])}}}},createMenu:function(b,c){var d=new Element("div");c.appendChild(d);d.addClass("menu");var a=[b];qwebirc.ui.MENU_ITEMS.forEach(function(f){if(!f.predicate||f.predicate!==true&&!f.predicate.apply(this,a)){return}var g=new Element("a");d.appendChild(g);g.set("text","- "+f.text);g.addEvent("focus",function(){this.blur()}.bind(g));g.addEvent("click",function(h){new Event(h.stop());this.menuClick(f.fn)}.bind(this))}.bind(this));return d},menuClick:function(a){a.bind(this)(this.prevNick.realNick);this.removePrevMenu()},moveMenuClass:function(){if(!this.prevNick){return}if(this.nicklist.firstChild==this.prevNick){this.prevNick.removeClass("selected-middle")}else{this.prevNick.addClass("selected-middle")}},removePrevMenu:function(){if(!this.prevNick){return}this.prevNick.removeClass("selected");this.prevNick.removeClass("selected-middle");if(this.prevNick.menu){this.prevNick.removeChild(this.prevNick.menu)}this.prevNick=null},nickListAdd:function(c,b){var a=this.client.stripPrefix(c);var g=new Element("a");qwebirc.ui.insertAt(b,this.nicklist,g);var d=new Element("span");if(this.parentObject.uiOptions.NICK_COLOURS){var f=a.toHSBColour(this.client);if($defined(f)){d.setStyle("color",f.rgbToHex())}}d.set("text",c);g.appendChild(d);g.realNick=a;g.addEvent("click",function(h){if(this.prevNick==g){this.removePrevMenu();return}this.removePrevMenu();this.prevNick=g;g.addClass("selected");this.moveMenuClass();g.menu=this.createMenu(g.realNick,g);new Event(h).stop()}.bind(this));g.addEvent("focus",function(){this.blur()}.bind(g));this.moveMenuClass();return g},nickListRemove:function(a,b){this.nicklist.removeChild(b);this.moveMenuClass()},updateTopic:function(a){var b=this.topic;while(b.firstChild){b.removeChild(b.firstChild)}var c;if(this.type==qwebirc.ui.WINDOW_CHANNEL){c=": "}else{c=""}qwebirc.ui.Colourise(this.name+c,b,null,null,this);if(this.type==qwebirc.ui.WINDOW_CHANNEL){b.topicText=a;if(a){this.parent(a,b)}else{b.appendChild(document.createTextNode("(no topic set)"))}}this.reflow()},select:function(){var b=this.type!=qwebirc.ui.WINDOW_CONNECT&&this.type!=qwebirc.ui.WINDOW_CUSTOM;this.tab.removeClass("tab-unselected");this.tab.addClass("tab-selected");this.parentObject.setLines(this.lines);this.parentObject.setChannelItems(this.nicklist,this.topic);this.parentObject.qjsui.showInput(b);this.parentObject.qjsui.showChannel($defined(this.nicklist),this.parentObject.uiOptions.SHOW_NICKLIST);this.reflow();this.parent();if(b){this.parentObject.inputbox.focus()}if(this.type==qwebirc.ui.WINDOW_CHANNEL&&this.nicksColoured!=this.parentObject.uiOptions.NICK_COLOURS){this.nicksColoured=this.parentObject.uiOptions.NICK_COLOURS;var a=this.nicklist.childNodes;if(this.parentObject.uiOptions.NICK_COLOURS){for(var c=0;c<a.length;c++){var g=a[c],d=g.firstChild;var f=g.realNick.toHSBColour(this.client);if($defined(f)){d.setStyle("color",f.rgbToHex())}}}else{for(var c=0;c<a.length;c++){var d=a[c].firstChild;d.setStyle("color",null)}}}},deselect:function(){this.parent();this.tab.removeClass("tab-selected");this.tab.addClass("tab-unselected")},close:function(){this.parent();this.parentObject.tabs.removeChild(this.tab);this.parentObject.tabs.removeChild(this.spaceNode);this.reflow()},addLine:function(b,a,d){var c=new Element("div");if(d){c.addClass(d)}else{if(this.lastcolour){c.addClass("linestyle1")}else{c.addClass("linestyle2")}}this.lastcolour=!this.lastcolour;this.parent(b,a,d,c)},setHilighted:function(a){var b=this.hilighted;this.parent(a);if(a==b){return}this.tab.removeClass("tab-hilight-activity");this.tab.removeClass("tab-hilight-us");this.tab.removeClass("tab-hilight-speech");switch(this.hilighted){case qwebirc.ui.HILIGHT_US:this.tab.addClass("tab-hilight-us");break;case qwebirc.ui.HILIGHT_SPEECH:this.tab.addClass("tab-hilight-speech");break;case qwebirc.ui.HILIGHT_ACTIVITY:this.tab.addClass("tab-hilight-activity");break}},setSideTabs:function(a){if(this.tabclose===null){return}this.tab.removeChild(this.tabclose);if(a){this.tab.insertBefore(this.tabclose,this.tab.firstChild)}else{this.tab.appendChild(this.tabclose)}}});